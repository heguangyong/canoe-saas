(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesSys-card-ShareCardDetail"],{"21a9":function(e,t,a){var i=a("e754");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("4f06").default;n("16008642",i,!0,{sourceMap:!1,shadowMode:!1})},4161:function(e,t,a){"use strict";a.r(t);var i=a("7888"),n=a("82cc");for(var r in n)"default"!==r&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("62b9");var s,o=a("f0c5"),u=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"66354997",null,!1,i["a"],s);t["default"]=u.exports},"4daf":function(e,t,a){"use strict";var i=a("4ea4");a("c975"),a("4e82"),a("a9e3"),a("ac1f"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("2909")),r={props:{list:{type:Array,required:!0},offset:{type:Number,default:10},idKey:{type:String,default:"id"},imageSrcKey:{type:String,default:"image_url"},cols:{type:Number,default:2,validator:function(e){return e>=2}},imageStyle:{type:Object},single:{type:Boolean,default:!1},listStyle:{type:Object},goType:{type:String,default:"FULL"}},data:function(){return{topArr:[],allPositionArr:[],allHeightArr:[],height:0,oldNum:0,num:0}},created:function(){this.refresh()},methods:{imageLoadHandle:function(e){var t=this,a="waterfalls-list-id-"+this.list[e][this.idKey],i=uni.createSelectorQuery().in(this);i.select("#"+a).fields({size:!0},(function(a){if(t.num++,t.$set(t.allHeightArr,e,a.height),t.num===t.list.length){for(var i=t.oldNum;i<t.num;i++){var r=function(){var e=(0,n.default)(t.topArr).sort((function(e,t){return e-t}));return{shorterIndex:t.topArr.indexOf(e[0]),shorterValue:e[0],longerIndex:t.topArr.indexOf(e[t.cols-1]),longerValue:e[t.cols-1]}},s=r(),o=s.shorterIndex,u=s.shorterValue,c={top:u+"px",left:(a.width+t.offset)*o+"px"};t.$set(t.allPositionArr,i,c),t.topArr[o]=u+t.allHeightArr[i]+t.offset,t.height=r().longerValue-t.offset}t.oldNum=t.num,t.$emit("image-load")}})).exec()},refresh:function(){for(var e=[],t=0;t<this.cols;t++)e.push(0);this.topArr=e,this.num=0,this.oldNum=0},goTrendDetail:function(e){e.needAuthFlag||uni.navigateTo({url:"/pagesCmn/trend/ShareTrendDetail?id="+e.id})}}};t.default=r},"62b9":function(e,t,a){"use strict";var i=a("c9cd"),n=a.n(i);n.a},7793:function(e,t,a){"use strict";var i=a("21a9"),n=a.n(i);n.a},7888:function(e,t,a){"use strict";var i;a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return i}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"waterfalls-box",style:{height:e.height+"px"}},e._l(e.list,(function(t,i){return a("v-uni-view",{key:t[e.idKey],ref:"waterfalls-list-id-"+t[e.idKey],refInFor:!0,staticClass:"waterfalls-list",style:Object.assign({},{"--offset":e.offset+"px","--cols":e.cols},e.listStyle,e.allPositionArr[i]||{}),attrs:{id:"waterfalls-list-id-"+t[e.idKey]},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.goTrendDetail(t)}}},[a("v-uni-image",{staticClass:"waterfalls-list-image",class:{single:e.single},style:e.imageStyle,attrs:{mode:"widthFix",src:t[e.imageSrcKey]||" "},on:{load:function(t){arguments[0]=t=e.$handleEvent(t),e.imageLoadHandle(i)},error:function(t){arguments[0]=t=e.$handleEvent(t),e.imageLoadHandle(i)}}}),e._t("default",null,null,t)],2)})),1)},r=[]},"7b22":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return i}));var i={uniPopup:a("6ac9").default},n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{class:1==e.isUps?"prevent":""},[a("cu-custom",[a("template",{attrs:{slot:"content"},slot:"content"},[e._v("名片详情")])],2),a("ups-card",{attrs:{card:e.card}}),a("v-uni-view",{staticClass:"margin-sm"},[a("v-uni-scroll-view",{staticClass:"radius bg-white",attrs:{"scroll-y":!0}},[a("v-uni-view",{staticClass:"padding-xs text-center"},[a("v-uni-view",{staticClass:"solid-bottom text-lg padding-xs"},[a("v-uni-text",{staticClass:"text-grey"},[e._v("最 新 动 态")])],1)],1),a("v-uni-view",{staticClass:"content padding-sm",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.doAuth()}}},[a("ups-waterfalls",{ref:"upsWaterfalls",attrs:{list:e.trendList,goType:"DETAIL"}},e._l(e.trendList,(function(t,i){return a("v-uni-view",{key:i,attrs:{slot:"slot{{index}}"},slot:"slot{{index}}"},[a("v-uni-view",{staticClass:"cnt"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(t.title))])],1)],1)})),1)],1)],1),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"cu-tabbar-height"})],1),e.isUps?e._e():a("v-uni-view",{staticClass:"cu-bar bg-white tabbar border shop foot"},[a("v-uni-button",{staticClass:"action",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goHome.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cuIcon-home"}),e._v("首页")],1),e.canTalk()?a("v-uni-view",{staticClass:"action",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startTalk.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cuIcon-message"}),e._v("咨询")],1):e._e(),a("v-uni-view",{staticClass:"submit",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.popupAbout.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"text-lg text-grey"},[e._v("关于我")])],1)],1),e.isUps?a("v-uni-view",{staticClass:"shade"}):e._e(),a("uni-popup",{ref:"showPopupAbout",attrs:{type:"bottom"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.change.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"popup-base bg-white"},[a("v-uni-text",{staticClass:"cuIcon-close popup-close",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.cancel("PopupAbout")}}}),a("v-uni-text",{staticClass:"popup-title"},[e._v("关于我")]),a("v-uni-view",{staticClass:"popup-content"},[a("v-uni-text",{staticClass:"text-box padding-sm text-df",attrs:{"scroll-y":"true"}},[e._v(e._s(e.card.introduce))])],1),a("v-uni-view",{staticClass:"cu-tabbar-height"})],1)],1)],1)},r=[]},"801d":function(e,t,a){"use strict";(function(e){var i=a("4ea4");a("4160"),a("ac1f"),a("1276"),a("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var n=i(a("1da1")),r=i(a("5530")),s=a("2f62"),o=i(a("7fc7")),u=i(a("4161")),c=i(a("6ac9")),l=(i(a("7684")),i(a("d3b3"))),d={components:{"ups-card":o.default,"ups-waterfalls":u.default,"uni-popup":c.default},data:function(){return{card:{_id:"",qrcode:""},cardUser:{},trendList:[],page:1,isUps:!1,authBizInfo:{}}},onLoad:function(e){var t=this;if(e.id)t.card._id=e.id,t.getDetailById();else if(e.userId)t.userId=e.userId,t.getDetailByUserId();else if(e.scene){var a={},i=decodeURIComponent(e.scene).split("&");i.forEach((function(e){var i=e.split("=");a[i[0]]=i[1],"qrcode"==i[0]&&(t.card.qrcode=i[1])})),t.getDetailByQrcode()}},onShareAppMessage:function(e){return e.from,{title:"这是"+this.card.name+"的名片，请惠存。",imageUrl:this.card.cover||"",path:"/pagesSys/card/ShareCardDetail?id="+this.card._id,success:function(e){}}},computed:(0,r.default)((0,r.default)({},(0,s.mapState)(["needAuthFlag","user","cardAccount"])),{},{canTalk:function(){return function(){var e=this.user.userInfo||{cardId:""},t=this.card._id;return t.length>0&&e.cardId!=t}}}),methods:(0,r.default)((0,r.default)({},(0,s.mapMutations)(["needWxAuth","wxAuth","updateUser","updateUserAuth"])),{},{getDetailById:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i={},t.next=4,l.default.callFunction({name:"web",data:{$url:"getCardDetailById",id:a.card._id}});case 4:i=t.sent,a.card=JSON.parse(i.result.data),a.initTrendList(a.card);case 7:case"end":return t.stop()}}),t)})))()},getDetailByUserId:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i={},t.next=4,l.default.callFunction({name:"web",data:{$url:"getCardDetailByUserId",userId:a.userId}});case 4:i=t.sent,a.card=JSON.parse(i.result.data),a.initTrendList(a.card);case 7:case"end":return t.stop()}}),t)})))()},getDetailByQrcode:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i={},t.next=4,l.default.callFunction({name:"web",data:{$url:"getCardDetailByQrcode",qrcode:a.card.qrcode}});case 4:i=t.sent,a.card=JSON.parse(i.result.data),a.initTrendList(a.card);case 7:case"end":return t.stop()}}),t)})))()},initTrendList:function(t){var a=this;return(0,n.default)(regeneratorRuntime.mark((function i(){var n,r,s,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=a,e("log","card",t," at pagesSys/card/ShareCardDetail.vue:222"),n.needWxAuth(t),i.next=5,wx.cloud.callFunction({name:"sys",data:{$url:"getUserDetail",id:t.user_id}});case 5:return r=i.sent,e("log","cardUser",r," at pagesSys/card/ShareCardDetail.vue:231"),n.cardUser=r.result.data,s=[],1==n.page&&(n.trendList=[]),i.next=12,wx.cloud.callFunction({name:"cmn",data:{$url:"getTrendListByCardId",cardId:n.cardUser.userInfo.bizCardId,page:n.page}});case 12:r=i.sent,s=r.result.data,o=s[0],n.authBizInfo={_id:o.card_id,name:o.name,avatar:o.avatar},n.needWxAuth(n.authBizInfo),s.forEach((function(e){n.trendList.push({id:e._id,image_url:e.cover,title:e.title||"",carousels:e.carousels||[],needAuthFlag:n.needAuthFlag})}));case 18:case"end":return i.stop()}}),i)})))()},doAuth:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e,!a.needAuthFlag){t.next=5;break}return a.wxAuth(a.authBizInfo),setTimeout((function(){a.doAuth()}),2e3),t.abrupt("return");case 5:a.updateUserAuth(a.authBizInfo),a.trendList.forEach((function(e){e.needAuthFlag=!1})),a.$forceUpdate();case 8:case"end":return t.stop()}}),t)})))()},getTrendList:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i=[],n=null,1==a.page&&(a.trendList=[]),t.next=6,wx.cloud.callFunction({name:"cmn",data:{$url:"getTrendListByCardId",cardId:a.cardUser.userInfo.bizCardId,page:a.page}});case 6:n=t.sent,i=n.result.data,i.forEach((function(e){a.trendList.push({id:e._id,image_url:e.cover,title:e.title||"",carousels:e.carousels||[],needAuthFlag:a.needAuthFlag})}));case 9:case"end":return t.stop()}}),t)})))()},onPullDownRefresh:function(){this.page=1,this.getTrendList(),this.trendList=[],this.$refs.upsWaterfalls.refresh(),uni.stopPullDownRefresh()},onReachBottom:function(){this.page++,this.getTrendList()},shareCardDetail:function(){uni.showShareMenu({withShareTicket:!0})},goHome:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e,!a.needAuthFlag){t.next=5;break}return a.wxAuth(a.authBizInfo),setTimeout((function(){a.goHome()}),2e3),t.abrupt("return");case 5:a.updateUserAuth(a.authBizInfo),setTimeout((function(){uni.reLaunch({url:"/pages/site/home?id="+a.authBizInfo._id})}),1e3);case 7:case"end":return t.stop()}}),t)})))()},goQQMap:function(){var e=this;wx.openLocation({latitude:e.card.corp_address.latitude,longitude:e.card.corp_address.longitude})},goWebLogin:function(){uni.navigateTo({url:"/pages/my/WebLogin"})},startTalk:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e,!a.needAuthFlag){t.next=5;break}return a.wxAuth(a.authBizInfo),setTimeout((function(){a.startTalk()}),2e3),t.abrupt("return");case 5:a.updateUserAuth(a.authBizInfo),uni.navigateTo({url:"/pagesSys/site/WebService?sourceCardId="+a.user.userInfo.cardId+"&targetCardId="+a.card._id});case 7:case"end":return t.stop()}}),t)})))()},popupOperate:function(){var t=this;e("log","popupOperate"," at pagesSys/card/ShareCardDetail.vue:375"),this.$nextTick((function(){t.$refs["showPopupOperate"].open()}))},popupAbout:function(){var t=this;e("log","popupAbout"," at pagesSys/card/ShareCardDetail.vue:383"),t.isUps=!0,this.$nextTick((function(){t.$refs["showPopupAbout"].open()}))},change:function(e){e.show?this.isUps=!0:this.isUps=!1},cancel:function(e){this.$refs["show"+e].close()}})};t.default=d}).call(this,a("0de9")["log"])},"82cc":function(e,t,a){"use strict";a.r(t);var i=a("4daf"),n=a.n(i);for(var r in i)"default"!==r&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},c9cd:function(e,t,a){var i=a("ccde");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("4f06").default;n("b8954940",i,!0,{sourceMap:!1,shadowMode:!1})},cad4:function(e,t,a){"use strict";a.r(t);var i=a("801d"),n=a.n(i);for(var r in i)"default"!==r&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},ccde:function(e,t,a){var i=a("24fb");t=i(!1),t.push([e.i,".waterfalls-box[data-v-66354997]{position:relative;width:100%;overflow:hidden}.waterfalls-box .waterfalls-list[data-v-66354997]{width:calc((100% - var(--offset) * (var(--cols) - 1)) / var(--cols));position:absolute;background-color:#fff;border-radius:6px;left:calc(-50% - var(--offset))}.waterfalls-box .waterfalls-list .waterfalls-list-image[data-v-66354997]{width:100%;will-change:transform;border-radius:6px 6px 0 0;display:block}.waterfalls-box .waterfalls-list .waterfalls-list-image.single[data-v-66354997]{border-radius:6px}",""]),e.exports=t},d599:function(e,t,a){"use strict";a.r(t);var i=a("7b22"),n=a("cad4");for(var r in n)"default"!==r&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("7793");var s,o=a("f0c5"),u=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"108ef0f0",null,!1,i["a"],s);t["default"]=u.exports},e754:function(e,t,a){var i=a("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";.page[data-v-108ef0f0]{z-index:0;height:100vh}\n/* 起到固定的作用 ,从而解决原页面触摸穿透的问题*/.prevent[data-v-108ef0f0]{width:100%;height:100%;\n  /*自动回到顶部*/position:fixed;top:0;left:0;overflow:hidden}\n/* 遮罩样式 */.shade[data-v-108ef0f0]{width:100%;height:100%;position:fixed;top:0;left:0;z-index:98}.popup-base[data-v-108ef0f0]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;height:%?950?%;padding-bottom:62px;position:fixed;left:0;bottom:0;width:100%;border-top-left-radius:3%;border-top-right-radius:3%;z-index:99}.popup-base uni-scroll-view[data-v-108ef0f0]{height:%?850?%}.popup-close[data-v-108ef0f0]{position:absolute;top:%?30?%;left:%?30?%;font-size:%?39?%;text-align:center;font-weight:700;z-index:99}.popup-title[data-v-108ef0f0]{margin-top:%?15?%;line-height:%?60?%;font-size:%?28?%;padding:%?5?% 0;text-align:center;font-weight:700}.popup-content[data-v-108ef0f0]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;padding:%?20?%;max-height:%?850?%}.popup-content-box[data-v-108ef0f0]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;align-items:center;width:100%}.popup-qrcode-image[data-v-108ef0f0]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;width:%?390?%;height:%?500?%;overflow:hidden;border-radius:%?50?%}.popup-meeting-image[data-v-108ef0f0]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;width:%?500?%;height:%?390?%;overflow:hidden;border-radius:%?50?%}.popup-content-text[data-v-108ef0f0]{font-size:%?26?%;color:#333;padding-top:5px;padding-bottom:10px}',""]),e.exports=t}}]);