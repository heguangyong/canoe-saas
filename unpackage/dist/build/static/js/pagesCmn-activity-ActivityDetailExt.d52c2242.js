(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesCmn-activity-ActivityDetailExt"],{"0c08":function(t,e,i){"use strict";var a=i("4ea4");i("4160"),i("ac1f"),i("1276"),i("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("96cf");var n=a(i("1da1")),s=a(i("5530")),r=i("2f62"),c=a(i("6ac9")),o=a(i("d3b3")),u={components:{"uni-popup":c.default},data:function(){return{isUps:!1,activity:{_id:"",qrcode:"",content:""}}},onLoad:function(t){var e=this;if(t.id)e.activity._id=t.id,e.getDetail();else if(t.scene){e.paramsStr+="scene="+t.scene;var i={},a=decodeURIComponent(t.scene).split("&");a.forEach((function(t){var a=t.split("=");i[a[0]]=a[1],"qrcode"==a[0]&&(e.card.qrcode=a[1])})),e.getDetailByQrcode()}e.user.userInfo.recipient={}},onShareAppMessage:function(t){if("button"===t.from){var e=t.target.dataset.activity;return{title:e.title,imageUrl:e.cover||"",path:"/pagesCmn/activity/ShareActivityDetail?id="+e._id,success:function(t){uni.showToast({icon:"success",title:"分享成功"})}}}},computed:(0,s.default)({},(0,r.mapState)(["user"])),methods:(0,s.default)((0,s.default)({},(0,r.mapMutations)(["needWxAuth","wxAuth","updateUser"])),{},{ShareActivityDetail:function(){uni.showShareMenu({withShareTicket:!0})},getDetail:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,a=null,e.next=4,o.default.callFunction({name:"web",data:{$url:"getActivityDetail",id:i.activity._id}});case 4:a=e.sent,i.activity=JSON.parse(a.result.data),n=i.activity.sign_up.date+" "+i.activity.sign_up.time,s=i.activity.sign_in.date+" "+i.activity.sign_in.time,i.activity.sign_up=n,i.activity.sign_in=s;case 10:case"end":return e.stop()}}),e)})))()},getDetailByQrcode:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,a={},e.next=4,o.default.callFunction({name:"web",data:{$url:"getActivityDetailByQrcode",qrcode:i.activity.qrcode}});case 4:a=e.sent,i.activity=JSON.parse(a.result.data);case 6:case"end":return e.stop()}}),e)})))()},goWebLogin:function(){uni.navigateTo({url:"/pages/my/WebLogin"})},startTalk:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t,a={_id:i.activity.card_id,name:i.activity.name,avatar:i.activity.avatar},!i.needWxAuth(a)){e.next=5;break}return i.goWebLogin(),e.abrupt("return");case 5:uni.navigateTo({url:"/pagesSys/site/WebService"});case 6:case"end":return e.stop()}}),e)})))()},goHome:function(){uni.reLaunch({url:"/pages/site/home"})},tapJoin:function(){var t=this,e={_id:t.activity.card_id,name:t.activity.name,avatar:t.activity.avatar};t.needWxAuth(e)?t.goWebLogin():t.$nextTick((function(){t.isUps=!0,t.user.userInfo.recipient.name=t.user.userInfo.nickName,t.$refs["showPopup"].open()}))},getPhoneNumber:function(t){var e=this;return(0,n.default)(regeneratorRuntime.mark((function i(){var a,n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=e,i.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"getPhone",cloudId:t.detail.cloudID}});case 3:n=i.sent,0==n.result.code&&(wx.showToast({title:"授权成功",success:function(){}}),a.user.userInfo.recipient.phone=n.result.data.phoneNumber,a.$forceUpdate());case 5:case"end":return i.stop()}}),i)})))()},cancel:function(t){this.$refs["show"+t].close()},change:function(t){t.show?this.isUps=!0:this.isUps=!1},inputName:function(t){this.user.userInfo.recipient.name=t.detail.value},inputPhone:function(t){this.user.userInfo.recipient.phone=t.detail.value},inputRemark:function(t){this.user.userInfo.recipient.remark=t.detail.value},submitOrder:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,a="活动报名",n=[{id:i.activity._id,num:1,state:"enrolled",detail:i.activity}],s={},s.seller_avatar=i.activity.avatar,s.seller_name=i.activity.name,s.user_id=i.user._id,s.avatar=i.user.userInfo.avatarUrl,s.name=i.user.userInfo.nickName,s.items=n,s.recipient=i.user.userInfo.recipient,s.activity_id=i.activity._id,s.item_num=1,s.is_finished=!1,s.order_type="activity",e.next=17,o.default.callFunction({name:"cmn",data:{$url:"processOrder",order:s}});case 17:uni.showToast({icon:"success",title:a+"成功"}),i.$refs["showPopup"].close(),setTimeout((function(){uni.navigateTo({url:"/pages/my/ActivityOrderList"})}),1e3);case 20:case"end":return e.stop()}}),e)})))()},goQrcode:function(t){uni.navigateTo({url:"/pagesCmn/activity/ActivityQrcode?id="+t})}})};e.default=u},"0e3c":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return a}));var a={uniPopup:i("6ac9").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{class:1==t.isUps?"prevent":""},[i("cu-custom",{attrs:{isBack:!0}},[i("template",{attrs:{slot:"backText"},slot:"backText"},[t._v("返回")]),i("template",{attrs:{slot:"content"},slot:"content"},[t._v("活动详情")])],2),i("v-uni-view",{staticClass:"page bg-white"},[i("v-uni-view",{staticClass:"cu-card \ufeffcase"},[i("v-uni-view",{staticClass:"cu-item \ufeffshadow solid-bottom"},[i("v-uni-view",{staticClass:"image"},[i("v-uni-image",{attrs:{src:t.activity.cover,mode:"aspectFill"}}),i("v-uni-view",{staticClass:"cu-bar bg-shadeBottom"},[i("v-uni-text",{staticClass:"text-cut"},[t._v(t._s(t.activity.content))])],1)],1),i("v-uni-view",{staticClass:"cu-list menu-avatar"},[i("v-uni-view",{staticClass:"cu-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goQrcode(t.activity._id)}}},[i("v-uni-view",{staticClass:"cu-avatar round lg"},[i("v-uni-image",{staticClass:"cu-avatar round lg",attrs:{src:t.activity.avatar,mode:"aspectFill"}})],1),i("v-uni-view",{staticClass:"content flex-sub"},[i("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(t.activity.title))]),i("v-uni-view",{staticClass:"text-gray text-sm flex justify-between"},[t._v("报名截止日期："+t._s(t.activity.sign_up))])],1),i("v-uni-view",{staticClass:"action"},[i("v-uni-text",{staticClass:"cuIcon-qr_code",staticStyle:{"font-size":"36px"}})],1)],1)],1)],1)],1),t.activity.video.length>0?i("v-uni-view",[i("v-uni-video",{attrs:{src:t.activity.video,autoplay:!0,loop:!0,muted:!0,"show-play-btn":!1,controls:!1,objectFit:"cover"}})],1):t._e(),t._l(t.activity.carousels,(function(t,e){return i("v-uni-view",{key:e},[i("v-uni-image",{attrs:{src:t,mode:"aspectFill"}})],1)})),i("v-uni-view",{staticClass:"cu-tabbar-height"}),i("v-uni-view",{staticClass:"cu-tabbar-height"})],2),t.isUps?t._e():i("v-uni-view",{staticClass:"cu-bar bg-white tabbar border shop foot"},[i("v-uni-button",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goHome.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cuIcon-home"}),t._v("首页")],1),i("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.startTalk.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cuIcon-message"}),t._v("咨询")],1),t.activity.is_open?i("v-uni-view",{staticClass:"bg-green submit text-lg",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.tapJoin.apply(void 0,arguments)}}},[t._v("立即报名")]):i("v-uni-view",{staticClass:"bg-gray submit text-lg"},[t._v("报名已终止")])],1),t.isUps?i("v-uni-view",{staticClass:"shade"}):t._e(),i("uni-popup",{ref:"showPopup",attrs:{type:"bottom"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.change.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"popup bg-white"},[i("v-uni-text",{staticClass:"cuIcon-close popup-close",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.cancel("Popup")}}}),i("v-uni-text",{staticClass:"popup-title"},[t._v("报名")]),i("v-uni-view",{staticClass:"popup-content"},[i("v-uni-scroll-view",{staticClass:"ups-height",attrs:{"scroll-y":"true"}},[i("v-uni-view",[i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v("姓名")]),i("v-uni-input",{staticClass:"text-left",attrs:{placeholder:"报名人姓名",value:t.user.userInfo.recipient.name},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.inputName.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v("电话")]),i("v-uni-input",{staticClass:"text-left",attrs:{placeholder:"联系电话",type:"tel",value:t.user.userInfo.recipient.phone},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.inputPhone.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v("备注")]),i("v-uni-input",{staticClass:"text-left",attrs:{placeholder:"有啥想说的",value:t.user.userInfo.recipient.remark},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.inputRemark.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"cu-bar solid-bottom margin-top-xxs radius"}),i("v-uni-view",{staticClass:"cu-bar btn-group  foot bg-white"},[i("v-uni-button",{staticClass:"cu-btn   round line-grey",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitOrder.apply(void 0,arguments)}}},[t._v("确认报名")])],1)],1)],1)],1)],1)],1)],1)},s=[]},"1b9e":function(t,e,i){"use strict";i.r(e);var a=i("0c08"),n=i.n(a);for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},"9e06":function(t,e,i){"use strict";i.r(e);var a=i("0e3c"),n=i("1b9e");for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("ae43");var r,c=i("f0c5"),o=Object(c["a"])(n["default"],a["b"],a["c"],!1,null,"98ef938a",null,!1,a["a"],r);e["default"]=o.exports},a248:function(t,e,i){var a=i("e28d");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("75b8ea6a",a,!0,{sourceMap:!1,shadowMode:!1})},ae43:function(t,e,i){"use strict";var a=i("a248"),n=i.n(a);n.a},e28d:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".page[data-v-98ef938a]{z-index:0;height:100vh}.screen-swiper[data-v-98ef938a]{min-height:%?766?%}uni-video[data-v-98ef938a]{width:%?750?%}uni-image[data-v-98ef938a]{width:%?750?%}.popup[data-v-98ef938a]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;height:%?950?%;padding-bottom:62px;position:fixed;left:0;bottom:0;width:100%;z-index:95;border-top-left-radius:3%;border-top-right-radius:3%}.popup-close[data-v-98ef938a]{position:absolute;top:%?30?%;left:%?30?%;font-size:%?39?%;text-align:center;font-weight:700;z-index:199}.popup-title[data-v-98ef938a]{margin-top:%?15?%;line-height:%?60?%;font-size:%?28?%;padding:%?5?% 0;text-align:center;font-weight:700}.popup-content[data-v-98ef938a]{\ndisplay:-webkit-box;display:-webkit-flex;display:flex;\n-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;padding:5px;max-height:%?950?%}\n/* 起到固定的作用 ,从而解决原页面触摸穿透的问题*/.prevent[data-v-98ef938a]{width:100%;height:100%;\n\t/*自动回到顶部*/\n\t/*position: fixed;*/top:0;left:0;overflow:hidden}\n/* 遮罩样式 */.shade[data-v-98ef938a]{width:100%;height:100%;position:fixed;top:0;left:0;z-index:90}.ups-height[data-v-98ef938a]{height:%?850?%;position:fixed;left:0;bottom:0;z-index:99}",""]),t.exports=e}}]);