(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesCmn-product-ProductDetailExt"],{"111c":function(t,e,i){"use strict";(function(t){var a=i("4ea4");i("4160"),i("b680"),i("acd8"),i("ac1f"),i("1276"),i("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("96cf");var n=a(i("1da1")),r=a(i("5530")),s=i("2f62"),u=a(i("6ac9")),c=a(i("aa9a")),o=a(i("d3b3")),d={components:{"uni-popup":u.default,"ups-stepper":c.default},data:function(){return{isLoad:!1,isUps:!1,product:{_id:"",qrcode:"",detail:{content:"",images:[],imgList:[],videos:[]},num:1},priceAndUnitName:"",authBizInfo:{}}},onLoad:function(t){var e=this;if(t.id)e.product._id=t.id,e.getDetail();else if(t.scene){e.paramsStr+="scene="+t.scene;var i={},a=decodeURIComponent(t.scene).split("&");a.forEach((function(t){var a=t.split("=");i[a[0]]=a[1],"qrcode"==a[0]&&(e.card.qrcode=a[1])})),e.getDetailByQrcode()}e.authBizInfo={_id:e.product.card_id,name:e.product.name,avatar:e.product.avatar},e.needWxAuth(e.authBizInfo)},onReady:function(){wx.setNavigationBarTitle({title:"产品详情"})},onShareAppMessage:function(t){if("button"===t.from){var e=t.target.dataset.product;return{title:e.title,imageUrl:e.cover||"",path:"/pagesCmn/product/ShareProductDetail?id="+e._id,success:function(t){uni.showToast({icon:"success",title:"分享成功"})}}}},computed:(0,r.default)({},(0,s.mapState)(["needAuthFlag","user"])),methods:(0,r.default)((0,r.default)({},(0,s.mapMutations)(["needWxAuth","wxAuth","updateUser"])),{},{ShareProductDetail:function(){uni.showShareMenu({withShareTicket:!0})},getDetail:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,a=null,e.next=4,o.default.callFunction({name:"web",data:{$url:"getProductDetail",id:i.product._id}});case 4:a=e.sent,i.product=JSON.parse(a.result.data),i.product.num=1,i.priceAndUnitName="¥ "+parseFloat(i.product.price).toFixed(2)+i.product.unit_name;case 8:case"end":return e.stop()}}),e)})))()},getDetailByQrcode:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,a={},e.next=4,o.default.callFunction({name:"web",data:{$url:"getProductDetailByQrcode",qrcode:i.product.qrcode}});case 4:a=e.sent,i.product=JSON.parse(a.result.data),i.product.num=1,i.priceAndUnitName="¥ "+parseFloat(i.product.price).toFixed(2)+i.product.unit_name;case 8:case"end":return e.stop()}}),e)})))()},previewImage:function(e){var i=this;t("log",e," at pagesCmn/product/ProductDetailExt.vue:310");var a="",n=[];for(var r in a=e.currentTarget.dataset.src,i.product.carouse)n.push(i.product.carouse[r]);for(var s=0;s<i.product.detail.images.length;s++)n.push(i.product.detail.images[s]);wx.previewImage({current:a,urls:n})},goWebLogin:function(){uni.navigateTo({url:"/pages/my/WebLogin"})},startTalk:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t,!i.needAuthFlag){e.next=4;break}return i.wxAuth(i.authBizInfo),e.abrupt("return");case 4:uni.navigateTo({url:"/pagesSys/site/WebService"});case 5:case"end":return e.stop()}}),e)})))()},goMy:function(){uni.reLaunch({url:"/pages/my/home"})},goWishOrderList:function(){var t=this;t.needAuthFlag?t.wxAuth(t.authBizInfo):uni.navigateTo({url:"/pagesSys/my/WishOrderList"})},showWishProduct:function(){var t=this;t.needAuthFlag?t.wxAuth(t.authBizInfo):t.$nextTick((function(){t.isUps=!0,t.$refs["showPopupWishProduct"].open()}))},showBuyProduct:function(){var t=this;t.needAuthFlag?t.wxAuth(t.authBizInfo):t.$nextTick((function(){t.isUps=!0,t.$refs["showPopupBuyProduct"].open()}))},cancel:function(t){this.$refs["show"+t].close()},change:function(t){t.show?this.isUps=!0:this.isUps=!1},stepper:function(e){t("log",e," at pagesCmn/product/ProductDetailExt.vue:403"),e.val>0&&(this.product.num=e.val)},submitOrder:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,a=[{id:i.product._id,num:i.product.num,cover:i.product.carouse[0],title:i.product.title,content:i.product.detail.content,price:i.product.price,unit_name:i.product.unit_name,new_price:i.product.price,discount:10}],n={},n.seller_avatar=i.product.avatar,n.seller_name=i.product.name,n.user_id=i.user._id,n.avatar=i.user.userInfo.avatarUrl,n.name=i.user.userInfo.nickName,n.items=a,n.order_state="wish",i.isLoad=!0,e.next=13,wx.cloud.callFunction({name:"cmn",data:{$url:"addWishOrder",order:n}});case 13:i.isLoad=!1,uni.showToast({icon:"success",title:"加入购物袋成功"}),i.$refs["showPopupWishProduct"].close(),setTimeout((function(){uni.navigateTo({url:"/pagesSys/my/WishOrderList"})}),1e3);case 17:case"end":return e.stop()}}),e)})))()},placeOrder:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function i(){var a,n,r,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=e,a.isLoad=!0,n=[{id:a.product._id,num:a.product.num,cover:a.product.carouse[0],title:a.product.title,content:a.product.detail.content,price:a.product.price,unit_name:a.product.unit_name,new_price:a.product.price,discount:10}],r={},r.seller_avatar=a.product.avatar,r.seller_name=a.product.name,r.user_id=a.user._id,r.avatar=a.user.userInfo.avatarUrl,r.name=a.user.userInfo.nickName,r.items=n,r.order_state="wish",i.next=13,wx.cloud.callFunction({name:"cmn",data:{$url:"addWishOrder",order:r}});case 13:s=i.sent,a.isLoad=!1,t("log","addWishOrder res",s," at pagesCmn/product/ProductDetailExt.vue:483"),uni.showToast({icon:"success",title:"生成订单成功"}),a.$refs["showPopupBuyProduct"].close(),setTimeout((function(){uni.navigateTo({url:"/pagesSys/my/NeedConfirmOrder?orderIds="+s.result._id})}),1e3);case 19:case"end":return i.stop()}}),i)})))()},goQrcode:function(e){t("log","goQrcode",e," at pagesCmn/product/ProductDetailExt.vue:497"),uni.navigateTo({url:"/pagesCmn/product/ProductQrcode?id="+e})}})};e.default=d}).call(this,i("0de9")["log"])},"115a":function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,'@charset "UTF-8";.page[data-v-a368869c]{z-index:0;height:100vh}uni-video[data-v-a368869c]{width:%?750?%}uni-image[data-v-a368869c]{width:%?750?%}.carousel[data-v-a368869c]{height:%?600?%;position:relative}.carousel uni-swiper[data-v-a368869c]{height:100%}.carousel .image-wrapper[data-v-a368869c]{width:100%;height:100%}.carousel .swiper-item[data-v-a368869c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-content:center;align-content:center;overflow:hidden}.carousel .swiper-item uni-image[data-v-a368869c]{width:100%;height:100%}\n/* 底部分享 */.popup[data-v-a368869c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;height:%?950?%;padding-bottom:62px;position:fixed;left:0;bottom:0;width:100%;z-index:95;border-top-left-radius:3%;border-top-right-radius:3%}.popup-close[data-v-a368869c]{position:absolute;top:%?30?%;left:%?30?%;font-size:%?39?%;text-align:center;font-weight:700;z-index:199}.popup-title[data-v-a368869c]{margin-top:%?15?%;line-height:%?60?%;font-size:%?28?%;padding:%?5?% 0;text-align:center;font-weight:700}.popup-content[data-v-a368869c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;padding:5px;max-height:%?950?%}\n/* 起到固定的作用 ,从而解决原页面触摸穿透的问题*/.prevent[data-v-a368869c]{width:100%;height:100%;\n  /*自动回到顶部*/\n  /*position: fixed;*/top:0;left:0;overflow:hidden}\n/* 遮罩样式 */.shade[data-v-a368869c]{width:100%;height:100%;position:fixed;top:0;left:0;z-index:90}.ups-height[data-v-a368869c]{height:%?850?%;position:fixed;left:0;bottom:0;z-index:99}',""]),t.exports=e},"301f":function(t,e,i){"use strict";i.r(e);var a=i("3a87"),n=i("6bb8");for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);i("a5fc");var s,u=i("f0c5"),c=Object(u["a"])(n["default"],a["b"],a["c"],!1,null,"a368869c",null,!1,a["a"],s);e["default"]=c.exports},"3a87":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return a}));var a={uniPopup:i("6ac9").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{class:1==t.isUps?"prevent":""},[i("v-uni-view",{staticClass:"page bg-white"},[i("v-uni-view",{staticClass:"carousel"},[i("v-uni-swiper",{attrs:{"indicator-dots":!0,circular:"true",duration:"400"}},t._l(t.product.carouse,(function(e,a){return i("v-uni-swiper-item",{key:a,staticClass:"swiper-item",attrs:{"data-src":e},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.previewImage.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"image-wrapper"},[i("v-uni-image",{attrs:{src:e,mode:"aspectFill"}})],1)],1)})),1)],1),t.product.detail.content.length>0?i("v-uni-textarea",{staticClass:"text-box font40 bg-white width100 padding-sm solid text-cut",staticStyle:{height:"150rpx"},attrs:{readonly:!0,disabled:!0,"scroll-y":"true",maxlength:"200"},model:{value:t.product.detail.content,callback:function(e){t.$set(t.product.detail,"content",e)},expression:"product.detail.content"}}):t._e(),i("v-uni-view",{staticClass:"cu-list menu-avatar"},[i("v-uni-view",{staticClass:"cu-item",staticStyle:{height:"110rpx","background-color":"gainsboro"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goQrcode(t.product._id)}}},[i("v-uni-view",{staticClass:"cu-avatar round "},[i("v-uni-image",{staticClass:"cu-avatar round ",attrs:{src:t.product.avatar,mode:"aspectFill"}})],1),i("v-uni-view",{staticClass:"content flex-sub"},[i("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(t.product.title))]),i("v-uni-view",{staticClass:"text-gray text-sm flex justify-between"},[t._v("价格："+t._s(t.priceAndUnitName))])],1),i("v-uni-view",{staticClass:"action"},[i("v-uni-text",{staticClass:"cuIcon-qr_code",staticStyle:{"font-size":"36px"}})],1)],1)],1),t.product.detail.videos.length>0?i("v-uni-view",[i("v-uni-video",{attrs:{src:t.product.detail.videos[0],objectFit:"contain",controls:!0,"show-mute-btn":!0,muted:!0}})],1):t._e(),t._l(t.product.detail.images,(function(e,a){return i("v-uni-image",{key:a,staticStyle:{"vertical-align":"middle"},attrs:{src:e,"data-src":e,mode:"widthFix"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.previewImage.apply(void 0,arguments)}}})})),i("v-uni-view",{staticClass:"cu-tabbar-height"}),i("v-uni-view",{staticClass:"cu-tabbar-height"})],2),t.isUps?i("v-uni-view",{staticClass:"shade"}):t._e(),i("uni-popup",{ref:"showPopupWishProduct",attrs:{type:"bottom"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.change.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"popup bg-white"},[i("v-uni-text",{staticClass:"cuIcon-close popup-close",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.cancel("PopupWishProduct")}}}),i("v-uni-text",{staticClass:"popup-title"},[t._v("加入购物袋")]),i("v-uni-view",{staticClass:"popup-content"},[i("v-uni-scroll-view",{staticClass:"ups-height",attrs:{"scroll-y":"true"}},[i("v-uni-view",{staticClass:"cu-card article",staticStyle:{width:"100%"}},[i("v-uni-view",{staticClass:"cu-item shadow",staticStyle:{margin:"10rpx",padding:"20rpx 0"}},[i("v-uni-view",{staticClass:"content"},[i("v-uni-image",{staticClass:"bg-gray",attrs:{src:t.product.cover,mode:"aspectFill"}}),i("v-uni-view",{staticClass:"desc"},[i("v-uni-view",{staticClass:"text-content"},[t._v(t._s(t.product.title)),i("v-uni-text",{staticClass:"text-cut text-sm"},[t._v(t._s(t.product.detail.content))])],1),i("v-uni-view",{staticClass:"flex margin-top-sm \ufeffjustify-between"},[i("v-uni-view",{staticClass:"cu-capsule radius "},[i("v-uni-text",{staticClass:"text-red"},[t._v(t._s(t.priceAndUnitName))])],1),i("v-uni-view",[i("ups-stepper",{attrs:{label:t.product._id,max:100,val:t.product.num,step:1,min:1},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.stepper.apply(void 0,arguments)}}})],1)],1)],1)],1)],1)],1),i("v-uni-view",[i("v-uni-view",{staticClass:"cu-bar solid-bottom margin-top-xxs radius"}),i("v-uni-view",{staticClass:"cu-bar btn-group  foot bg-white"},[i("v-uni-button",{staticClass:"cu-btn   round line-grey",attrs:{disabled:t.isLoad},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitOrder.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],1)],1)],1),i("uni-popup",{ref:"showPopupBuyProduct",attrs:{type:"bottom"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.change.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"popup bg-white"},[i("v-uni-text",{staticClass:"cuIcon-close popup-close",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.cancel("PopupBuyProduct")}}}),i("v-uni-text",{staticClass:"popup-title"},[t._v("购买")]),i("v-uni-view",{staticClass:"popup-content"},[i("v-uni-scroll-view",{staticClass:"ups-height",attrs:{"scroll-y":"true"}},[i("v-uni-view",{staticClass:"cu-card article",staticStyle:{width:"100%"}},[i("v-uni-view",{staticClass:"cu-item shadow",staticStyle:{margin:"10rpx",padding:"20rpx 0"}},[i("v-uni-view",{staticClass:"content"},[i("v-uni-image",{staticClass:"bg-gray",attrs:{src:t.product.cover,mode:"aspectFill"}}),i("v-uni-view",{staticClass:"desc"},[i("v-uni-view",{staticClass:"text-content"},[t._v(t._s(t.product.title)),i("v-uni-text",{staticClass:"text-cut text-sm"},[t._v(t._s(t.product.detail.content))])],1),i("v-uni-view",{staticClass:"flex margin-top-sm \ufeffjustify-between"},[i("v-uni-view",{staticClass:"cu-capsule radius "},[i("v-uni-text",{staticClass:"text-red"},[t._v(t._s(t.priceAndUnitName))])],1),i("v-uni-view",[i("ups-stepper",{attrs:{label:t.product._id,max:100,val:t.product.num,step:1,min:1},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.stepper.apply(void 0,arguments)}}})],1)],1)],1)],1)],1)],1),i("v-uni-view",[i("v-uni-view",{staticClass:"cu-bar solid-bottom margin-top-xxs radius"}),i("v-uni-view",{staticClass:"cu-bar btn-group  foot bg-white"},[i("v-uni-button",{staticClass:"cu-btn   round line-grey",attrs:{disabled:t.isLoad},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.placeOrder.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],1)],1)],1)],1)},r=[]},"3ba6":function(t,e,i){var a=i("115a");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("5f29aab6",a,!0,{sourceMap:!1,shadowMode:!1})},"69e4":function(t,e,i){"use strict";i.r(e);var a=i("8f0e"),n=i.n(a);for(var r in a)"default"!==r&&function(t){i.d(e,t,(function(){return a[t]}))}(r);e["default"]=n.a},"6bb8":function(t,e,i){"use strict";i.r(e);var a=i("111c"),n=i.n(a);for(var r in a)"default"!==r&&function(t){i.d(e,t,(function(){return a[t]}))}(r);e["default"]=n.a},"8f0e":function(t,e,i){"use strict";i("a9e3"),i("b680"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={data:function(){return{stepperNum:0,stepperCacheNum:0}},name:"feng-stepper",props:{val:{type:[String,Number],default:0},min:{type:[String,Number],default:0},max:{type:[String,Number],default:0},step:{type:Number,default:1},label:{type:String,default:""},disabled:{type:Boolean,default:!1},active:{type:String,default:"#FFF"},unactive:{type:String,default:"#ddd"}},created:function(){this.stepperNum=this.val,this.stepperCacheNum=this.val},watch:{val:function(t){this.stepperNum=this.val}},methods:{less:function(){this.stepperNum<=this.min?this.stepperNum=this.min:this.stepperNum-=Math.ceil(10*this.step)/10,this.stepperCacheNum=Number(this.stepperNum.toFixed(1)),this.emit(this.stepperCacheNum,this.label,"less")},add:function(){this.stepperNum>=this.max?this.stepperNum=this.max:this.stepperNum+=Math.ceil(10*this.step)/10,this.stepperCacheNum=Number(this.stepperNum.toFixed(1)),this.emit(this.stepperCacheNum,this.label,"add")},emit:function(t,e,i){Number(t.toFixed(1))>this.max&&(t=this.max,this.stepperCacheNum=this.max),Number(t.toFixed(1))<this.min&&(t=this.min,this.stepperCacheNum=this.min),this.$emit("change",{val:t,label:e,type:i})},iptVal:function(t){Number(t.detail.value)>this.max?this.stepperNum=this.max:this.stepperNum}}};e.default=a},9226:function(t,e,i){"use strict";var a=i("d824"),n=i.n(a);n.a},a5fc:function(t,e,i){"use strict";var a=i("3ba6"),n=i.n(a);n.a},aa9a:function(t,e,i){"use strict";i.r(e);var a=i("ab30"),n=i("69e4");for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);i("9226");var s,u=i("f0c5"),c=Object(u["a"])(n["default"],a["b"],a["c"],!1,null,"5b422df3",null,!1,a["a"],s);e["default"]=c.exports},ab30:function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return a}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticStyle:{display:"inline-block"}},[i("v-uni-view",{staticClass:"feng-stepper"},[t.stepperCacheNum>0?i("v-uni-view",{staticClass:"step-cr",style:t.stepperCacheNum<=t.min?"color:"+t.unactive+";":"color:"+t.active+";",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.less.apply(void 0,arguments)}}},[t._v("-")]):t._e(),t.stepperCacheNum>0?i("v-uni-input",{attrs:{type:"number",value:t.stepperCacheNum,disabled:!0},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.iptVal.apply(void 0,arguments)}}}):t._e(),i("v-uni-view",{staticClass:"step-cr",style:t.stepperCacheNum>=t.max?"color:"+t.unactive+";":"color:"+t.active+";",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.add.apply(void 0,arguments)}}},[t._v("+")])],1)],1)},r=[]},d7ea:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".feng-stepper[data-v-5b422df3]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background-color:#eee;border-radius:%?25?%}.feng-stepper .step-cr[data-v-5b422df3]{display:inline-block;font-size:%?32?%;line-height:%?44?%;border-radius:50%;height:%?50?%;width:%?50?%;background-color:#d3d3d3;text-align:center}.feng-stepper uni-input[data-v-5b422df3]{width:%?50?%;text-align:center;height:%?50?%}",""]),t.exports=e},d824:function(t,e,i){var a=i("d7ea");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("d81bf4ba",a,!0,{sourceMap:!1,shadowMode:!1})}}]);