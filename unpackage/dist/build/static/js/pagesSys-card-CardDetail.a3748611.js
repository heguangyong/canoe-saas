(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesSys-card-CardDetail"],{"7b2b":function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,".page[data-v-12c1cc97]{z-index:0;height:100vh}",""]),t.exports=e},"8c9b":function(t,e,a){"use strict";a.r(e);var n=a("d65f"),s=a("bf78");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("bacc");var r,u=a("f0c5"),c=Object(u["a"])(s["default"],n["b"],n["c"],!1,null,"12c1cc97",null,!1,n["a"],r);e["default"]=c.exports},bacc:function(t,e,a){"use strict";var n=a("e3c4"),s=a.n(n);s.a},bf78:function(t,e,a){"use strict";a.r(e);var n=a("d004"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a},d004:function(t,e,a){"use strict";var n=a("4ea4");a("4160"),a("d3b7"),a("159b"),a("ddb0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("96cf");var s=n(a("1da1")),i=n(a("5530")),r=a("2f62"),u=n(a("7fc7")),c=n(a("7684")),o=n(a("d3b3")),d={components:{"ups-card":u.default,"uni-rate":c.default},data:function(){return{card:{name:"",remark:""},accounts:[],modalName:null}},onReady:function(){this.getDetail()},onShareAppMessage:function(t){return t.from,{title:"这是"+this.card.name+"的名片，请惠存。",imageUrl:this.card.cover||"",path:"/pagesSys/card/ShareCardDetail?id="+this.card._id,success:function(t){}}},computed:(0,i.default)({},(0,r.mapState)(["user"])),methods:(0,i.default)((0,i.default)({},(0,r.mapMutations)(["updateUser"])),{},{getDetail:function(){var t=this;return(0,s.default)(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t,!a.user._id){e.next=10;break}return n={},e.next=5,o.default.callFunction({name:"web",data:{$url:"getCardDetailByUserId",userId:a.user._id}});case 5:n=e.sent,a.card=JSON.parse(n.result.data),a.cardId=a.card._id,a.accounts=[],a.user.userInfo.accounts.forEach((function(t){t.is_forbidden||a.accounts.push(t)}));case 10:case"end":return e.stop()}}),e)})))()},go:function(t){uni.navigateTo({url:t.url})},editCard:function(){return(0,s.default)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:uni.navigateTo({url:"/pagesSys/card/CardInput"});case 1:case"end":return t.stop()}}),t)})))()},goMy:function(){uni.reLaunch({url:"/pages/my/home"})},showAuthCode:function(){var t=this;return(0,s.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.card.phone&&11==t.card.phone.length){e.next=4;break}return uni.showToast({icon:"none",title:"请先完善手机号"}),setTimeout((function(){uni.navigateTo({url:"/pagesSys/card/CardInput"})}),1e3),e.abrupt("return");case 4:uni.showModal({icon:"none",title:"授权码",content:t.card.auth_code,cancelText:"更新",confirmText:"确认",success:function(e){if(e.cancel){t.card.auth_code="";for(var a=4,n=[0,1,2,3,4,5,6,7,8,9],s=0;s<a;s++){var i=Math.floor(9*Math.random());t.card.auth_code+=n[i]}t.$forceUpdate(),o.default.callFunction({name:"sys",data:{$url:"updateCard",card:t.card}}),t.showAuthCode()}}});case 5:case"end":return e.stop()}}),e)})))()},showModal:function(){this.modalName="bizCardModal"},hideModal:function(){this.modalName=null},bizCardChange:function(t){var e=this;return(0,s.default)(regeneratorRuntime.mark((function a(){var n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e,s=t.detail.value,a.t0=regeneratorRuntime.keys(n.user.userInfo.sites);case 3:if((a.t1=a.t0()).done){a.next=14;break}if(i=a.t1.value,s!=n.user.userInfo.sites[i].bizCardId){a.next=12;break}return n.user.userInfo.bizCardId=n.user.userInfo.sites[i].bizCardId,n.user.userInfo.bizCardName=n.user.userInfo.sites[i].bizCardName,n.user.userInfo.bizCardAvatar=n.user.userInfo.sites[i].bizCardAvatar,n.user.userInfo.role=n.user.userInfo.sites[i].role,n.user.userInfo.accounts=n.user.userInfo.sites[i].accounts,a.abrupt("break",14);case 12:a.next=3;break;case 14:return n.updateUser(n.user),a.next=17,wx.cloud.callFunction({name:"sys",data:{$url:"updateUserInfo",id:n.user._id,userInfo:n.user.userInfo}});case 17:n.getDetail();case 18:case"end":return a.stop()}}),a)})))()}})};e.default=d},d65f:function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}));var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("cu-custom",{attrs:{isBack:!0}},[a("template",{attrs:{slot:"backText"},slot:"backText"},[t._v("返回")]),a("template",{attrs:{slot:"content"},slot:"content"},[t._v("我的名片")])],2),a("ups-card",{attrs:{card:t.card}}),a("v-uni-view",{staticClass:"cu-list menu-avatar"},[a("v-uni-view",{staticClass:"cu-item  card-radius margin-sm bg-white.light shadow",staticStyle:{"background-color":"#ececec",height:"110rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showModal.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cu-avatar round"},[a("v-uni-image",{staticClass:"cu-avatar round",attrs:{src:t.user.userInfo.bizCardAvatar}})],1),a("v-uni-view",{staticClass:"content"},[a("v-uni-view",{staticClass:"text-df text-bold"},[t._v(t._s(t.user.userInfo.bizCardName)),a("v-uni-text",{staticClass:"text-abc"})],1)],1),t.user.userInfo.sites&&t.user.userInfo.sites.length>1?a("v-uni-view",{staticClass:"action"},[a("v-uni-view",{staticClass:"margin-right text-grey text-bold cuIcon-moreandroid",staticStyle:{"font-size":"20px"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showModal.apply(void 0,arguments)}}})],1):t._e()],1),t._l(t.accounts,(function(e,n){return a("v-uni-view",{key:n,staticClass:"cu-item  card-radius margin-sm shadow bg-white.light",staticStyle:{height:"110rpx"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.go(e)}}},[a("v-uni-view",{staticClass:"cu-avatar bg-white"},[a("v-uni-image",{staticClass:"cu-avatar "}),a("v-uni-text",{staticClass:"text-grey",class:"cuIcon-"+e.name,staticStyle:{"font-size":"36px"}})],1),a("v-uni-view",{staticClass:"content"},[a("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(e.title)),a("v-uni-text",{staticClass:"text-abc"})],1),a("v-uni-view",{staticClass:"text-gray text-sm text-cut"},[t._v(t._s(e.remark))])],1)],1)}))],2),a("v-uni-view",{staticClass:"cu-modal",class:"bizCardModal"==t.modalName?"show":"",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideModal.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cu-dialog",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[a("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[a("v-uni-view",{staticClass:"content"},[t._v("切换企业")]),a("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideModal.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"cuIcon-close text-red"})],1)],1),a("v-uni-radio-group",{staticClass:"block",on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.bizCardChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cu-list menu text-left"},t._l(t.user.userInfo.sites,(function(e,n){return a("v-uni-view",{key:n,staticClass:"cu-item"},[a("v-uni-label",{staticClass:"flex justify-between align-center flex-sub"},[a("v-uni-view",{staticClass:"flex-sub"},[t._v(t._s(e.bizCardName))]),a("v-uni-radio",{staticClass:"round",class:e.bizCardId==t.user.userInfo.bizCardId?"checked":"",attrs:{checked:e.bizCardId==t.user.userInfo.bizCardId,value:e.bizCardId}})],1)],1)})),1)],1)],1)],1),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"cu-bar bg-white tabbar border shop foot"},[a("v-uni-button",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goMy.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cuIcon-my"}),t._v("我的")],1),a("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showAuthCode.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"cuIcon-lock"}),t._v("授权码")],1),a("v-uni-view",{staticClass:"bg-white submit text-lg"})],1)],1)},i=[]},e3c4:function(t,e,a){var n=a("7b2b");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=a("4f06").default;s("4b38e61a",n,!0,{sourceMap:!1,shadowMode:!1})}}]);