(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesMgt-BizMsgList"],{"300d":function(e,t,a){var r=a("24fb");t=r(!1),t.push([e.i,"uni-page-body[data-v-34a68318]{padding-top:%?100?%}.card-radius[data-v-34a68318]{border-radius:%?10?%}\n\n/* 起到固定的作用 ,从而解决原页面触摸穿透的问题*/.prevent[data-v-34a68318]{width:100%;height:100%;\n    /*自动回到顶部*/\n    /*position: fixed;*/top:0;left:0;overflow:hidden}\n\n/* 遮罩样式 */.shade[data-v-34a68318]{width:100%;height:100%;position:fixed;top:0;left:0;z-index:90}.card-popup[data-v-34a68318]{\ndisplay:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;\nborder-top-left-radius:3%;border-top-right-radius:3%}.card-popup-content[data-v-34a68318]{\ndisplay:-webkit-box;display:-webkit-flex;display:flex;\n-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;padding:5px;max-height:%?850?%}.card-popup-btn[data-v-34a68318]{height:%?90?%;line-height:%?90?%;font-size:14px;border-top-color:#dadada;border-top-width:1px;border-top-style:solid;text-align:center;color:#666}.remove-popup-btn[data-v-34a68318]{height:%?90?%;line-height:%?90?%;font-size:14px;text-align:center;color:#666}",""]),e.exports=t},"6d45":function(e,t,a){"use strict";a.r(t);var r=a("a9ed"),n=a.n(r);for(var i in r)"default"!==i&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t["default"]=n.a},7020:function(e,t,a){"use strict";a.r(t);var r=a("97a8"),n=a("6d45");for(var i in n)"default"!==i&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a("cc82");var s,o=a("f0c5"),u=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"34a68318",null,!1,r["a"],s);t["default"]=u.exports},"7b5e":function(e,t,a){var r=a("300d");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=a("4f06").default;n("27b30f6a",r,!0,{sourceMap:!1,shadowMode:!1})},"97a8":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return r}));var r={uniPopup:a("6ac9").default},n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{class:1==e.isUps?"prevent":""},[a("cu-custom",{attrs:{isBack:!0}},[a("template",{attrs:{slot:"backText"},slot:"backText"},[e._v("返回")]),a("template",{attrs:{slot:"content"},slot:"content"},[e._v("消息")])],2),a("v-uni-scroll-view",{staticStyle:{"margin-top":"-60px"},style:[{height:"calc(100vh - "+e.CustomBar+"px + 50px)"}],attrs:{"scroll-y":!0}},[e._l(e.list,(function(t,r){return[a("v-uni-view",{key:r+"_0",staticClass:"padding"},[e._v(e._s(e.list[r].group))]),a("v-uni-view",{key:r+"_1",staticClass:"cu-list menu-avatar no-padding"},e._l(t.subList,(function(t,n){return a("v-uni-view",{key:n,staticClass:"cu-item  card-radius margin-top-xxs margin-left-xs margin-right-xs margin-bottom-xs shadow bg-white.light",on:{longpress:function(a){arguments[0]=a=e.$handleEvent(a),e.popupOperateCard(r,n,t.id)}}},[a("v-uni-view",{staticClass:"cu-avatar round",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.goDetail(t.id)}}},[a("v-uni-image",{staticClass:"cu-avatar round",attrs:{src:t.avatar,mode:"aspectFill"}}),t.unread>0?a("v-uni-view",{staticClass:"cu-tag badge"},[e._v(e._s(t.unread))]):e._e()],1),a("v-uni-view",{staticClass:"content",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.startTalk(t.id)}}},[a("v-uni-view",{staticClass:"text-grey"},[e._v(e._s(t.name)),a("v-uni-text",{staticClass:"text-abc"})],1),a("v-uni-view",{staticClass:"text-gray text-sm text-cut"},[e._v(e._s(t.last_history))])],1),a("v-uni-view",{staticClass:"action",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.startTalk(t.id)}}},[a("v-uni-text",{staticClass:"cuIcon-message text-grey",staticStyle:{"font-size":"38rpx"}}),a("v-uni-view",{staticClass:"text-gray text-xs"},[e._v(e._s(t.last_time))])],1)],1)})),1)]}))],2),e.isUps?a("v-uni-view",{staticClass:"shade"}):e._e(),a("uni-popup",{ref:"showPopupOperate",attrs:{type:"bottom"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.change.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"card-popup bg-white"},[a("v-uni-view",{staticClass:"card-popup-content",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.removeCard.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"remove-popup-btn"},[e._v("删除")])],1),a("v-uni-text",{staticClass:"card-popup-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.cancel("PopupOperate")}}},[e._v("取消")])],1)],1)],1)},i=[]},a9ed:function(e,t,a){"use strict";var r=a("4ea4");a("4160"),a("a434"),a("d3b7"),a("159b"),a("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var n=r(a("1da1")),i=r(a("5530")),s=a("2f62"),o=r(a("e3fb")),u=r(a("6ac9")),d=r(a("d3b3")),c={components:{"uni-popup":u.default},data:function(){return{bizCard:{},listGroup:{},holderIdList:[],StatusBar:this.StatusBar,CustomBar:this.CustomBar,list:[{}],index:-1,subList:[],page:1,isUps:!1,selectedIdx:-1,selectedSubIdx:-1,selectedCardId:"-1"}},onLoad:function(){this.getBizCard()},onShow:function(){this.getBizHolder()},onPullDownRefresh:function(){this.getBizCard(),uni.stopPullDownRefresh()},computed:(0,i.default)({},(0,s.mapState)(["user"])),methods:(0,i.default)((0,i.default)({},(0,s.mapMutations)(["updateUser"])),{},{getBizCard:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,r=null,t.next=4,d.default.callFunction({name:"web",data:{$url:"getCardDetailById",id:a.user.userInfo.bizCardId}});case 4:r=t.sent,a.bizCard=JSON.parse(r.result.data);case 6:case"end":return t.stop()}}),t)})))()},getBizHolder:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,r,n,i,s,u,c,l,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,a.list=[],r=null,n=[],t.next=6,d.default.callFunction({name:"web",data:{$url:"getCardHolderByCardId",cardId:a.user.userInfo.bizCardId}});case 6:if(r=t.sent,n=JSON.parse(r.result.data),n){t.next=10;break}return t.abrupt("return");case 10:for(s in a.listGroup=n.cards||{},a.holderIdList=n.search_data||[],i=[a.cardId],a.holderIdList)i.push(a.holderIdList[s].id);return u=[],t.next=17,d.default.callFunction({name:"web",data:{$url:"getChatRoomList",chatIdList:i}});case 17:for(l in r=t.sent,u=JSON.parse(r.result.data),c=0,a.listGroup)p=!1,a.listGroup[l].forEach((function(e){for(var t in p=!0,u){var a=u[t];if(e.room_id&&e.room_id==a._id){var r=0;e.id==a.source_id&&a.target_unread>0?r=a.target_unread:e.id==a.target_id&&a.source_unread>0&&(r=a.source_unread),e.last_history=a.last_history,e.last_time=o.default.getDateDiff(a.last_time),e.unread=r;break}}})),p&&(a.list[c]={},a.list[c].group=l,a.list[c].subList=a.listGroup[l],c++);a.$forceUpdate();case 22:case"end":return t.stop()}}),t)})))()},goDetail:function(e){uni.navigateTo({url:"/pagesSys/card/ShareCardDetail?id="+e})},popupOperateCard:function(e,t,a){var r=this;r.selectedIdx=e,r.selectedSubIdx=t,r.selectedCardId=a,this.$nextTick((function(){r.$refs["showPopupOperate"].open()}))},change:function(e){e.show?this.isUps=!0:this.isUps=!1},cancel:function(e){this.$refs["show"+e].close()},removeCard:function(){var e=this;return(0,n.default)(regeneratorRuntime.mark((function t(){var a,r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,t.next=3,d.default.callFunction({name:"sys",data:{$url:"removeCardFromHolder",siteCardId:a.cardId,groupKey:a.list[a.selectedIdx].group,subIndex:a.selectedSubIdx,cardId:a.selectedCardId}});case 3:if(!(a.index>0&&a.selectedSubIdx>0)){t.next=19;break}r=-1,t.t0=regeneratorRuntime.keys(a.holderIdList);case 6:if((t.t1=t.t0()).done){t.next=13;break}if(n=t.t1.value,a.holderIdList[n].id!=a.selectedCardId){t.next=11;break}return r=n,t.abrupt("break",13);case 11:t.next=6;break;case 13:for(i in a.holderIdList.splice(r,1),a.list)a.list[i].group==a.listGroup[a.selectedIdx]&&(r=i);a.list[r].subList.splice(a.selectedSubIdx,1),a.selectedIdx=-1,a.selectedSubIdx=-1,a.selectedCardId="-1";case 19:uni.showToast({icon:"success",title:"删除成功"}),a.getBizHolder(),a.$refs["showPopupOperate"].close(),a.$forceUpdate();case 23:case"end":return t.stop()}}),t)})))()},startTalk:function(e){var t=this;return(0,n.default)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:uni.navigateTo({url:"/pagesSys/site/WebService?sourceCardId="+t.user.userInfo.bizCardId+"&targetCardId="+e});case 1:case"end":return a.stop()}}),a)})))()}})};t.default=c},cc82:function(e,t,a){"use strict";var r=a("7b5e"),n=a.n(r);n.a},e3fb:function(e,t,a){function r(e){return""===e||("null"===e||("undefined"===e||(!e&&0!==e&&""!==e||(!(!Array.prototype.isPrototypeOf(e)||0!==e.length)||!(!Object.prototype.isPrototypeOf(e)||0!==Object.keys(e).length)))))}function n(e,t){if(e){switch(t||(t="yyyy-MM-dd"),typeof e){case"string":e=new Date(e.replace(/-/,"/"));break;case"number":e=new Date(e);break}if(!(!e instanceof Date)){var a={yyyy:e.getFullYear(),M:e.getMonth()+1,d:e.getDate(),H:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),MM:(""+(e.getMonth()+101)).substr(1),dd:(""+(e.getDate()+100)).substr(1),HH:(""+(e.getHours()+100)).substr(1),mm:(""+(e.getMinutes()+100)).substr(1),ss:(""+(e.getSeconds()+100)).substr(1)};return t.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g,(function(){return a[arguments[0]]}))}}}function i(){return this.dateFormat(new Date,"yyyyMMdd")}function s(e,t){if(e){switch(t||(t="yyyy-MM-dd"),typeof e){case"string":e=new Date(e);break;case"number":e=new Date(e);break}if(!(!e instanceof Date)){var a={yyyy:e.getFullYear(),M:e.getMonth()+1,d:e.getDate(),H:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),MM:(""+(e.getMonth()+101)).substr(1),dd:(""+(e.getDate()+100)).substr(1),HH:(""+(e.getHours()+100)).substr(1),mm:(""+(e.getMinutes()+100)).substr(1),ss:(""+(e.getSeconds()+100)).substr(1)};return t.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g,(function(){return a[arguments[0]]}))}}}function o(e,t){var a=!1,r=Date.parse(e),n=Date.parse(t),i=new Date(n).setHours(0,0,0,0);return r<i&&(a=!0),a}function u(e,t){var a=!1,r=Date.parse(e),n=Date.parse(t);return r<n&&(a=!0),a}function d(e){if(e){var t=Date.parse(e),a=Date.parse(new Date),r=Math.abs(a-t);if(r>6048e5){var n=new Date(t),i=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),u=(new Date).getFullYear();return u==i?s+"月"+o+"日":i+"年"+s+"月"+o+"日"}if(r<6048e5&&r>864e5){var d=Math.floor(r/864e5);return d+"天前"}if(r<864e5&&r>36e5){d=Math.floor(r/36e5);return d+"小时前"}if(r<36e5&&r>=0)return"刚刚"}}function c(e){var t=/^[1][3,4,5,7,8,9][0-9]{9}$/;return!(!t.test(e)||11!=e.length)}function l(){var e=new Date,t="user/"+e.getFullYear()+(""+(e.getMonth()+101)).substr(1)+"/";return t}function p(e){var t="",a=6e4,r=60*a,n=24*r,i=30*n,s=(new Date).getTime(),o=s-e;if(!(o<0)){var u=o/i,d=o/(7*n),c=o/n,l=o/r,p=o/a;return t=u>=1?parseInt(u)+"月前":d>=1?parseInt(d)+"周前":c>=1?parseInt(c)+"天前":l>=1?parseInt(l)+"小时前":p>=1?parseInt(p)+"分钟前":"刚刚",t}}a("b64b"),a("e25e"),a("ac1f"),a("5319"),e.exports={isEmpty:r,dateFormat:n,today:i,formatTime:s,isDayBefore:o,isTimeBefore:u,formatCreateTime:d,isPhoneAvailable:c,cloudUploadPath:l,getDateDiff:p}}}]);