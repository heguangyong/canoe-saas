(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesSys/card/CardInput"],{78:function(e,t,r){"use strict";(function(e){r(5);n(r(4));var t=n(r(79));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r(1)["createPage"])},79:function(e,t,r){"use strict";r.r(t);var n=r(80),a=r(82);for(var s in a)"default"!==s&&function(e){r.d(t,e,(function(){return a[e]}))}(s);r(84);var c,o=r(15),u=Object(o["default"])(a["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],c);u.options.__file="pagesSys/card/CardInput.vue",t["default"]=u.exports},80:function(e,t,r){"use strict";r.r(t);var n=r(81);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},81:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return a})),r.d(t,"staticRenderFns",(function(){return c})),r.d(t,"recyclableRender",(function(){return s})),r.d(t,"components",(function(){return n}));try{n={uniPopup:function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,810))}}}catch(o){if(-1===o.message.indexOf("Cannot find module")||-1===o.message.indexOf(".vue"))throw o;console.error(o.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement;e._self._c},s=!1,c=[];a._withStripped=!0},82:function(e,t,r){"use strict";r.r(t);var n=r(83),a=r.n(n);for(var s in n)"default"!==s&&function(e){r.d(t,e,(function(){return n[e]}))}(s);t["default"]=a.a},83:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(9)),a=r(12);function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r,n,a,s,c){try{var o=e[s](c),u=o.value}catch(i){return void r(i)}o.done?t(u):Promise.resolve(u).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function o(e){c(s,n,a,o,u,"next",e)}function u(e){c(s,n,a,o,u,"throw",e)}o(void 0)}))}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=function(){Promise.all([r.e("common/vendor"),r.e("components/ups-upload/index")]).then(function(){return resolve(r(838))}.bind(null,r)).catch(r.oe)},f=function(){r.e("components/uni-popup/uni-popup").then(function(){return resolve(r(810))}.bind(null,r)).catch(r.oe)},p={components:{"ups-upload":l,"uni-popup":f},data:function(){return{card:{corp_address:{address:"",latitude:0,longitude:0},mailing_address:""},isUps:!1,listGroup:{},CustomBar:this.CustomBar,list:[{}],index:-1,subList:[],listCur:"",searchList:[{}],page:1,search_str:"",hasAddress:!1,currentUser:{},isLinked:!1}},onReady:function(){this.getDetail()},computed:i({},(0,a.mapState)(["user"])),methods:i(i({},(0,a.mapMutations)(["updateUser"])),{},{getDetail:function(){var e=this;return o(n.default.mark((function t(){var r,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e,console.log("getDetail user:",r.user),!r.user._id){t.next=12;break}return r.currentUser=r.user,r.isLinked=r.currentUser.userInfo.bizCardId.trim().length>0,t.next=7,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailByUserId",userId:r.user._id||"0"}});case 7:a=t.sent,console.log("getDetail",a),0==a.result.code&&(r.card=a.result.data,r.card.corp_address?r.hasAddress=!0:(r.hasAddress=!1,r.card.corp_address={address:"",latitude:0,longitude:0}),r.user.userInfo.bizCardName&&r.user.userInfo.bizCardName.length>0&&(r.card.corp_name=r.user.userInfo.bizCardName)),t.next=20;break;case 12:r.card.user_id=r.user._id||"0",r.card.name=r.user.userInfo.nickName,r.card.avatar=r.user.userInfo.avatarUrl,r.card.videos=[],r.card.carousels=[],r.card.corp_address={address:"",latitude:0,longitude:0},r.card.mailing_address="",r.hasAddress=!1;case 20:case"end":return t.stop()}}),t)})))()},getPhoneNumber:function(t){var r=this;return o(n.default.mark((function a(){var s,c;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=r,n.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"getPhone",cloudId:t.detail.cloudID}});case 3:c=n.sent,0==c.result.code&&(e.showToast({title:"授权成功",success:function(){}}),s.card.phone=c.result.data.phoneNumber,s.$forceUpdate());case 5:case"end":return n.stop()}}),a)})))()},uploadAvatar:function(e){this.card.avatar=e,this.$forceUpdate()},removeAvatar:function(){this.card.avatar="",this.$forceUpdate()},uploadCover:function(e){this.card.cover=e,this.$forceUpdate()},removeCover:function(){this.card.cover="",this.$forceUpdate()},bindCompany:function(){this.isUps=!0,this.$refs.showComments.open()},cancelSubmit:function(){e.navigateBack()},submit:function(){var t=this;return o(n.default.mark((function r(){var a,s,c,o;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=t,s=/^[a-zA-Z\u4e00-\u9fa5]+$/,console.log("reg",s.test(a.card.name)),a.card.name&&s.test(a.card.name)){r.next=6;break}return e.showToast({icon:"none",title:"姓名需字母或汉字开头"}),r.abrupt("return");case 6:return console.log("card",a.card,a.card.phone),c=a.card.name+a.card.introduce+a.card.wx_number+a.card.corp_name+a.card.corp_position+a.card.mailing_address,r.next=10,wx.cloud.callFunction({name:"sys",data:{$url:"msgSecCheck",value:c}});case 10:if(o=r.sent,console.log(o),0==o.result.code){r.next=15;break}return e.showToast({icon:"none",title:"内容含有违规内容，请修改后提交"}),r.abrupt("return");case 15:if(!a.card._id){r.next=18;break}return r.next=18,wx.cloud.callFunction({name:"sys",data:{$url:"updateCard",card:a.card}});case 18:e.reLaunch({url:"/pagesSys/card/CardDetail?id="+a.card._id});case 19:case"end":return r.stop()}}),r)})))()},getSearchList:function(){var e=this;return o(n.default.mark((function t(){var r,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.user._id){t.next=2;break}return t.abrupt("return");case 2:return r=e,r.list=[],r.index=0,r.subList=[],e.page=1,r.updateSearchList(),t.next=10,wx.cloud.callFunction({name:"sys",data:{$url:"searchBizCardList",search_str:r.search_str,page:r.page}});case 10:if(a=t.sent,console.log("page",r.page,"searchList.length",a.result.data.length),0!=a.result.code){t.next=17;break}if(r.searchList=a.result.data||[],!(0==r.searchList.length||r.page>=5)){t.next=16;break}return t.abrupt("return");case 16:r.cachedPageList();case 17:case"end":return t.stop()}}),t)})))()},getNextPage:function(){var e=this;return o(n.default.mark((function t(){var r,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,t.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"searchBizCardList",search_str:r.search_str,page:r.page}});case 3:if(a=t.sent,console.log("page",r.page,"searchList.length",a.result.data.length),0!=a.result.code){t.next=10;break}if(r.searchList=a.result.data||[],!(0==r.searchList.length||r.page>=5)){t.next=9;break}return t.abrupt("return");case 9:r.cachedPageList();case 10:case"end":return t.stop()}}),t)})))()},cachedPageList:function(){var e=this,t=e.searchList[0].group_index;for(var r in e.searchList){var n=!1;e.user._id==e.searchList[r].user_id&&(n=!0,e.searchList[r].has_holder=!0,e.searchList[r].in_exchange=!1),n||(e.searchList[r].has_holder=!1,e.searchList[r].in_exchange=!1),e.searchList[r].id=e.searchList[r]._id,e.searchList[r].position=e.searchList[r].corp_position,t==e.searchList[r].group_index||(e.list[e.index]={},e.list[e.index].group=t,e.list[e.index].subList=e.subList,e.index++,e.subList=[],t=e.searchList[r].group_index),e.subList.push(e.searchList[r]),r==e.searchList.length-1&&(e.list[e.index]={},e.list[e.index].group=t,e.list[e.index].subList=e.subList)}console.log("list",e.list,"index",e.index,"subList",e.subList),e.listCur=e.list[20*(e.page-1)],e.searchList.length<20||e.$forceUpdate()},updateSearchList:function(){var e=this;return o(n.default.mark((function t(){var r,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,t.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"getCardHolderByUserId",userId:r.user._id}});case 3:a=t.sent,a.result,r.$forceUpdate();case 6:case"end":return t.stop()}}),t)})))()},onPullDownRefresh:function(){that.list=[],that.index=0,that.subList=[],this.page=1,e.stopPullDownRefresh()},inputFocus:function(e){console.log(e)},inputBlur:function(e){console.log(e),this.searchList=[],this.search_str=e.detail.value,this.page=1},cancel:function(e){this.$refs["show"+e].close()},change:function(e){e.show?this.isUps=!0:this.isUps=!1},tapSearch:function(){var e=this;this.getSearchList(),this.$nextTick((function(){e.isUps=!0,e.$refs["showBizCard"].open()}))},addLink:function(e){var t=this;return o(n.default.mark((function r(){var a;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t,console.log("addLink",e),a.currentUser.userInfo.bizCardAvatar=e.avatar,a.currentUser.userInfo.bizCardName=e.name,a.currentUser.userInfo.bizCardId=e._id,r.next=7,wx.cloud.callFunction({name:"sys",data:{$url:"updateUserInfo",id:a.currentUser._id,userInfo:a.currentUser.userInfo}});case 7:return a.isLinked=!0,t.$refs["showBizCard"].close(),a.updateUser(a.user),a.card.corp_name=e.name,a.card.corp_id=e._id,r.next=14,wx.cloud.callFunction({name:"sys",data:{$url:"updateCard",card:a.card}});case 14:a.$forceUpdate();case 15:case"end":return r.stop()}}),r)})))()},removeLinked:function(){var e=this;return o(n.default.mark((function t(){var r;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,r.isLinked=!1,r.currentUser.userInfo.bizCardAvatar="",r.currentUser.userInfo.bizCardName="",r.currentUser.userInfo.bizCardId="",t.next=7,wx.cloud.callFunction({name:"sys",data:{$url:"updateUserInfo",id:r.currentUser._id,userInfo:r.currentUser.userInfo}});case 7:return r.updateUser(r.user),r.card.corp_name="",r.card.corp_id="",t.next=12,wx.cloud.callFunction({name:"sys",data:{$url:"updateCard",card:r.card}});case 12:r.$forceUpdate();case 13:case"end":return t.stop()}}),t)})))()},chooseAddress:function(){var e=this;wx.getSetting({success:function(t){console.log("get-setting",t.authSetting);var r=t.authSetting;r["scope.userLocation"]||void 0===r["scope.userLocation"]?e.getUserLocation():r["scope.userLocation"]||wx.showModal({title:"是否授权当前位置？",content:"需要获取您的地理位置，请确认授权，否则定位功能将无法使用",success:function(t){t.confirm&&wx.openSetting({success:function(t){console.log("open-setting-suc",t.authSetting);var r=t.authSetting;r["scope.userLocation"]?e.getUserLocation():wx.showToast({title:"地址授权失败，定位功能无法使用",icon:"none"})},fail:function(e){console.log("open-setting-fail",e)}})}})}})},getUserLocation:function(){var e=this;wx.chooseLocation({success:function(t){console.log(t),console.log(e.card),e.card.corp_address?(e.card.corp_address.address=t.address,e.card.corp_address.latitude=t.latitude,e.card.corp_address.longitude=t.longitude):(e.card.corp_address={address:"",latitude:0,longitude:0},e.card.corp_address.address=t.address,e.card.corp_address.latitude=t.latitude,e.card.corp_address.longitude=t.longitude),e.hasAddress=!0,e.$forceUpdate()}})}})};t.default=p}).call(this,r(1)["default"])},84:function(e,t,r){"use strict";r.r(t);var n=r(85),a=r.n(n);for(var s in n)"default"!==s&&function(e){r.d(t,e,(function(){return n[e]}))}(s);t["default"]=a.a},85:function(e,t,r){}},[[78,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesSys/card/CardInput.js.map