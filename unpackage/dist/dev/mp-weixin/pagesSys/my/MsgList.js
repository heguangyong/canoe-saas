(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesSys/my/MsgList"],{125:function(e,t,r){"use strict";(function(e){r(5);n(r(4));var t=n(r(126));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r(1)["createPage"])},126:function(e,t,r){"use strict";r.r(t);var n=r(127),s=r(129);for(var u in s)"default"!==u&&function(e){r.d(t,e,(function(){return s[e]}))}(u);r(131);var o,a=r(15),i=Object(a["default"])(s["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],o);i.options.__file="pagesSys/my/MsgList.vue",t["default"]=i.exports},127:function(e,t,r){"use strict";r.r(t);var n=r(128);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},128:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return s})),r.d(t,"staticRenderFns",(function(){return o})),r.d(t,"recyclableRender",(function(){return u})),r.d(t,"components",(function(){return n}));try{n={uniPopup:function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,810))}}}catch(a){if(-1===a.message.indexOf("Cannot find module")||-1===a.message.indexOf(".vue"))throw a;console.error(a.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var s=function(){var e=this,t=e.$createElement;e._self._c},u=!1,o=[];s._withStripped=!0},129:function(e,t,r){"use strict";r.r(t);var n=r(130),s=r.n(n);for(var u in n)"default"!==u&&function(e){r.d(t,e,(function(){return n[e]}))}(u);t["default"]=s.a},130:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r(9)),s=r(12),u=o(r(39));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n,s,u,o){try{var a=e[u](o),i=a.value}catch(c){return void r(c)}a.done?t(i):Promise.resolve(i).then(n,s)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var u=e.apply(t,r);function o(e){a(u,n,s,o,i,"next",e)}function i(e){a(u,n,s,o,i,"throw",e)}o(void 0)}))}}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=function(){r.e("components/uni-popup/uni-popup").then(function(){return resolve(r(810))}.bind(null,r)).catch(r.oe)},p={components:{"uni-popup":f},data:function(){return{myCard:{},listGroup:{},holderIdList:[],StatusBar:this.StatusBar,CustomBar:this.CustomBar,hidden:!0,list:[{}],index:-1,subList:[],page:1,isUps:!1,selectedIdx:-1,selectedSubIdx:-1,selectedCardId:"-1"}},onLoad:function(){this.getMyCard()},onShow:function(){this.getMyHolder()},onPullDownRefresh:function(){this.getMyHolder(),e.stopPullDownRefresh()},computed:d({},(0,s.mapState)(["user"])),methods:d(d({},(0,s.mapMutations)(["updateUser"])),{},{getMyCard:function(){var e=this;return i(n.default.mark((function t(){var r,s;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,s=null,t.next=4,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailByUserId",userId:r.user._id}});case 4:s=t.sent,r.myCard=s.result.data;case 6:case"end":return t.stop()}}),t)})))()},getMyHolder:function(){var e=this;return i(n.default.mark((function t(){var r,s,o,a,i,c,d,l,f;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,r.list=[],s=null,o=null,t.next=6,wx.cloud.callFunction({name:"sys",data:{$url:"getCardHolderByUserId",userId:r.user._id}});case 6:for(i in s=t.sent,o=s.result.data,r.listGroup=o.cards,r.holderIdList=o.search_data,a=[r.myCard._id],r.holderIdList)a.push(r.holderIdList[i].id);return c=[],t.next=15,wx.cloud.callFunction({name:"sys",data:{$url:"getChatRoomList",chatIdList:a}});case 15:for(l in s=t.sent,c=s.result.data,d=0,r.listGroup)f=!1,r.listGroup[l].forEach((function(e){for(var t in f=!0,c){var r=c[t];if(e.room_id&&e.room_id==r._id){var n=0;e.id==r.source_id&&r.target_unread>0?n=r.target_unread:e.id==r.target_id&&r.source_unread>0&&(n=r.source_unread),e.last_history=r.last_history,e.last_time=u.default.getDateDiff(r.last_time),e.unread=n;break}}})),f&&(r.list[d]={},r.list[d].group=l,r.list[d].subList=r.listGroup[l],d++);r.$forceUpdate();case 20:case"end":return t.stop()}}),t)})))()},goDetail:function(t){e.navigateTo({url:"/pagesSys/card/ShareCardDetail?id="+t})},popupOperateCard:function(e,t,r){var n=this;n.selectedIdx=e,n.selectedSubIdx=t,n.selectedCardId=r,this.$nextTick((function(){n.$refs["showPopupOperate"].open()}))},change:function(e){e.show?this.isUps=!0:this.isUps=!1},cancel:function(e){this.$refs["show"+e].close()},removeCard:function(){var t=this;return i(n.default.mark((function r(){var s,u,o,a;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=t,r.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"removeCardFromHolder",userId:s.user._id,groupKey:s.list[s.selectedIdx].group,subIndex:s.selectedSubIdx,cardId:s.selectedCardId}});case 3:if(!(s.index>0&&s.selectedSubIdx>0)){r.next=19;break}u=-1,r.t0=n.default.keys(s.holderIdList);case 6:if((r.t1=r.t0()).done){r.next=13;break}if(o=r.t1.value,s.holderIdList[o].id!=s.selectedCardId){r.next=11;break}return u=o,r.abrupt("break",13);case 11:r.next=6;break;case 13:for(a in s.holderIdList.splice(s.existIdx,1),s.list)s.list[a].group==s.listGroup[s.selectedIdx]&&(u=a);s.list[u].subList.splice(s.selectedSubIdx,1),s.selectedIdx=-1,s.selectedSubIdx=-1,s.selectedCardId="-1";case 19:e.showToast({icon:"success",title:"删除成功"}),s.getMyHolder(),s.$refs["showPopupOperate"].close(),s.$forceUpdate();case 23:case"end":return r.stop()}}),r)})))()},startTalk:function(t){var r=this;return i(n.default.mark((function s(){return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.navigateTo({url:"/pagesSys/site/service?sourceCardId="+r.user.userInfo.cardId+"&targetCardId="+t});case 1:case"end":return n.stop()}}),s)})))()}})};t.default=p}).call(this,r(1)["default"])},131:function(e,t,r){"use strict";r.r(t);var n=r(132),s=r.n(n);for(var u in n)"default"!==u&&function(e){r.d(t,e,(function(){return n[e]}))}(u);t["default"]=s.a},132:function(e,t,r){}},[[125,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesSys/my/MsgList.js.map