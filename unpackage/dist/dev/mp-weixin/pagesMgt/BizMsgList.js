(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesMgt/BizMsgList"],{446:function(e,t,r){"use strict";(function(e){r(5);n(r(4));var t=n(r(447));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r(1)["createPage"])},447:function(e,t,r){"use strict";r.r(t);var n=r(448),a=r(450);for(var o in a)"default"!==o&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r(452);var s,u=r(15),i=Object(u["default"])(a["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],s);i.options.__file="pagesMgt/BizMsgList.vue",t["default"]=i.exports},448:function(e,t,r){"use strict";r.r(t);var n=r(449);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},449:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return a})),r.d(t,"staticRenderFns",(function(){return s})),r.d(t,"recyclableRender",(function(){return o})),r.d(t,"components",(function(){return n}));try{n={uniPopup:function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,810))}}}catch(u){if(-1===u.message.indexOf("Cannot find module")||-1===u.message.indexOf(".vue"))throw u;console.error(u.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement;e._self._c},o=!1,s=[];a._withStripped=!0},450:function(e,t,r){"use strict";r.r(t);var n=r(451),a=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},451:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(9)),a=r(12),o=s(r(39));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t,r,n,a,o,s){try{var u=e[o](s),i=u.value}catch(c){return void r(c)}u.done?t(i):Promise.resolve(i).then(n,a)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){u(o,n,a,s,i,"next",e)}function i(e){u(o,n,a,s,i,"throw",e)}s(void 0)}))}}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=function(){r.e("components/uni-popup/uni-popup").then(function(){return resolve(r(810))}.bind(null,r)).catch(r.oe)},p={components:{"uni-popup":f},data:function(){return{title:"",bizCard:{},listGroup:{},holderIdList:[],StatusBar:this.StatusBar,CustomBar:this.CustomBar,list:[{}],index:-1,subList:[],page:1,isUps:!1,selectedIdx:-1,selectedSubIdx:-1,selectedCardId:"-1"}},onLoad:function(e){this.title=e.title,this.getBizCard()},onShow:function(){this.getBizHolder()},onPullDownRefresh:function(){this.getBizCard(),e.stopPullDownRefresh()},computed:d({},(0,a.mapState)(["user"])),methods:d(d({},(0,a.mapMutations)(["updateUser"])),{},{getBizCard:function(){var e=this;return i(n.default.mark((function t(){var r,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,a=null,t.next=4,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:r.user.userInfo.bizCardId}});case 4:a=t.sent,r.bizCard=a.result.data;case 6:case"end":return t.stop()}}),t)})))()},getBizHolder:function(){var e=this;return i(n.default.mark((function t(){var r,a,s,u,i,c,d,l,f;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,r.list=[],a=null,s=[],t.next=6,wx.cloud.callFunction({name:"sys",data:{$url:"getCardHolderByCardId",cardId:r.user.userInfo.bizCardId}});case 6:if(a=t.sent,s=a.result.data,s){t.next=10;break}return t.abrupt("return");case 10:for(i in r.listGroup=s.cards||{},r.holderIdList=s.search_data||[],u=[r.cardId],r.holderIdList)u.push(r.holderIdList[i].id);return c=[],t.next=17,wx.cloud.callFunction({name:"sys",data:{$url:"getChatRoomList",chatIdList:u}});case 17:for(l in a=t.sent,c=a.result.data,d=0,r.listGroup)f=!1,r.listGroup[l].forEach((function(e){for(var t in f=!0,c){var r=c[t];if(e.room_id&&e.room_id==r._id){var n=0;e.id==r.source_id&&r.target_unread>0?n=r.target_unread:e.id==r.target_id&&r.source_unread>0&&(n=r.source_unread),e.last_history=r.last_history,e.last_time=o.default.getDateDiff(r.last_time),e.unread=n;break}}})),f&&(r.list[d]={},r.list[d].group=l,r.list[d].subList=r.listGroup[l],d++);r.$forceUpdate();case 22:case"end":return t.stop()}}),t)})))()},goDetail:function(t){e.navigateTo({url:"/pagesSys/card/ShareCardDetail?id="+t})},popupOperateCard:function(e,t,r){var n=this;n.selectedIdx=e,n.selectedSubIdx=t,n.selectedCardId=r,this.$nextTick((function(){n.$refs["showPopupOperate"].open()}))},change:function(e){e.show?this.isUps=!0:this.isUps=!1},cancel:function(e){this.$refs["show"+e].close()},removeCard:function(){var t=this;return i(n.default.mark((function r(){var a,o,s,u;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t,r.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"removeCardFromHolder",siteCardId:a.cardId,groupKey:a.list[a.selectedIdx].group,subIndex:a.selectedSubIdx,cardId:a.selectedCardId}});case 3:if(!(a.index>0&&a.selectedSubIdx>0)){r.next=19;break}o=-1,r.t0=n.default.keys(a.holderIdList);case 6:if((r.t1=r.t0()).done){r.next=13;break}if(s=r.t1.value,a.holderIdList[s].id!=a.selectedCardId){r.next=11;break}return o=s,r.abrupt("break",13);case 11:r.next=6;break;case 13:for(u in a.holderIdList.splice(o,1),a.list)a.list[u].group==a.listGroup[a.selectedIdx]&&(o=u);a.list[o].subList.splice(a.selectedSubIdx,1),a.selectedIdx=-1,a.selectedSubIdx=-1,a.selectedCardId="-1";case 19:e.showToast({icon:"success",title:"删除成功"}),a.getBizHolder(),a.$refs["showPopupOperate"].close(),a.$forceUpdate();case 23:case"end":return r.stop()}}),r)})))()},startTalk:function(t){var r=this;return i(n.default.mark((function a(){return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.navigateTo({url:"/pagesSys/site/service?sourceCardId="+r.user.userInfo.bizCardId+"&targetCardId="+t});case 1:case"end":return n.stop()}}),a)})))()}})};t.default=p}).call(this,r(1)["default"])},452:function(e,t,r){"use strict";r.r(t);var n=r(453),a=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},453:function(e,t,r){}},[[446,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/pagesMgt/BizMsgList.js.map