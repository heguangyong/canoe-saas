(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesMgt/BizProductInput"],{468:function(t,e,r){"use strict";(function(t){r(5);n(r(4));var e=n(r(469));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=r,t(e.default)}).call(this,r(1)["createPage"])},469:function(t,e,r){"use strict";r.r(e);var n=r(470),o=r(472);for(var u in o)"default"!==u&&function(t){r.d(e,t,(function(){return o[t]}))}(u);r(474);var c,i=r(15),a=Object(i["default"])(o["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],c);a.options.__file="pagesMgt/BizProductInput.vue",e["default"]=a.exports},470:function(t,e,r){"use strict";r.r(e);var n=r(471);r.d(e,"render",(function(){return n["render"]})),r.d(e,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(e,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(e,"components",(function(){return n["components"]}))},471:function(t,e,r){"use strict";var n;r.r(e),r.d(e,"render",(function(){return o})),r.d(e,"staticRenderFns",(function(){return c})),r.d(e,"recyclableRender",(function(){return u})),r.d(e,"components",(function(){return n}));var o=function(){var t=this,e=t.$createElement;t._self._c},u=!1,c=[];o._withStripped=!0},472:function(t,e,r){"use strict";r.r(e);var n=r(473),o=r.n(n);for(var u in n)"default"!==u&&function(t){r.d(e,t,(function(){return n[t]}))}(u);e["default"]=o.a},473:function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u(r(9)),o=r(12);function u(t){return t&&t.__esModule?t:{default:t}}function c(t,e,r,n,o,u,c){try{var i=t[u](c),a=i.value}catch(d){return void r(d)}i.done?e(a):Promise.resolve(a).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var u=t.apply(e,r);function i(t){c(u,n,o,i,a,"next",t)}function a(t){c(u,n,o,i,a,"throw",t)}i(void 0)}))}}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var l=function(){Promise.all([r.e("common/vendor"),r.e("components/ups-uploads/index")]).then(function(){return resolve(r(867))}.bind(null,r)).catch(r.oe)},p=function(){Promise.all([r.e("common/vendor"),r.e("components/ups-upload/index")]).then(function(){return resolve(r(838))}.bind(null,r)).catch(r.oe)},f=function(){Promise.all([r.e("common/vendor"),r.e("components/ups-movable/index")]).then(function(){return resolve(r(860))}.bind(null,r)).catch(r.oe)},m={components:{"ups-uploads":l,"ups-upload":p,"ups-movable":f},data:function(){return{productId:"",product:{price:0,sort_index:0,unit_name:"元",cover:"",carouse:[],imgList:[],detail:{content:"",images:[],imgList:[],videos:[]}},dbProductTags:""}},onLoad:function(t){var e=this;t.id&&(e.productId=t.id,this.getDetail())},onShow:function(){},computed:d({},(0,o.mapState)(["user"])),methods:{getDetail:function(){var t=this;return i(n.default.mark((function e(){var r,o;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t,e.next=3,wx.cloud.callFunction({name:"cmn",data:{$url:"getProductDetail",id:r.productId}});case 3:o=e.sent,r.product=o.result.data,r.product.imgList=[],r.product.carouse.forEach((function(t){r.product.imgList.push({url:t})})),r.product.detail.imgList=[],r.product.detail.images.forEach((function(t){r.product.detail.imgList.push({url:t})})),r.dbProductTags=o.result.data.tags||"";case 10:case"end":return e.stop()}}),e)})))()},submit:function(e){var r=this;return i(n.default.mark((function e(){var o,u,c,i,a,d,s,l;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=r,u=o.product.detail.content+o.product.title,e.next=4,wx.cloud.callFunction({name:"sys",data:{$url:"msgSecCheck",value:u}});case 4:if(c=e.sent,0==c.result.code){e.next=8;break}return t.showToast({icon:"none",title:"内容含有违规内容，请修改后提交"}),e.abrupt("return");case 8:if(o.product.title&&o.product.price&&0!=o.product.carouse.length){e.next=11;break}return t.showToast({icon:"none",title:"标题，图片和价格都填写才能发布!"}),e.abrupt("return");case 11:return e.next=13,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:o.user.userInfo.bizCardId}});case 13:if(i=e.sent,a=i.result.data,o.product.name=a.name,o.product.avatar=a.avatar,!(o.productId.length>0)){e.next=24;break}if(!(o.dbProductTags.length>0&&o.dbProductTags!=o.product.tags)){e.next=22;break}return e.next=21,wx.cloud.callFunction({name:"cmn",data:{$url:"updateProductTags",id:o.productId,tags:o.product.tags}});case 21:e.sent;case 22:e.next=32;break;case 24:return o.product.on_sale=!1,o.product.card_id=o.user.userInfo.bizCardId,e.next=28,wx.cloud.callFunction({name:"cmn",data:{$url:"addProduct",product:o.product}});case 28:return d=e.sent,o.product._id=d.result._id,e.next=32,wx.cloud.callFunction({name:"cmn",data:{$url:"genProductQrcode",id:o.product._id,page:"pagesCmn/product/ShareProductDetail",width:430}});case 32:if(s=a.tags||{card:"",products:"",activity:"",trends:""},l=s.products||"",!o.product.tags){e.next=41;break}if(!(o.product.tags.length>0&&l.indexOf(o.product.tags)<0)){e.next=41;break}return s.products.length>0&&(s.products+=","),s.products+=o.product.tags,a.tags=s,e.next=41,wx.cloud.callFunction({name:"sys",data:{$url:"updateCard",card:a}});case 41:t.showToast({icon:"success",title:"发布成功"}),setTimeout((function(){t.navigateTo({url:"/pagesMgt/BizProductList"})}),1e3);case 43:case"end":return e.stop()}}),e)})))()},uploadCover:function(t){this.product.cover=t,this.$forceUpdate()},removeCover:function(){this.product.cover="",this.$forceUpdate()},moveEndListHandle:function(t){var e=this;e.product.imgList=t,e.product.carouse=[],e.product.imgList.forEach((function(t){e.product.carouse.push(t.url)})),e.$forceUpdate()},uploadImages:function(t){this.product.carouse.push(t),this.product.imgList.push({url:t}),this.$forceUpdate()},removeImages:function(t){this.product.carouse.splice(t,1),this.product.imgList.splice(t,1),this.$forceUpdate()},moveEndListDetailHandle:function(t){console.log("moveEndListDetailHandle",t);var e=this;e.product.detail.imgList=t,e.product.detail.images=[],e.product.detail.imgList.forEach((function(t){e.product.detail.images.push(t.url)})),e.$forceUpdate()},uploadDetailImages:function(t){this.product.detail.images.push(t),this.product.detail.imgList.push({url:t}),this.$forceUpdate()},removeDetailImages:function(t){this.product.detail.images.splice(t,1),this.product.detail.imgList.splice(t,1),this.$forceUpdate()},uploadDetailVideos:function(t){this.product.detail.videos||(this.product.detail.videos=[]),this.product.detail.videos.push(t),this.$forceUpdate()},removeDetailVideos:function(t){this.product.detail.videos.splice(t,1),this.$forceUpdate()},navback:function(e){t.navigateBack()}}};e.default=m}).call(this,r(1)["default"])},474:function(t,e,r){"use strict";r.r(e);var n=r(475),o=r.n(n);for(var u in n)"default"!==u&&function(t){r.d(e,t,(function(){return n[t]}))}(u);e["default"]=o.a},475:function(t,e,r){}},[[468,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/pagesMgt/BizProductInput.js.map