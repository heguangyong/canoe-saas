(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesMgt/BizTrendInput"],{500:function(t,e,n){"use strict";(function(t){n(5);r(n(4));var e=r(n(501));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n(1)["createPage"])},501:function(t,e,n){"use strict";n.r(e);var r=n(502),i=n(504);for(var c in i)"default"!==c&&function(t){n.d(e,t,(function(){return i[t]}))}(c);n(506);var s,o=n(15),a=Object(o["default"])(i["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],s);a.options.__file="pagesMgt/BizTrendInput.vue",e["default"]=a.exports},502:function(t,e,n){"use strict";n.r(e);var r=n(503);n.d(e,"render",(function(){return r["render"]})),n.d(e,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(e,"components",(function(){return r["components"]}))},503:function(t,e,n){"use strict";var r;n.r(e),n.d(e,"render",(function(){return i})),n.d(e,"staticRenderFns",(function(){return s})),n.d(e,"recyclableRender",(function(){return c})),n.d(e,"components",(function(){return r}));var i=function(){var t=this,e=t.$createElement;t._self._c},c=!1,s=[];i._withStripped=!0},504:function(t,e,n){"use strict";n.r(e);var r=n(505),i=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,(function(){return r[t]}))}(c);e["default"]=i.a},505:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=c(n(9)),i=n(12);function c(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n,r,i,c,s){try{var o=t[c](s),a=o.value}catch(u){return void n(u)}o.done?e(a):Promise.resolve(a).then(r,i)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var c=t.apply(e,n);function o(t){s(c,r,i,o,a,"next",t)}function a(t){s(c,r,i,o,a,"throw",t)}o(void 0)}))}}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(){Promise.all([n.e("common/vendor"),n.e("components/ups-uploads/index")]).then(function(){return resolve(n(867))}.bind(null,n)).catch(n.oe)},f=function(){Promise.all([n.e("common/vendor"),n.e("components/ups-movable/index")]).then(function(){return resolve(n(860))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/ups-product/index").then(function(){return resolve(n(881))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/ups-activity/index").then(function(){return resolve(n(888))}.bind(null,n)).catch(n.oe)},v={components:{"ups-uploads":l,"ups-movable":f,"ups-product":h,"ups-activity":p},data:function(){return{trend:{carousels:[],imgList:[],videos:[],cover:"",content:"",likes_ids:[],productList:[],activityList:[]},isPickProduct:!1,productList:[],checkedProductList:[],categories:[{label:"全部",checked:!0}],activityList:[],isShowSelectPhotoOrVideo:!1,isShowResource:!1,isVideosType:!1,modalName:null,tab:["产品","活动"],tabCur:0}},onLoad:function(){var t=this;t.getProductList(),t.getActivityList()},computed:u({},(0,i.mapState)(["user"])),methods:{selectVideo:function(t){this.isVideosType=t,this.isShowSelectPhotoOrVideo=!0},submit:function(e){var n=this;return o(r.default.mark((function e(){var i,c,s,o,a,u;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=n,c=i.trend.title+i.trend.content,e.next=4,wx.cloud.callFunction({name:"sys",data:{$url:"msgSecCheck",value:c}});case 4:if(s=e.sent,0==s.result.code){e.next=8;break}return t.showToast({icon:"none",title:"内容含有违规内容，请修改后提交"}),e.abrupt("return");case 8:if(0!=i.trend.carousels.length||0!=i.trend.videos.length){e.next=11;break}return t.showToast({icon:"none",title:"请先选好照片或视频。"}),e.abrupt("return");case 11:return i.trend.user_id=i.user._id,i.trend.user_name=i.user.userInfo.nickName,i.trend.card_id=i.user.userInfo.bizCardId,e.next=16,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:i.user.userInfo.bizCardId}});case 16:return o=e.sent,a=o.result.data,i.trend.name=a.name,i.trend.avatar=a.avatar,i.trend.is_open_comments=!0,i.trend.place_order_flag=!1,u="",i.trend.carousels.length>0?u=i.trend.carousels[0]:i.trend.videos.length>0&&(u=i.trend.videos[0]),e.next=26,wx.cloud.callFunction({name:"sys",data:{$url:"convertFileIdToUrl",fileId:u}});case 26:return o=e.sent,i.trend.carousels.length>0?i.trend.cover=o.result.data:i.trend.videos.length>0&&(i.trend.cover=o.result.data.substring(0,o.result.data.length-3)+"jpg"),e.next=30,wx.cloud.callFunction({name:"cmn",data:{$url:"addTrend",trend:i.trend}});case 30:return o=e.sent,console.log("new trendId",o.result._id),e.next=34,wx.cloud.callFunction({name:"cmn",data:{$url:"genTrendQrcode",id:o.result._id,page:"pagesCmn/trend/ShareTrendDetail",width:430}});case 34:t.showToast({icon:"success",title:"发布成功"}),setTimeout((function(){t.navigateTo({url:"/pagesMgt/BizTrendList"})}),1e3);case 36:case"end":return e.stop()}}),e)})))()},navBack:function(e){t.navigateBack()},newProduct:function(){t.navigateTo({url:"/pagesMgt/BizProductInput"})},newActivity:function(){t.navigateTo({url:"/pagesMgt/BizActivityInput"})},moveEndListHandle:function(t){var e=this;e.trend.imgList=t,e.trend.carousels=[],e.trend.imgList.forEach((function(t){e.trend.carousels.push(t.url)})),e.$forceUpdate()},uploadCarousels:function(t){var e=this;this.trend.carousels.push(t),e.trend.imgList.push({url:t}),this.$forceUpdate()},removeCarousels:function(t){this.trend.carousels.splice(t,1),this.trend.imgList.splice(t,1),this.$forceUpdate()},uploadVideos:function(t){this.trend.videos.push(t),this.$forceUpdate()},removeVideos:function(t){this.trend.videos.splice(t,1),this.trend.videos.length,this.$forceUpdate()},getProductList:function(){var t=this;return o(r.default.mark((function e(){var n,i,c,s,o,a,u;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=t.productList.length){e.next=18;break}return n=t,e.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"getProductListByCardId",cardId:n.user.userInfo.bizCardId}});case 4:return i=e.sent,c=i.result,c.data.forEach((function(t){n.productList.push(t)})),n.checkedProductList=n.productList,e.next=10,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:n.user.userInfo.bizCardId}});case 10:i=e.sent,s=i.result.data,o=s.tags||{card:"",product:"",activity:"",trend:""},a=o.product||"",n.categories=[{label:"全部",checked:!0}],u="",a=a.replace(RegExp("，","g"),","),a.indexOf(",")>0&&a.split(",").forEach((function(t){t.trim().length>0&&u.indexOf(t)<0&&(u+=t,n.categories.push({label:t,checked:!1}))}));case 18:case"end":return e.stop()}}),e)})))()},chooseTag:function(t){var e=this;e.isLoad=!0;var n=[];e.checkedProductList=[],0==t?(n.push("全部"),e.categories[0].checked=!0,e.checkedProductList=e.productList,e.categories.forEach((function(t){"全部"!=t.label&&(t.checked=!1)}))):(e.categories[t].checked=!e.categories[t].checked,e.categories.forEach((function(t){t.checked&&"全部"!=t.label&&n.push(t.label)})),0==n.length?(n.push("全部"),e.categories[0].checked=!0,e.checkedProductList=e.productList):(e.categories[0].checked=!1,e.productList.forEach((function(t){var r=t.tags||"";for(var i in n)if(r.indexOf(n[i])>=0){e.checkedProductList.push(t);break}})))),e.$forceUpdate()},addProduct:function(t){var e=this;e.isPickProduct=!0,e.trend.activityList=[],t.isSelected=!0,e.trend.productList.push(t),e.isShowResource=e.trend.productList.length>0,e.$forceUpdate()},removeProduct:function(t){for(var e=-1,n=0;n<this.trend.productList.length;n++)if(t._id===this.trend.productList[n]._id){e=n;break}this.trend.productList.splice(e,1),t.isSelected=!1,this.$forceUpdate()},getActivityList:function(){var t=this;return o(r.default.mark((function e(){var n,i;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=t.activityList.length){e.next=7;break}return n=t,e.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"getActivityListByCardId",cardId:n.user.userInfo.bizCardId}});case 4:i=e.sent,n.activityList=i.result.data,n.activityList.length>0&&(n.activityList.forEach((function(t){t.isSelected=!1;var e=t.sign_up.date+" "+t.sign_up.time,n=t.sign_in.date+" "+t.sign_in.time;t.sign_up=e,t.sign_in=n})),n.$forceUpdate());case 7:case"end":return e.stop()}}),e)})))()},addActivity:function(t){this.isPickProduct=!1,this.trend.productList=[],t.isSelected=!0,this.trend.activityList.push(t),this.isShowResource=this.trend.activityList.length>0,this.$forceUpdate()},removeActivity:function(t){for(var e=-1,n=0;n<this.trend.activityList.length;n++)if(t._id===this.trend.activityList[n]._id){e=n;break}this.trend.activityList.splice(e,1),t.isSelected=!1,this.$forceUpdate()},showModal:function(t){this.isShowResource=!0,this.modalName=t.currentTarget.dataset.target},hideModal:function(t){this.isShowResource=!1,this.modalName=null},tabSelect:function(t){this.tabCur=t.currentTarget.dataset.id,this.scrollLeft=60*(t.currentTarget.dataset.id-1),0===this.tabCur||1===this.tabCur||this.tabCur}}};e.default=v}).call(this,n(1)["default"])},506:function(t,e,n){"use strict";n.r(e);var r=n(507),i=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,(function(){return r[t]}))}(c);e["default"]=i.a},507:function(t,e,n){}},[[500,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/pagesMgt/BizTrendInput.js.map