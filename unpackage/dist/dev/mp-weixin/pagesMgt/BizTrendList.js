(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesMgt/BizTrendList"],{492:function(e,t,n){"use strict";(function(e){n(5);r(n(4));var t=r(n(493));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n(1)["createPage"])},493:function(e,t,n){"use strict";n.r(t);var r=n(494),i=n(496);for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n(498);var a,o=n(15),c=Object(o["default"])(i["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],a);c.options.__file="pagesMgt/BizTrendList.vue",t["default"]=c.exports},494:function(e,t,n){"use strict";n.r(t);var r=n(495);n.d(t,"render",(function(){return r["render"]})),n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(t,"components",(function(){return r["components"]}))},495:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return s})),n.d(t,"components",(function(){return r}));try{r={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,810))}}}catch(o){if(-1===o.message.indexOf("Cannot find module")||-1===o.message.indexOf(".vue"))throw o;console.error(o.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,t=e.$createElement;e._self._c},s=!1,a=[];i._withStripped=!0},496:function(e,t,n){"use strict";n.r(t);var r=n(497),i=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=i.a},497:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(9)),i=n(12),s=a(n(39));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,i,s,a){try{var o=e[s](a),c=o.value}catch(u){return void n(u)}o.done?t(c):Promise.resolve(c).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){o(s,r,i,a,c,"next",e)}function c(e){o(s,r,i,a,c,"throw",e)}a(void 0)}))}}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){n.e("components/ups-trend/index").then(function(){return resolve(n(874))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/ups-product/index").then(function(){return resolve(n(881))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/ups-activity/index").then(function(){return resolve(n(888))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n(810))}.bind(null,n)).catch(n.oe)},v=function(){Promise.all([n.e("common/vendor"),n.e("components/ups-comment/index")]).then(function(){return resolve(n(895))}.bind(null,n)).catch(n.oe)},_={name:"UpsTrendList",components:{"ups-trend":m,"ups-product":p,"ups-activity":f,"ups-comment":v,"uni-popup":h},data:function(){return{title:"",triggered:!1,trendList:[],page:1,trendPlayingIdxs:[],isUps:!1,currentTrend:null,currentIdx:0,tips:"写评论...",repliedName:"",isSubReply:!1,isFocus:!1,currentComment:null,commentList:[],commentListPage:1,replyInfo:{isReply:!1,pidx:0,comment_id:""},lastComment:{},lastReply:{},inputContent:"",textCont:0,itemModalName:null}},onLoad:function(e){var t=this;this.title=e.title,this._freshing=!1,setTimeout((function(){t.triggered=!0}),100),this.page=1},onShow:function(){this.getList()},onPullDownRefresh:function(){this.page=1,this.getList(),e.stopPullDownRefresh()},onReachBottom:function(){this.page=this.page+1,this.getList()},onShareAppMessage:function(t){this.$refs["showMore"].close();var n=t.target.dataset.trend;if("button"===t.from)return{title:n.content,imageUrl:n.cover,path:"/pagesCmn/trend/ShareTrendDetail?id="+n._id,success:function(t){e.showToast({icon:"success",title:"分享成功"})}}},computed:d({},(0,i.mapState)(["user","cloudPath"])),methods:{onRefresh:function(){var e=this;this._freshing||(this._freshing=!0,setTimeout((function(){e.triggered=!1,e._freshing=!1}),600),this.page=1,this.getList())},onRestore:function(){this.triggered="restore"},getRefresh:function(){this.page=1,this.getList()},getYiShow:function(){this.page=this.page+1,this.getList()},togglePopup:function(e,t,n){var i=this;return c(r.default.mark((function s(){var a,o,c;return r.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(a=i,a.currentTrend=e,!a.currentTrend.card_id){s.next=12;break}o=a.user.managed_card||{},s.t0=r.default.keys(o);case 5:if((s.t1=s.t0()).done){s.next=12;break}if(c=s.t1.value,o[c].card_id!=a.currentTrend.card_id){s.next=10;break}return a.currentTrend.isOwner=!0,s.abrupt("break",12);case 10:s.next=5;break;case 12:a.currentIdx=t,a.commentListPage=1,a.getCommentList(),a.$nextTick((function(){a.$refs["show"+n].open()}));case 16:case"end":return s.stop()}}),s)})))()},cancel:function(e){this.$refs["show"+e].close()},change:function(e){e.show?this.isUps=!0:this.isUps=!1},removeChange:function(e){e.show},onBackPress:function(){this.$refs["showMore"].close(),this.$refs["showComments"].close()},operateTrend:function(e,t,n){var i=this;return c(r.default.mark((function s(){var a,o,c;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=i,"addLike"!=e){r.next=11;break}return a.trendList[n].isLike=!0,a.trendList[n].likes_num||(a.trendList[n].likes_num=0),a.trendList[n].likes_num+=1,o={user_id:a.user._id,name:a.user.userInfo.nickName,avatar:a.user.userInfo.avatarUrl,create_at:new Date},r.next=8,wx.cloud.callFunction({name:"cmn",data:{$url:"addTrendLike",id:t._id,like:o}});case 8:a.$forceUpdate(),r.next=18;break;case 11:if("removeLike"!=e){r.next=18;break}return a.trendList[n].isLike=!1,a.trendList[n].likes_num-=1,c={user_id:a.user._id},r.next=17,wx.cloud.callFunction({name:"cmn",data:{$url:"removeTrendLike",id:t._id,like:c}});case 17:a.$forceUpdate();case 18:case"end":return r.stop()}}),s)})))()},goMy:function(){e.reLaunch({url:"/pages/my/home"})},goAdd:function(){e.navigateTo({url:"/pagesMgt/BizTrendInput"})},getList:function(){var e=this;return c(r.default.mark((function t(){var n,i,a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,1==n.page&&(n.trendList=[]),i=[],a=null,t.next=6,wx.cloud.callFunction({name:"cmn",data:{$url:"getTrendListByCardId",cardId:n.user.userInfo.bizCardId,page:n.page}});case 6:a=t.sent,i=a.result.data,i.forEach((function(e){e.createAt=s.default.formatTime(e.create_at,"yyyy-MM-dd HH:mm")})),Object.assign(n.trendList,a.result.data),n.observerTrendsVideo(),n.$forceUpdate();case 12:case"end":return t.stop()}}),t)})))()},observerTrendsVideo:function(){var e=this,t=this;t.trendList.forEach((function(n,r){var i=wx.createIntersectionObserver(e,{thresholds:[.8]});i.relativeToViewport().observe("#tid"+r,(function(e){e.intersectionRatio>.8?t.$refs.refTrend[r].playVideo():e.intersectionRatio>0&&t.$refs.refTrend[r].pauseVideo()}))}))},getCommentList:function(t){var n=this;return c(r.default.mark((function i(){var s,a,o;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(s=n,s.currentTrend){r.next=3;break}return r.abrupt("return");case 3:return 1==s.commentListPage&&(s.commentList=[]),a=[],o=null,r.next=8,wx.cloud.callFunction({name:"cmn",data:{$url:"getCommentList",trendId:s.currentTrend._id,userId:s.user._id,page:s.commentListPage}});case 8:o=r.sent,a=o.result.data,a.length>0?a.forEach((function(e){s.commentList.push(e)})):s.commentListPage--,"refresh"==t&&e.stopPullDownRefresh(),s.$forceUpdate();case 13:case"end":return r.stop()}}),i)})))()},sendComment:function(t){var n=this;return c(r.default.mark((function t(){var i,s;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=n,!i.inputContent){t.next=11;break}return s=null,t.next=5,wx.cloud.callFunction({name:"sys",data:{$url:"msgSecCheck",value:i.inputContent}});case 5:if(s=t.sent,0==s.result.code){t.next=10;break}return e.showToast({icon:"none",title:"内容含有违规内容，请修改后提交"}),i.inputContent="",t.abrupt("return");case 10:i.doSendComment();case 11:i.tips="写评论...",i.$forceUpdate();case 13:case"end":return t.stop()}}),t)})))()},doSendComment:function(){var e=this;return c(r.default.mark((function t(){var n,i,s,a,o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e,!n.replyInfo.isReply){t.next=22;break}return n.lastReply.user_id||(n.lastReply.trend_id=n.currentTrend._id,n.lastReply.user_id=n.user._id,n.lastReply.name=n.user.userInfo.nickName,n.lastReply.avatar=n.user.userInfo.avatarUrl),n.lastReply.create_at=new Date,n.lastReply.content=n.inputContent,n.lastReply.replied_name=n.repliedName,n.lastReply.is_sub_reply=n.isSubReply,n.lastReply.uid=n.genCommentReplyUid(10),t.next=10,wx.cloud.callFunction({name:"cmn",data:{$url:"addCommentReply",id:n.replyInfo.comment_id,trendId:n.currentTrend._id,reply:n.lastReply}});case 10:return n.commentList[n.replyInfo.pidx].replys_num||(n.commentList[n.replyInfo.pidx].replys_num=0,n.commentList[n.replyInfo.pidx].replys=[]),n.commentList[n.replyInfo.pidx].replys_num+=1,i={},Object.assign(i,n.lastReply),n.commentList[n.replyInfo.pidx].replys.push(i),n.inputContent="",n.replyInfo.isReply=!1,delete n.lastReply.uid,t.next=20,wx.cloud.callFunction({name:"cmn",data:{$url:"commentCount",type:"inc",trendId:n.currentTrend._id}});case 20:t.next=38;break;case 22:return n.lastComment.user_id||(n.lastComment.trend_id=n.currentTrend._id,n.lastComment.user_id=n.user._id,n.lastComment.name=n.user.userInfo.nickName,n.lastComment.avatar=n.user.userInfo.avatarUrl),n.lastComment.create_at=new Date,n.lastComment.content=n.inputContent,n.lastComment.replys=[],s=null,t.next=29,wx.cloud.callFunction({name:"cmn",data:{$url:"addComment",comment:n.lastComment}});case 29:return s=t.sent,n.lastComment._id=s.result._id,a={},Object.assign(a,n.lastComment),n.commentList.push(a),n.inputContent="",delete n.lastComment._id,t.next=38,wx.cloud.callFunction({name:"cmn",data:{$url:"commentCount",type:"inc",trendId:n.currentTrend._id}});case 38:n.currentTrend.comments_num++,t.t0=r.default.keys(n.trendList);case 40:if((t.t1=t.t0()).done){t.next=47;break}if(o=t.t1.value,n.trendList[o]._id!=n.currentTrend._id){t.next=45;break}return n.trendList[o].comments_num=n.currentTrend.comments_num,t.abrupt("break",47);case 45:t.next=40;break;case 47:n.tips="写评论...",n.$forceUpdate();case 49:case"end":return t.stop()}}),t)})))()},contentInput:function(e){if(this.textCont=e.detail.value.length,this.replyInfo.isReply){var t=e.detail.value;0==t.length&&(this.replyInfo.isReply=!1)}this.$forceUpdate()},operateComment:function(e,t,n,i){var s=this;return c(r.default.mark((function i(){var a,o,c;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=s,"addLike"!=e){r.next=10;break}return a.commentList[n].isLike=!0,a.commentList[n].likes_num||(a.commentList[n].likes_num=0),a.commentList[n].likes_num+=1,o={user_id:a.user._id,name:a.user.userInfo.nickName,avatar:a.user.userInfo.avatarUrl,create_at:new Date},r.next=8,wx.cloud.callFunction({name:"cmn",data:{$url:"addTrendLike",id:t._id,like:o}});case 8:r.next=24;break;case 10:if("removeComment"!=e){r.next=15;break}a.currentComment=t,a.$nextTick((function(){a.$refs["showRemove"].open()})),r.next=24;break;case 15:if("removeLike"!=e){r.next=23;break}return a.commentList[n].isLike=!1,a.commentList[n].likes_num-=1,c={user_id:a.user._id},r.next=21,wx.cloud.callFunction({name:"cmn",data:{$url:"removeTrendLike",id:t._id,like:c}});case 21:r.next=24;break;case 23:"addReply"==e&&(a.isFocus=!0,a.replyInfo.isReply=!0,a.replyInfo.pidx=n,a.replyInfo.comment_id=a.commentList[n]._id,a.tips="回复 "+t.name,a.repliedName=t.name,a.isSubReply=!1,a.inputContent="");case 24:a.$forceUpdate();case 25:case"end":return r.stop()}}),i)})))()},operateReply:function(e,t,n,i){var s=this;return c(r.default.mark((function a(){var o,c,u;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o=s,"addLike"!=e){r.next=10;break}return o.commentList[i].replys[n].isLike=!0,o.commentList[i].replys[n].likes_num||(o.commentList[i].replys[n].likes_num=0),o.commentList[i].replys[n].likes_num+=1,c={user_id:o.user._id,name:o.user.userInfo.nickName,avatar:o.user.userInfo.avatarUrl,create_at:new Date},r.next=8,wx.cloud.callFunction({name:"cmn",data:{$url:"addCommentReplyLike",id:o.commentList[i]._id,replyUid:t.uid,like:c}});case 8:r.next=19;break;case 10:if("removeLike"!=e){r.next=18;break}return o.commentList[i].replys[n].isLike=!1,o.commentList[i].replys[n].likes_num-=1,u={user_id:o.user._id},r.next=16,wx.cloud.callFunction({name:"cmn",data:{$url:"removeCommentReplyLike",id:o.commentList[i]._id,replyUid:t.uid,like:u}});case 16:r.next=19;break;case 18:"addReply"==e&&(o.isFocus=!0,o.replyInfo.isReply=!0,o.replyInfo.pidx=i,o.replyInfo.comment_id=o.commentList[i]._id,o.tips="回复 "+t.name,o.repliedName=t.name,o.isSubReply=!0,o.inputContent="");case 19:o.$forceUpdate();case 20:case"end":return r.stop()}}),a)})))()},commentExpend:function(e){e.isSpread?e.isSpread=!1:e.isSpread=!0,this.$forceUpdate()},genCommentReplyUid:function(e){return Math.random().toString(20).substr(3,e)},loadMoreComments:function(){this.inputContent="",this.commentListPage+=1,this.getCommentList()},removeTrend:function(t){var n=this;return c(r.default.mark((function i(){var s,a;return r.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=n,s.$refs["showMore"].close(),i.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"removeTrend",content:t}});case 4:e.showToast({icon:"success",title:"删除成功"}),i.t0=r.default.keys(s.trendList);case 6:if((i.t1=i.t0()).done){i.next=13;break}if(a=i.t1.value,s.trendList[a]._id!=t._id){i.next=11;break}return s.trendList.splice(a,1),i.abrupt("break",13);case 11:i.next=6;break;case 13:n.$forceUpdate();case 14:case"end":return i.stop()}}),i)})))()},switchComments:function(e){var t=this;return c(r.default.mark((function n(){var i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t,i.$refs["showMore"].close(),n.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"switchComments",id:e._id,isOpenComments:!e.is_open_comments}});case 4:t.currentTrend.is_open_comments=!e.is_open_comments,t.$forceUpdate();case 6:case"end":return n.stop()}}),n)})))()},removeComment:function(e){var t=this;return c(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$refs["showRemove"].close(),n.next=3,wx.cloud.callFunction({name:"cmn",data:{$url:"removeComment",id:t.currentTrend._id,content:e}});case 3:t.currentTrend.comments_num--,t.getCommentList("refresh"),t.$forceUpdate();case 6:case"end":return n.stop()}}),n)})))()},showActivityModal:function(e,t){this.isUps=!0,this.currentTrend=e,1==this.currentTrend.activityList.length?this.goActivityDetail(this.currentTrend.activityList[0]):(this.itemModalName=t,this.title="备选活动")},showProductModal:function(e,t){this.isUps=!0,this.currentTrend=e,1==this.currentTrend.productList.length?this.goProductDetail(this.currentTrend.productList[0]):(this.itemModalName=t,this.title="备选产品")},goActivityDetail:function(t){e.navigateTo({url:"/pagesCmn/activity/ShareActivityDetail?id="+t._id})},goProductDetail:function(t){e.navigateTo({url:"/pagesCmn/product/ShareProductDetail?id="+t._id})},hideSideModal:function(e){this.isUps=!1,this.itemModalName=null,this.title="展台"},goQrcode:function(t){var n=this;n.$refs["showMore"].close();var r=t.currentTarget.dataset.trend;e.navigateTo({url:"/pagesCmn/trend/TrendQrcode?id="+r._id})}}};t.default=_}).call(this,n(1)["default"])},498:function(e,t,n){"use strict";n.r(t);var r=n(499),i=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=i.a},499:function(e,t,n){}},[[492,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/pagesMgt/BizTrendList.js.map