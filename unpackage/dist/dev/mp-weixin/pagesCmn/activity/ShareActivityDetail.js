(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesCmn/activity/ShareActivityDetail"],{592:function(t,e,n){"use strict";(function(t){n(5);i(n(4));var e=i(n(593));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n(1)["createPage"])},593:function(t,e,n){"use strict";n.r(e);var i=n(594),r=n(596);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n(598);var u,c=n(15),o=Object(c["default"])(r["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],u);o.options.__file="pagesCmn/activity/ShareActivityDetail.vue",e["default"]=o.exports},594:function(t,e,n){"use strict";n.r(e);var i=n(595);n.d(e,"render",(function(){return i["render"]})),n.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(e,"components",(function(){return i["components"]}))},595:function(t,e,n){"use strict";var i;n.r(e),n.d(e,"render",(function(){return r})),n.d(e,"staticRenderFns",(function(){return u})),n.d(e,"recyclableRender",(function(){return a})),n.d(e,"components",(function(){return i}));try{i={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,810))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var t=this,e=t.$createElement;t._self._c},a=!1,u=[];r._withStripped=!0},596:function(t,e,n){"use strict";n.r(e);var i=n(597),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=r.a},597:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n(9)),r=n(12);function a(t){return t&&t.__esModule?t:{default:t}}function u(t,e,n,i,r,a,u){try{var c=t[a](u),o=c.value}catch(s){return void n(s)}c.done?e(o):Promise.resolve(o).then(i,r)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function c(t){u(a,i,r,c,o,"next",t)}function o(t){u(a,i,r,c,o,"throw",t)}c(void 0)}))}}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n(810))}.bind(null,n)).catch(n.oe)},f={components:{"uni-popup":l},data:function(){return{isUps:!1,activity:{_id:"",qrcode:"",content:""},recipient:{}}},onLoad:function(t){var e=this;if(t.id)e.activity._id=t.id,e.getDetail();else if(t.scene){e.paramsStr+="scene="+t.scene;var n={},i=decodeURIComponent(t.scene).split("&");i.forEach((function(t){var i=t.split("=");n[i[0]]=i[1],"qrcode"==i[0]&&(e.activity.qrcode=i[1])})),e.getDetailByQrcode()}},onShareAppMessage:function(e){if("button"===e.from){var n=e.target.dataset.activity;return{title:n.title,imageUrl:n.cover||"",path:"/pagesCmn/activity/ShareActivityDetail?id="+n._id,success:function(e){t.showToast({icon:"success",title:"分享成功"})}}}},computed:s({},(0,r.mapState)(["needAuthFlag","user","cardAccount"])),methods:s(s({},(0,r.mapMutations)(["needWxAuth","wxAuth","updateUser","updateUserAuth"])),{},{ShareActivityDetail:function(){t.showShareMenu({withShareTicket:!0})},getDetail:function(){var t=this;return c(i.default.mark((function e(){var n,r,a,u;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t,r=null,e.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"getActivityDetail",id:n.activity._id}});case 4:r=e.sent,n.activity=r.result.data,a=n.activity.sign_up.date+" "+n.activity.sign_up.time,u=n.activity.sign_in.date+" "+n.activity.sign_in.time,n.activity.sign_up=a,n.activity.sign_in=u,n.authBizInfo={_id:n.activity.card_id,name:n.activity.name,avatar:n.activity.avatar},n.needWxAuth(n.authBizInfo);case 12:case"end":return e.stop()}}),e)})))()},getDetailByQrcode:function(){var t=this;return c(i.default.mark((function e(){var n,r,a,u;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t,r={},e.next=4,wx.cloud.callFunction({name:"cmn",data:{$url:"getActivityDetailByQrcode",qrcode:n.activity.qrcode}});case 4:r=e.sent,n.activity=r.result.data,a=n.activity.sign_up.date+" "+n.activity.sign_up.time,u=n.activity.sign_in.date+" "+n.activity.sign_in.time,n.activity.sign_up=a,n.activity.sign_in=u,n.authBizInfo={_id:n.activity.card_id,name:n.activity.name,avatar:n.activity.avatar},n.needWxAuth(n.authBizInfo);case 12:case"end":return e.stop()}}),e)})))()},goWebLogin:function(){t.navigateTo({url:"/pages/my/WebLogin"})},startTalk:function(){var e=this;return c(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e,!r.needAuthFlag){n.next=5;break}return r.wxAuth(r.authBizInfo),setTimeout((function(){r.startTalk()}),2e3),n.abrupt("return");case 5:r.updateUserAuth(r.authBizInfo),setTimeout((function(){t.navigateTo({url:"/pagesSys/site/service"})}),1e3);case 7:case"end":return n.stop()}}),n)})))()},goHome:function(){var e=this;if(e.needAuthFlag)return e.wxAuth(e.authBizInfo),void setTimeout((function(){e.goHome()}),2e3);e.updateUserAuth(e.authBizInfo),setTimeout((function(){t.reLaunch({url:"/pages/site/trend?id="+e.authBizInfo._id})}),1e3)},tapJoin:function(){var t=this;if(t.needAuthFlag)return t.wxAuth(t.authBizInfo),void setTimeout((function(){t.tapJoin()}),2e3);t.updateUserAuth(t.authBizInfo),t.$nextTick((function(){t.isUps=!0,t.recipient.name=t.user.userInfo.nickName,t.$refs["showPopup"].open()}))},getPhoneNumber:function(t){var e=this;return c(i.default.mark((function n(){var r,a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e,n.next=3,wx.cloud.callFunction({name:"sys",data:{$url:"getPhone",cloudId:t.detail.cloudID}});case 3:a=n.sent,0==a.result.code&&(wx.showToast({title:"授权成功",success:function(){}}),r.recipient.phone=a.result.data.phoneNumber,r.$forceUpdate());case 5:case"end":return n.stop()}}),n)})))()},cancel:function(t){this.$refs["show"+t].close()},change:function(t){t.show?this.isUps=!0:this.isUps=!1},inputName:function(t){this.user.userInfo.recipient.name=t.detail.value},inputPhone:function(t){this.user.userInfo.recipient.phone=t.detail.value},inputRemark:function(t){this.user.userInfo.recipient.remark=t.detail.value},submitOrder:function(){var e=this;return c(i.default.mark((function n(){var r,a,u,c;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e,a="活动报名",u=[{id:r.activity._id,num:1,state:"enrolled",detail:r.activity}],c={},c.seller_avatar=r.activity.avatar,c.seller_name=r.activity.name,c.user_id=r.user._id,c.avatar=r.user.userInfo.avatarUrl,c.name=r.user.userInfo.nickName,c.items=u,c.recipient=r.recipient,c.activity_id=r.activity._id,c.item_num=1,c.is_finished=!1,c.order_type="activity",n.next=17,wx.cloud.callFunction({name:"cmn",data:{$url:"processOrder",order:c}});case 17:t.showToast({icon:"success",title:a+"成功"}),r.$refs["showPopup"].close(),setTimeout((function(){t.navigateTo({url:"/pages/my/ActivityOrderList"})}),1e3);case 20:case"end":return n.stop()}}),n)})))()},goQrcode:function(e){t.navigateTo({url:"/pagesCmn/activity/ActivityQrcode?id="+e})}})};e.default=f}).call(this,n(1)["default"])},598:function(t,e,n){"use strict";n.r(e);var i=n(599),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=r.a},599:function(t,e,n){}},[[592,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesCmn/activity/ShareActivityDetail.js.map