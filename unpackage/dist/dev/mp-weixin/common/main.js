(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],[function(e,t,n){"use strict";(function(e){n(5);var t=o(n(4)),r=o(n(6)),a=o(n(16)),u=o(n(17));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}wx.__webpack_require_UNI_MP_PLUGIN__=n;var d=function(){n.e("pages/site/home").then(function(){return resolve(n(798))}.bind(null,n)).catch(n.oe)};t.default.component("site",d),t.default.component("my",u.default);var l=function(){n.e("colorui/components/cu-custom").then(function(){return resolve(n(805))}.bind(null,n)).catch(n.oe)};t.default.component("cu-custom",l),t.default.config.ignoredElements.push("wx-open-launch-weapp"),t.default.config.productionTip=!1,t.default.prototype.$store=a.default,r.default.mpType="app";var f=new t.default(i({store:a.default},r.default));e(f).$mount()}).call(this,n(1)["createApp"])},,,,,,function(e,t,n){"use strict";n.r(t);var r=n(7);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n(13);var u,o,s,i,c=n(15),d=Object(c["default"])(r["default"],u,o,!1,null,null,null,!1,s,i);d.options.__file="App.vue",t["default"]=d.exports},function(e,t,n){"use strict";n.r(t);var r=n(8),a=n.n(r);for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);t["default"]=a.a},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(9)),a=o(n(4)),u=n(12);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,a,u,o){try{var s=e[u](o),i=s.value}catch(c){return void n(c)}s.done?t(i):Promise.resolve(i).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function o(e){d(u,r,a,o,s,"next",e)}function s(e){d(u,r,a,o,s,"throw",e)}o(void 0)}))}}var f={onLaunch:function(){var t=this;return l(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.isLogin(),e.getSystemInfo({success:function(e){a.default.prototype.StatusBar=e.statusBarHeight;var t=wx.getMenuButtonBoundingClientRect();a.default.prototype.Custom=t,a.default.prototype.CustomBar=t.bottom+t.top-e.statusBarHeight}}),wx.cloud.init({env:"prod-9goq82ctb17bd75f",traceUser:!0});case 3:case"end":return n.stop()}}),n)})))()},onShow:function(){},onHide:function(){},computed:i({},(0,u.mapState)(["user"])),methods:i({},(0,u.mapMutations)(["isLogin"]))};t.default=f}).call(this,n(1)["default"])},,,,,function(e,t,n){"use strict";n.r(t);var r=n(14),a=n.n(r);for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);t["default"]=a.a},function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var r=n(18),a=n(20);for(var u in a)"default"!==u&&function(e){n.d(t,e,(function(){return a[e]}))}(u);n(22),n(24);var o,s=n(15),i=Object(s["default"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"28fa0c0e",null,!1,r["components"],o);i.options.__file="pages/my/home.vue",t["default"]=i.exports},function(e,t,n){"use strict";n.r(t);var r=n(19);n.d(t,"render",(function(){return r["render"]})),n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(t,"components",(function(){return r["components"]}))},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"render",(function(){return a})),n.d(t,"staticRenderFns",(function(){return o})),n.d(t,"recyclableRender",(function(){return u})),n.d(t,"components",(function(){return r}));try{r={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,810))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement;e._self._c},u=!1,o=[];a._withStripped=!0},function(e,t,n){"use strict";n.r(t);var r=n(21),a=n.n(r);for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);t["default"]=a.a},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n(9)),a=n(12);function u(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,a,u,o){try{var s=e[u](o),i=s.value}catch(c){return void n(c)}s.done?t(i):Promise.resolve(i).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){o(u,r,a,s,i,"next",e)}function i(e){o(u,r,a,s,i,"throw",e)}s(void 0)}))}}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n(810))}.bind(null,n)).catch(n.oe)},f={name:"my",components:{"uni-popup":l},data:function(){return{agree:0,bizCard:{accounts:[]},managedCode:"",sysAdminCode:"",modalName:null,accountSum:{newMsgNum:0,wishOrderNum:0,totalOrderNum:0},currentAction:{},isUps:!1}},onShow:function(){var e=this;e.needWxAuth(),e.user._id&&(e.getAccountSum(),e.getServiceList())},computed:c(c({},(0,a.mapState)(["needAuthFlag","httpPath"])),{},{user:{get:function(){return this.$store.state.user},set:function(e){this.$store.commit("updateUser",e)}},checkRole:function(){return function(e,t){var n=e.userInfo||{role:"normal"},r=n.role.trim().toLowerCase(),a=t||"";a=a.trim().toLowerCase();var u=r.indexOf(a)>-1;return u}}}),methods:c(c({},(0,a.mapMutations)(["needWxAuth","wxAuth","updateUser"])),{},{doAuth:function(){var e=this;return s(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e,0!=n.agree){t.next=4;break}return wx.showToast({title:"请先阅读并同意用户协议与隐私政策",icon:"none"}),t.abrupt("return");case 4:if(!n.needAuthFlag){t.next=8;break}return n.wxAuth(),setTimeout((function(){n.doAuth()}),2e3),t.abrupt("return");case 8:n.getAccountSum(),n.getServiceList(),n.$forceUpdate();case 11:case"end":return t.stop()}}),t)})))()},goMyCard:function(){e.navigateTo({url:"/pagesSys/card/CardDetail"})},showAnotations:function(){var e=this;return s(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e;case 1:case"end":return t.stop()}}),t)})))()},goWebLogin:function(){e.navigateTo({url:"/pages/my/WebLogin"})},hideLoginModal:function(e){this.modalName=null},goMsgList:function(){var t=this;t.needAuthFlag?t.wxAuth(t.authBizInfo):e.navigateTo({url:"/pagesSys/my/MsgList"})},getAccountSum:function(){var e=this;return s(r.default.mark((function t(){var n,a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e,a=null,!n.needAuthFlag){t.next=5;break}return n.wxAuth(n.authBizInfo),t.abrupt("return");case 5:return t.next=7,wx.cloud.callFunction({name:"cmn",data:{$url:"getSum",userId:n.user._id,sourceId:n.user.userInfo.cardId,targetId:n.user.userInfo.bizCardId}});case 7:a=t.sent,0==a.result.code&&(n.accountSum=a.result.data);case 9:case"end":return t.stop()}}),t)})))()},goWishOrderList:function(){var t=this;t.needAuthFlag?t.wxAuth(t.authBizInfo):e.navigateTo({url:"/pagesSys/my/WishOrderList"})},goTotalOrderList:function(){var t=this;t.needAuthFlag?t.wxAuth(t.authBizInfo):e.navigateTo({url:"/pagesSys/my/TotalOrderList"})},getServiceList:function(){var e=this;return s(r.default.mark((function t(){var n,a,u,o,s,i,c;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=null,console.log("getCardDetailById",n.user.userInfo.bizCardId,"that.user._id",n.user._id),t.next=5,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:n.user.userInfo.bizCardId}});case 5:return a=t.sent,n.bizCard=a.result.data,t.next=9,wx.cloud.callFunction({name:"sys",data:{$url:"getUserDetail",id:n.user._id||"0"}});case 9:if(a=t.sent,n.user=a.result.data,n.updateUser(n.user),u=n.user.userInfo.accounts||[],!(u.length>0)){t.next=29;break}t.t0=r.default.keys(n.bizCard.accounts);case 15:if((t.t1=t.t0()).done){t.next=29;break}o=t.t1.value,s=n.bizCard.accounts[o].account_key,t.t2=r.default.keys(u);case 19:if((t.t3=t.t2()).done){t.next=27;break}if(i=t.t3.value,c=u[i].account_key,s!=c){t.next=25;break}return n.bizCard.accounts[o]=u[i],t.abrupt("break",27);case 25:t.next=19;break;case 27:t.next=15;break;case 29:case"end":return t.stop()}}),t)})))()},hideManagedCodeModal:function(e){this.modalName=null},confirmManagedCode:function(){var t=this;return s(r.default.mark((function n(){var a,u,o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t,0!=a.managedCode.length){n.next=4;break}return e.showToast({icon:"none",title:"请输入管理码"}),n.abrupt("return");case 4:if(u=/^[0-9]*$/,u.test(a.managedCode)){n.next=8;break}return e.showToast({icon:"none",title:"只能输入数字"}),n.abrupt("return");case 8:return n.next=10,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:a.user.userInfo.bizCardId}});case 10:if(o=n.sent,a.managedCode==o.result.data.password.card_admin){n.next=14;break}return e.showToast({icon:"none",title:"授权码错误"}),n.abrupt("return");case 14:return a.user.userInfo.password||(a.user.userInfo.password={card_admin:""}),a.user.userInfo.password.card_admin=a.managedCode,a.updateUser(a.user),n.next=19,wx.cloud.callFunction({name:"sys",data:{$url:"updateUserInfo",id:a.user._id,userInfo:a.user.userInfo}});case 19:a.modalName=null,a.navigateTo(a.currentAction.url,a.currentAction.title);case 21:case"end":return n.stop()}}),n)})))()},hideSysAdminCodeModal:function(e){this.modalName=null},confirmSysAdminCode:function(){var t=this;return s(r.default.mark((function n(){var a,u,o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t,0!=a.sysAdminCode.length){n.next=4;break}return e.showToast({icon:"none",title:"请输入系统密码"}),n.abrupt("return");case 4:if(u=/^[0-9]*$/,u.test(a.sysAdminCode)){n.next=8;break}return e.showToast({icon:"none",title:"只能输入数字"}),n.abrupt("return");case 8:return n.next=10,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:a.user.userInfo.bizCardId}});case 10:if(o=n.sent,a.sysAdminCode==o.result.data.password.sys_admin){n.next=14;break}return e.showToast({icon:"none",title:"授权码错误"}),n.abrupt("return");case 14:return a.user.userInfo.password||(a.user.userInfo.password={sys_admin:""}),a.user.userInfo.password.sys_admin=a.sysAdminCode,a.updateUser(a.user),n.next=19,wx.cloud.callFunction({name:"sys",data:{$url:"updateUserInfo",id:a.user._id,userInfo:a.user.userInfo}});case 19:a.modalName=null,a.navigateTo(a.currentAction.url,a.currentAction.title);case 21:case"end":return n.stop()}}),n)})))()},searchAction:function(e){for(var t=this,n=e.detail.value.toLowerCase(),r=0;r<t.bizCard.accounts.length;r++){var a=n,u=t.bizCard.accounts[r].title.toLowerCase();t.bizCard.accounts[r].is_show=-1!=u.search(a)}},go:function(t){var n=this;return s(r.default.mark((function a(){var u,o,s,i,c,d,l,f,p,m;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(u=n,!u.needAuthFlag){a.next=4;break}return u.wxAuth(u.authBizInfo),a.abrupt("return");case 4:if(0!=t.url.length){a.next=7;break}return e.showToast({icon:"none",title:t.title+"暂未开放！"}),a.abrupt("return");case 7:if(u.currentAction=t,u.modalName="",console.log("modalName",u.modalName,"action",t,"role",u.user.userInfo.role),!u.user.userInfo.role){a.next=69;break}if(!t.is_forbidden){a.next=50;break}if("cardAdmin"!=t.need_role){a.next=32;break}if(-1!=u.user.userInfo.role.indexOf("cardAdmin")){a.next=30;break}if(!u.user.userInfo.password){a.next=28;break}return o={},s="",a.next=19,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:u.user.userInfo.bizCardId}});case 19:if(o=a.sent,s=o.result.data.password.card_admin,i=u.user.userInfo.password||{card_admin:""},i.card_admin==s){a.next=26;break}e.showToast({icon:"none",title:"授权码已失效"}),a.next=28;break;case 26:return u.navigateTo(t.url,t.title),a.abrupt("return");case 28:return u.modalName="ManagedCodeModal",a.abrupt("return");case 30:a.next=50;break;case 32:if("sysAdmin"!=t.need_role){a.next=50;break}if(-1!=u.user.userInfo.role.indexOf("sysAdmin")){a.next=50;break}if(!u.user.userInfo.password){a.next=48;break}return c={},d="",a.next=39,wx.cloud.callFunction({name:"sys",data:{$url:"getCardDetailById",id:u.user.userInfo.bizCardId}});case 39:if(c=a.sent,d=c.result.data.password.sys_admin,l=u.user.userInfo.password||{sys_admin:""},l.sys_admin==d){a.next=46;break}e.showToast({icon:"none",title:"密码已失效"}),a.next=48;break;case 46:return u.navigateTo(t.url,t.title),a.abrupt("return");case 48:return u.modalName="SysAdminCodeModal",a.abrupt("return");case 50:f=!1,a.t0=r.default.keys(u.user.userInfo.accounts);case 52:if((a.t1=a.t0()).done){a.next=65;break}if(p=a.t1.value,m=u.user.userInfo.accounts[p],m.account_key!=t.account_key){a.next=63;break}return m.view_count+=1,u.updateUser(u.user),a.next=60,wx.cloud.callFunction({name:"sys",data:{$url:"updateUserInfo",id:u.user._id,userInfo:u.user.userInfo}});case 60:return f=!0,u.navigateTo(t.url,t.title),a.abrupt("break",65);case 63:a.next=52;break;case 65:if(!f){a.next=67;break}return a.abrupt("return");case 67:a.next=72;break;case 69:return console.log("normal用户没有功能权限"),e.showToast({icon:"none",title:"请先申请"+t.title+"权限！"}),a.abrupt("return");case 72:u.navigateTo(t.url,t.title);case 73:case"end":return a.stop()}}),a)})))()},navigateTo:function(t,n){"navigateToMiniProgram"==t?wx.navigateToMiniProgram({appId:"wx57628b80a1d8f511",path:"/pages/MainLogin",extraData:{},success:function(e){console.log("开启成功")}}):e.navigateTo({url:t+"?title="+n})},setAgree:function(e){this.agree=e.detail.value,console.log("agree:"+this.agree)},popupContract:function(){var e=this;console.log("popupContract"),e.isUps=!0,this.$nextTick((function(){e.$refs["showPopupContract"].open()}))},change:function(e){e.show?this.isUps=!0:this.isUps=!1},cancel:function(e){this.$refs["show"+e].close()}})};t.default=f}).call(this,n(1)["default"])},function(e,t,n){"use strict";n.r(t);var r=n(23),a=n.n(r);for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);t["default"]=a.a},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(25),a=n.n(r);for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);t["default"]=a.a},function(e,t,n){}],[[0,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/common/main.js.map