{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/ActivityDetail.vue?e6fd","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/ActivityDetail.vue?b738","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/ActivityDetail.vue?47e5","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/ActivityDetail.vue?2a4f","uni-app:///pagesVoucher/biz-voucher/ActivityDetail.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/ActivityDetail.vue?a76c"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","that","isLoad"],"mappings":"qJAAA,KACA,YACA,Y,mDAFmBA,GAAGC,kCAAoCC,EAG1DC,EAAWC,a,gECHX,yHACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,8CACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCRvB,8GAA60B,eAAG,G,8HC+Fh1B,Q,4iCAEA,CACE,KADF,WAEI,MAAJ,CACM,QAAN,EACM,SAAN,EACM,OAAN,EACM,MAAN,GACM,SAAN,CACQ,KAAR,GACQ,OAAR,GACQ,QAAR,GACQ,UAAR,GACQ,UAAR,GACQ,UAAR,GACQ,SAAR,GACQ,WAAR,GACQ,MAAR,EACQ,cAAR,GACQ,SAAR,EACQ,UAAR,IACQ,UAAR,EACQ,SAAR,EACQ,aAAR,KACQ,KAAR,CACU,kBAAV,EACU,iBAAV,EACU,kBAAV,EACU,iBAAV,GAEQ,WAAR,IAEM,UAAN,eACM,gBAAN,EACM,WAAN,KAEM,KAAN,EACM,YAAN,EACM,WAAN,KAGE,OAxCF,SAwCA,GACI,IAAJ,OACA,yBACA,MACM,EAAN,gBAEA,cACM,EAAN,0BAEI,EAAJ,eAEI,YAAJ,WACM,EAAN,aACA,MAGE,kBAxDF,SAwDA,GACI,IAAJ,OACI,QAAJ,aAII,IAAJ,aAEI,GADA,QAAJ,0CACA,4BAOI,GAAJ,kCAQI,GAAJ,2FACM,EAAN,WACQ,KAAR,OACQ,MAAR,iBAII,GAAJ,mBACM,IAAN,4BAsBM,OArBA,QAAN,2CACM,EAAN,UAEM,EAAN,8EAEM,EAAN,yBACM,EAAN,4BACM,EAAN,8EACA,wBACQ,EAAR,yBAEM,GAAN,oBACQ,KAAR,MACQ,KAAR,CACU,KAAV,eACU,SAAV,cAEM,MAAN,YACQ,EAAR,qBACQ,EAAR,aAEA,CACQ,MAAR,+BACQ,SAAR,oCACQ,KAAR,kFACQ,QAAR,YACU,EAAV,WACY,KAAZ,UACY,MAAZ,iBA5CM,EAAN,WACQ,KAAR,OACQ,MAAR,gBATM,EAAN,WACQ,KAAR,OACQ,MAAR,YAwDE,SAAF,MACE,EAAF,uBAEE,QAAF,CACI,YADJ,SACA,yIACgB,EAAhB,EACgBC,EAAKC,QAAS,GACd,EAHhB,gCAIkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,oBACsB,GAAtB,UARA,OAIA,EAJA,OAWgB,QAAhB,mBACA,mBACkB,EAAlB,cACkB,EAAlB,cACkB,EAAlB,+BACkB,EAAlB,+BACkB,EAAlB,6BACkB,EAAlB,qBACkB,EAAlB,qBAEkB,EAAlB,gBArBA,8CAyBI,UA1BJ,SA0BA,yIACgB,EAAhB,EACgBD,EAAKC,QAAS,GACd,EAHhB,iCAIkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,oBACsB,GAAtB,UARA,OAIA,EAJA,OAWgB,QAAhB,mBACA,mBACkB,EAAlB,uBACkB,EAAlB,qBACkB,EAAlB,2CACkB,EAAlB,oCAEkB,EAAlB,6CACkB,EAAlB,wDAnBA,wBAyBgB,EAAhB,iCAzBA,QA2BgBD,EAAKC,QAAS,EA3B9B,+CA8BI,cAxDJ,WAwDA,yHACA,EADA,gD,2ECvRA,8GAAorC,eAAG,G","file":"pagesVoucher/biz-voucher/ActivityDetail.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesVoucher/biz-voucher/ActivityDetail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./ActivityDetail.vue?vue&type=template&id=c17650bc&\"\nvar renderjs\nimport script from \"./ActivityDetail.vue?vue&type=script&lang=js&\"\nexport * from \"./ActivityDetail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ActivityDetail.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesVoucher/biz-voucher/ActivityDetail.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ActivityDetail.vue?vue&type=template&id=c17650bc&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ActivityDetail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ActivityDetail.vue?vue&type=script&lang=js&\"","<template>\n    <view>\n        <cu-custom    :isBack=\"true\">\n            <block slot=\"content\">{{activity.card_name}}</block>\n            <block slot=\"right\">\n                <view class=\"action\">\n                    <view class=\"cu-load load-cuIcon\" :class=\"isLoad?'loading':'over'\"></view>\n                </view>\n            </block>\n        </cu-custom>\n        <scroll-view>\n            <view scroll-y class=\"quan\">\n                <view class=\"flex card bg-white\">\n                    <view class=\"quan-text\">\n                        <view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+activity.bg_color\"></view>\n                        <view class=\"flex\">\n                            <view  class=\"cu-avatar round lg margin-right-sm\">\n                                <image :src=\"activity.avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n                            </view>\n                            <view class=\"content\">\n                                <view class=\"text-grey text-xl\">{{activity.name}}\n                                    <text class=\"text-abc\"></text>\n                                </view>\n                                <view class=\"text-gray text-sm\">有效期：{{activity.valid_date}}</view>\n                            </view>\n                        </view>\n                    </view>\n                    <view class=\"rel quan-right\">\n                        <view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n                            <text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n                            <text class=\"text-bold text-xxl \">{{activity.price}}</text>\n                        </view>\n                        <view class=\"solid-bottom\">\n                            <view class='cu-tag round ﻿bg-grey light' >{{activity.num_total-activity.num_used}} 张可用</view>\n                        </view>\n                    </view>\n                </view>\n            </view>\n            <view v-if=\"activity.status=='IN_PROCESS'\" class=\"flex ﻿align-center﻿justify-start margin-sm bg-white radius\">\n                <text class=\"flex-twice align-center margin-left\">发券数量：</text>\n                <input class=\"flex-treble align-center cu-progress radius\" placeholder=\"请输入发券数量\" v-model=\"activity.num_send\"></input>\n                <button class=\"flex-twice cu-btn  shadow-blur margin-sm line-grey\"  :disabled=\"isLoad\" :data-activity=\"activity\" open-type=\"share\">分享发券</button>\n            </view>\n\n            <view class=\"margin-sm\">\n                <view class=\"cu-bar bg-white solid-bottom margin-top-xs\">\n                    <view class=\"action\">\n                        <text class=\"cuIcon-title text-orange\"></text> 活动规则\n                    </view>\n                </view>\n                ﻿<view class=\"cu-list menu\">\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">使用条件：</text>\n                            <text >{{activity.use_condition}}</text>\n                        </view>\n                    </view>\n                    <!--<view class=\"cu-item\">-->\n                        <!--<view class=\"content\">-->\n                            <!--<text class=\"text-grey\">领取限制：</text>-->\n                            <!--<text >每位限领{{activity.num_limit}}张</text>-->\n                        <!--</view>-->\n                    <!--</view>-->\n                </view>\n                <view class=\"cu-bar bg-white solid-bottom margin-top-xs\">\n                    <view class=\"action\">\n                        <text class=\"cuIcon-title text-orange\"></text> 使用规则\n                    </view>\n                </view>\n                ﻿<view class=\"cu-list menu\">\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">有效日期：</text>\n                            <text>{{activity.valid_date}}</text>\n                        </view>\n                    </view>\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">可用时段：</text>\n                            <text>{{activity.valid_time}}</text>\n                        </view>\n                    </view>\n                    <view class=\"cu-item\">\n                        <view class=\"content flex\">\n                            <text class=\"text-grey\">使用须知：</text>\n                            <textarea class=\"flex-wrap\" style=\"width: 76%\" maxlength=\"140\" v-model=\"activity.remark\"></textarea>\n                        </view>\n                    </view>\n                </view>\n            </view>\n        </scroll-view>\n    </view>\n</template>\n\n<script>\n    import { mapState ,mapMutations} from 'vuex'\n\n    export default {\n        data() {\n            return {\n                isLoad:false,\n                loading: false,\n                isUps:false,\n                title:'',\n                activity:{\n                    name:'',\n                    avatar:'',//企业头像\n                    card_id:'',//卡ID\n                    card_name:'',\n                    type_code:'',\n                    type_name:'',\n                    entry_id:'',\n                    entry_name:'',\n                    price:0,\n                    use_condition:'',\n                    num_send:0,//发送数量\n                    num_total:100,\n                    num_limit:1,\n                    num_used:1,\n                    num_progress:'0%',//进度\n                    rule:{\n                        forbidden_region:false,\n                        verified_reward:false,\n                        forbidden_reward:false,\n                        forbidden_share:false\n                    },\n                    valid_date:''\n                },\n                CustomBar: this.CustomBar,\n                existEntryFlag:false,//存在备选入口\n                searchList: [{}],//核销备选入口\n                //检索\n                page: 1,\n                loadingType: 0,//上拉的状态：0-loading前；1-loading中；2-没有更多了\n                search_str: '',//检索关键字\n            }\n        },\n        onLoad(options) {\n            let that = this;\n\t\t\tconsole.log('options',options);\n            if(options.id){\n                that.getDetail(options.id);\n            }\n            if(options.templateId){\n                that.getTemplate(options.templateId);\n            }\n            that.$forceUpdate();\n            //用于延迟加载进度条，不可以去掉\n            setTimeout(function() {\n                that.loading = true\n            }, 500)\n        },\n\n        onShareAppMessage(res){\n            let that = this;\n            console.log('res',res);\n\n            //==============\n            //只能输入数字\n            let reg = /^[0-9]*$/;\n            console.log('只能输入数字',reg.test(that.activity.num_send));\n            if(!reg.test(that.activity.num_send)){\n                uni.showToast({\n                    icon:'none',\n                    title:'只能输入数字'\n                })\n                return;\n            }\n            if(parseInt(that.activity.num_send)==0){\n                uni.showToast({\n                    icon:'none',\n                    title:'面额不能为零'\n                })\n                return;\n            }\n\n            if(parseInt(that.activity.num_send)+parseInt(that.activity.num_used)>parseInt(that.activity.num_total)){\n                uni.showToast({\n                    icon:'none',\n                    title:'剩余券数额不足'\n                })\n                return;\n            }\n            if(res.from=== 'button'){\n                let  activity = res.target.dataset.activity;\n                console.log('activity share res',activity.name,activity.cover,res);\n                that.isLoad = true;\n                //更新占用券数\n                that.activity.num_used = parseInt(that.activity.num_used)+parseInt(that.activity.num_send);\n                //对方未接受标记为false，对方收取后标记为true\n                that.activity.num_send_used = 0;\n                that.activity.receive_success = false;\n                that.activity.leftNum = parseInt(that.activity.num_total)-parseInt(that.activity.num_used);\n                if(that.activity.leftNum==0){\n                    that.activity.status='CLOSE'\n                }\n                wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'saveActivity',\n                        activity:that.activity\n                    }\n                }).then((resAct)=>{\n                    that.activity.num_send = '';\n                    that.isLoad = false;\n                });\n                return{\n                    title:res.target.dataset.activity.name,\n                    imageUrl:res.target.dataset.activity.cover||'',\n                    path:\"/pagesVoucher/biz-voucher/ShareActivityDetail?id=\"+res.target.dataset.activity._id,\n                    success:function(r){\n                        uni.showToast({\n                            'icon':'success',\n                            'title':'分享成功'\n                        });\n                    }\n                }\n            }\n        },\n\n        computed:{\n            ...mapState(['user']),\n        },\n        methods: {\n            async getTemplate(templateId){\n                let that = this;\n                that.isLoad = true;\n                if(templateId){\n                    let res = await wx.cloud.callFunction({\n                        name:'vou',\n                        data:{\n                            $url:'getTemplateDetail',\n                            id:templateId||'0',\n                        }\n                    });\n                    console.log('getDetail',res);\n                    if(res.result.code==0){\n                        let template = res.result.data;\n                        that.title = template.title;\n                        that.activity.type_code = template.type_code;\n                        that.activity.type_name = template.type_name;\n                        that.activity.bg_color = template.bg_color;\n                        that.activity.icon = template.icon;\n                        that.activity.num_send = '';\n\n                        that.$forceUpdate();\n                    }\n                }\n            },\n            async getDetail(id){\n                let that = this;\n                that.isLoad = true;\n                if(id){\n                    let res = await wx.cloud.callFunction({\n                        name:'vou',\n                        data:{\n                            $url:'getActivityDetail',\n                            id:id||'0',\n                        }\n                    });\n                    console.log('getDetail',res);\n                    if(res.result.code==0){\n                        that.activity = res.result.data;\n                        that.activity.num_send= '';\n                        that.activity.num_used= that.activity.num_used||'0';\n                        that.getTemplate(that.activity.template_id);\n                        //计算进度\n                        let num = that.activity.num_used/that.activity.num_total*10000;\n                        that.activity.num_progress = new Number(num).toFixed(4)/100+'%';\n                        // console.log('计算进度',num, new Number(num),that.activity.num_progress);\n                    }\n                }\n                //初始化创建券\n                else{\n                    that.activity.user_id = that.user._id||'0';\n                }\n                that.isLoad = false;\n            },\n            //发券\n            async sendMyVoucher(){\n                let that = this;\n\n            },\n        }\n    }\n</script>\n\n<style>\n    .quan{\n        padding: 0 20rpx;\n        z-index: 0;\n    }\n    .font50{\n        font-size: 50rpx;\n    }\n    .card{\n        margin-top: 20rpx;\n        width: 100%;\n        border-radius: 20rpx;\n        padding: 5rpx 30rpx;\n        height: 170rpx;\n    }\n    .font32{\n        font-size: 32rpx;\n    }\n    .line35{\n        line-height: 50rpx;\n    }\n    .font-bold{\n        font-weight: bolder;\n    }\n    .quan-text{\n        width: 640rpx;\n    }\n    .quan-right{\n        width: 200rpx;\n    }\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ActivityDetail.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ActivityDetail.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}