{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/index.vue?82f5","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/index.vue?0ac8","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/index.vue?0827","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/index.vue?66e3","uni-app:///pagesVoucher/biz-voucher/index.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/biz-voucher/index.vue?a23b"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","uniPopup","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","l0","_self","_c","__map","actions","action","index","$orig","__get_orig","m0","checkCardAdminRole","user","userInfo","role","needRole","l1","tabCur","savedActivities","item","m1","formatCreateAt","create_at","l2","InProcessActivities","m2","l3","closeActivities","m3","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","loadingType","name","result","code","isLoad","currentActivity","status","log","getList","$refs","close","itemSelectedId","uni","showToast","icon","page","stopPullDownRefresh","$forceUpdate","partyList","listGroup","cards","num_used","leftNum","parseInt","num_total"],"mappings":"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","file":"pagesVoucher/biz-voucher/index.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesVoucher/biz-voucher/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=5e428280&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesVoucher/biz-voucher/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=5e428280&\"","var components\ntry {\n  components = {\n    uniPopup: function() {\n      return import(\n        /* webpackChunkName: \"components/uni-popup/uni-popup\" */ \"@/components/uni-popup/uni-popup.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.actions, function(action, index) {\n    var $orig = _vm.__get_orig(action)\n\n    var m0 = _vm.checkCardAdminRole(_vm.user.userInfo.role, action.needRole)\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  var l1 =\n    _vm.tabCur == 0\n      ? _vm.__map(_vm.savedActivities, function(item, index) {\n          var $orig = _vm.__get_orig(item)\n\n          var m1 = _vm.formatCreateAt(item.create_at)\n          return {\n            $orig: $orig,\n            m1: m1\n          }\n        })\n      : null\n  var l2 =\n    _vm.tabCur == 1\n      ? _vm.__map(_vm.InProcessActivities, function(item, index) {\n          var $orig = _vm.__get_orig(item)\n\n          var m2 = _vm.formatCreateAt(item.create_at)\n          return {\n            $orig: $orig,\n            m2: m2\n          }\n        })\n      : null\n  var l3 =\n    _vm.tabCur == 2\n      ? _vm.__map(_vm.closeActivities, function(item, index) {\n          var $orig = _vm.__get_orig(item)\n\n          var m3 = _vm.formatCreateAt(item.create_at)\n          return {\n            $orig: $orig,\n            m3: m3\n          }\n        })\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1,\n        l2: l2,\n        l3: l3\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<!--\n卡券管理入口；列出所有制券、发券的活动列表\n-->\n<template>\n\t<view class=\"\" :class=\"isUps == true ? 'prevent' : ''\">\n\t\t<view>\n\t\t\t<cu-custom    :isBack=\"true\">\n\t\t\t\t<block slot=\"content\">卡券管理</block>\n\t\t\t\t<block slot=\"right\">\n\t\t\t\t\t<view class=\"action\">\n\t\t\t\t\t\t<view class=\"cu-load load-cuIcon\" :class=\"isLoad?'loading':'over'\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</block>\n\t\t\t</cu-custom>\n\t\t\t<view class=\"cu-list grid col-5\">\n\t\t\t\t<view class=\"cu-item\" v-for=\"(action,index) in actions\" :key=\"index\" v-if=\"checkCardAdminRole(user.userInfo.role,action.needRole)\" @tap=\"go(action)\">\n\t\t\t\t\t<text class=\"lg text-gray\" :class=\"'cuIcon-' + action.name\"></text>\n\t\t\t\t\t<text>{{action.title}}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<scroll-view scroll-x class=\"bg-white nav\">\n\t\t\t\t<view class=\"flex text-center\">\n\t\t\t\t\t<view class=\"cu-item flex-sub\" :class=\"index==tabCur?'text-green cur':''\" v-for=\"(item,index) in 3\" :key=\"index\" @tap=\"tabSelect\" :data-id=\"index\">\n\t\t\t\t\t\t{{tab[index]}}\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t\t<slot v-if=\"tabCur==0\">\n\t\t\t\t<scroll-view scroll-y class=\"quan\">\n\t\t\t\t\t<view class=\"flex card bg-white\"  v-for=\"(item,index) in savedActivities\" :key=\"item\"  @longpress=\"popupOperate(item)\">\n\t\t\t\t\t\t<view class=\"quan-text\">\n\t\t\t\t\t\t\t<view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+item.bg_color\"></view>\n\t\t\t\t\t\t\t<view class=\"flex\">\n\t\t\t\t\t\t\t\t<view  class=\"cu-avatar round lg margin-right-sm\" @tap=\"goDetail(item)\">\n\t\t\t\t\t\t\t\t\t<image :src=\"item.avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"content\">\n\t\t\t\t\t\t\t\t\t<view class=\"text-grey text-xl\">{{item.name}}\n\t\t\t\t\t\t\t\t\t\t<text class=\"text-abc\"></text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view class=\"text-gray text-sm\">操作时间：{{formatCreateAt(item.create_at)}}</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"rel quan-right\">\n\t\t\t\t\t\t\t<view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n\t\t\t\t\t\t\t\t<text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n\t\t\t\t\t\t\t\t<text class=\"text-bold text-xxl \">{{item.price}}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"solid-bottom\">\n\t\t\t\t\t\t\t\t<view class='cu-tag round ﻿bg-grey light' >{{item.num_total-item.num_used}} 张可用</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</slot>\n\n\t\t\t<slot v-if=\"tabCur==1\">\n\t\t\t\t<scroll-view scroll-y class=\"quan\">\n\t\t\t\t\t<view class=\"flex card bg-white\"  v-for=\"(item,index) in InProcessActivities\" :key=\"item\"   @longpress=\"popupOperate(item)\">\n\t\t\t\t\t\t<view class=\"quan-text\">\n\t\t\t\t\t\t\t<view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+item.bg_color\"></view>\n\t\t\t\t\t\t\t<view class=\"flex\">\n\t\t\t\t\t\t\t\t<view  class=\"cu-avatar round lg margin-right-sm\" @tap=\"goDetail(item)\">\n\t\t\t\t\t\t\t\t\t<image :src=\"item.avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"content\">\n\t\t\t\t\t\t\t\t\t<view class=\"text-grey text-xl\">{{item.name}}\n\t\t\t\t\t\t\t\t\t\t<text class=\"text-abc\"></text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view class=\"text-gray text-sm\">操作时间：{{formatCreateAt(item.create_at)}}</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"rel quan-right\">\n\t\t\t\t\t\t\t<view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n\t\t\t\t\t\t\t\t<text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n\t\t\t\t\t\t\t\t<text class=\"text-bold text-xxl \">{{item.price}}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"solid-bottom\">\n\t\t\t\t\t\t\t\t<view class='cu-tag round ﻿bg-grey light' >{{item.num_total-item.num_used}} 张可用</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</slot>\n\n\t\t\t<slot v-if=\"tabCur==2\">\n\t\t\t\t<scroll-view scroll-y class=\"quan\">\n\t\t\t\t\t<view class=\"flex card bg-white\"  v-for=\"(item,index) in closeActivities\" :key=\"item\"   @longpress=\"popupOperate(item)\">\n\t\t\t\t\t\t<view class=\"quan-text\">\n\t\t\t\t\t\t\t<view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+item.bg_color\"></view>\n\t\t\t\t\t\t\t<view class=\"flex\">\n\t\t\t\t\t\t\t\t<view  class=\"cu-avatar round lg margin-right-sm\" @tap=\"goDetail(item)\">\n\t\t\t\t\t\t\t\t\t<image :src=\"item.avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"content\">\n\t\t\t\t\t\t\t\t\t<view class=\"text-grey text-xl\">{{item.name}}\n\t\t\t\t\t\t\t\t\t\t<text class=\"text-abc\"></text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view class=\"text-gray text-sm\">操作时间：{{formatCreateAt(item.create_at)}}</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"rel quan-right\">\n\t\t\t\t\t\t\t<view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n\t\t\t\t\t\t\t\t<text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n\t\t\t\t\t\t\t\t<text class=\"text-bold text-xxl \">{{item.price}}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"solid-bottom\">\n\t\t\t\t\t\t\t\t<view class='cu-tag round ﻿bg-grey light' >{{item.num_total-item.num_used}}/{{item.num_total}} 张可用</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</slot>\n\t\t\t<view class=\"cu-tabbar-height\"></view>\n\t\t</view>\n\n\t\t<view v-if=\"!isUps\" class=\"cu-bar bg-white tabbar border shop foot\">\n\t\t\t<button class=\"action\" @tap=\"goProduct\">\n\t\t\t\t<view class=\"cuIcon-goods\"></view>产品\n\t\t\t</button>\n\t\t\t<button class=\"action\" @tap=\"goMyCard\" >\n\t\t\t\t<view class=\"cuIcon-vipcard\"></view>名片\n\t\t\t</button>\n\t\t\t<view class=\"action\" @tap=\"goMyHome\">\n\t\t\t\t<view class=\"cuIcon-people\"></view>我的\n\t\t\t</view>\n\t\t\t<view class=\"bg-red submit text-lg\" @tap=\"go(actions[0])\">制作抵用券</view>\n\t\t</view>\n\t\t<!-- 遮罩 -->\n\t\t<view class=\"shade\" v-if=\"isUps\"></view>\n\t\t<!-- 底部扩展功能弹窗 -->\n\t\t<uni-popup ref=\"showPopupOperate\" type=\"bottom\" @change=\"change\">\n\t\t\t<view class=\"popup-base bg-white\">\n\t\t\t\t<view class=\"popup-content margin-top\">\n\t\t\t\t\t<view v-if=\"currentActivity.status=='SAVED'\" class=\"popup-content-box\">\n\t\t\t\t\t\t<button ﻿class=\"cu-btn button-content\" @click=\"goInProcess\">\n\t\t\t\t\t\t\t<view class=\"popup-content-image\">\n\t\t\t\t\t\t\t\t<image src=\"cloud://prod-9goq82ctb17bd75f.7072-prod-9goq82ctb17bd75f-1306535128/resource/publish.png\" class=\"content-image\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<text class=\"popup-content-text\">发布</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view v-if=\"currentActivity.status=='IN_PROCESS'\" class=\"popup-content-box\">\n\t\t\t\t\t\t<button ﻿class=\"cu-btn button-content\" @click=\"openSendVoucher\">\n\t\t\t\t\t\t\t<view class=\"popup-content-image\">\n\t\t\t\t\t\t\t\t<image src=\"cloud://prod-9goq82ctb17bd75f.7072-prod-9goq82ctb17bd75f-1306535128/resource/voucher.png\" class=\"content-image\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<text class=\"popup-content-text\">发券</text>\n\t\t\t\t\t</view>\n\n\t\t\t\t\t<view class=\"popup-content-box\">\n\t\t\t\t\t\t<button ﻿class=\"cu-btn button-content\" @click=\"goDetail\">\n\t\t\t\t\t\t\t<view class=\"popup-content-image\">\n\t\t\t\t\t\t\t\t<image src=\"cloud://prod-9goq82ctb17bd75f.7072-prod-9goq82ctb17bd75f-1306535128/resource/view.png\" class=\"content-image\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<text class=\"popup-content-text\">查看</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view v-if=\"currentActivity.status=='SAVED'\" class=\"popup-content-box\">\n\t\t\t\t\t\t<button  @click=\"goEdit\"﻿ class=\"cu-btn button-content\">\n\t\t\t\t\t\t\t<view class=\"popup-content-image\">\n\t\t\t\t\t\t\t\t<image src=\"cloud://prod-9goq82ctb17bd75f.7072-prod-9goq82ctb17bd75f-1306535128/resource/edit.png\" class=\"content-image\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<text class=\"popup-content-text\">编辑</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view v-if=\"currentActivity.status=='SAVED'\" class=\"popup-content-box\">\n\t\t\t\t\t\t<button  @click=\"remove\"﻿class=\"cu-btn button-content\">\n\t\t\t\t\t\t\t<view class=\"popup-content-image\">\n\t\t\t\t\t\t\t\t<image src=\"cloud://prod-9goq82ctb17bd75f.7072-prod-9goq82ctb17bd75f-1306535128/resource/delete.png\" class=\"content-image\" mode=\"widthFix\" />\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<text class=\"popup-content-text\">删除</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<text class=\"popup-btn\" @click=\"cancel('PopupOperate')\">取消</text>\n\t\t\t</view>\n\t\t</uni-popup>\n\t\t﻿<!-- 底部展现弹窗 -->\n\t\t<uni-popup ref=\"showPartyCard\" type=\"bottom\" @change=\"change\">\n\n\t\t\t﻿<!-- 底部客户名片弹窗 -->\n\t\t\t<view class=\"popup-base bg-white\">\n\t\t\t\t<text class=\"cuIcon-close popup-close\" @click=\"cancel('PartyCard')\"></text>\n\t\t\t\t<text class=\"popup-title\" >用户列表</text>\n\t\t\t\t<view class=\"cu-bar search \">\n\t\t\t\t\t<view class=\"search-form radius\">\n\t\t\t\t\t\t<text class=\"cuIcon-search\"></text>\n\t\t\t\t\t\t<input @focus=\"inputFocus\" @blur=\"inputBlur\" type=\"text\" placeholder=\"输入搜索的关键词\" confirm-type=\"search\"></input>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"action\">\n\t\t\t\t\t\t<button class=\"cu-btn radius shadow-blur line-grey\"  :disabled=\"isLoad\" @tap=\"getPartyList\">搜索</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"popup-content\">\n\t\t\t\t\t<scroll-view class=\"ups-height\" scroll-y=\"true\">\n\t\t\t\t\t\t<block v-for=\"(item,index) in partyList\" :key=\"index\">\n\t\t\t\t\t\t\t<view class=\"padding\">{{partyList[index].group}}</view>\n\t\t\t\t\t\t\t<view class=\"cu-list menu-avatar no-padding\">\n\t\t\t\t\t\t\t\t<view class=\"cu-item  card-radius margin-top-xxs margin-left-xs margin-right-xs margin-bottom-xs shadow rel\"  v-for=\"(subItem,subIndex) in item.subList\" :key=\"subIndex\">\n\t\t\t\t\t\t\t\t\t<view class=\"cu-avatar round lg\" @tap=\"goEdit(subItem.id)\">\n\t\t\t\t\t\t\t\t\t\t<image :src=\"subItem.avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view class=\"content\" @tap=\"goEdit(subItem.id)\">\n\t\t\t\t\t\t\t\t\t\t<view class=\"text-grey\">{{subItem.name}}\n\t\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t\t<view class=\"text-gray text-sm\">{{subItem.position?subItem.position:''}}</view>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view class=\"flex\">\n\t\t\t\t\t\t\t\t\t\t<view>\n\t\t\t\t\t\t\t\t\t\t\t<input placeholder=\"请输入券数\" v-model=\"subItem.num_total\"></input>\n\t\t\t\t\t\t\t\t\t\t\t<input v-if=\"!subItem.send_success\" placeholder=\"请输入备注\" v-model=\"subItem.remark\"></input>\n\t\t\t\t\t\t\t\t\t\t\t<view v-else class=\"text-gray text-sm\">派发{{subItem.remark}} {{subItem.num_total?subItem.num_total:'0'}} 张成功</view>\n\t\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t\t<button  class=\"cu-btn margin-left line-grey radius\" :disabled=\"isLoad\" @tap=\"sendVoucher(index,subIndex,subItem.num_total,subItem.remark)\">发券</button>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</block>\n\t\t\t\t\t\t<!--页面底部抬升-->\n\t\t\t\t\t\t<view class=\"cu-bar solid-bottom margin-top-100\"></view>\n\t\t\t\t\t</scroll-view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</uni-popup>\n\t</view>\n</template>\n\n<script>\n    import { mapState,mapMutations } from 'vuex';\n    import uniPopup from '@/components/uni-popup/uni-popup.vue';\n    import cmnUtils from '@/utils/cmnUtils.js';\n\n    export default {\n        components:{\n            \"uni-popup\":uniPopup\n        },\n        data() {\n            return {\n                CustomBar: this.CustomBar,\n                isLoad:false,\n                actions: [{\n                    title: '制券',\n                    name: 'ticket',\n                    url:'/pagesVoucher/biz-voucher/VoucherTypeList',\n                    isShow: true,\n\t\t\t\t\tneedRole: 'cardAdmin'\n                }, {\n                    title: '核销',\n                    name: 'qrcode',\n                    url:'/pagesVoucher/vou-entries/index',\n                    isShow: true,\n                    needRole: ''\n                }, {\n                    title: '用户',\n                    name: 'people',\n                    url:'/pagesVoucher/vou-customers/index',\n                    isShow: true,\n                    needRole: 'cardAdmin'\n                }, {\n                    title: '员工',\n                    name: 'profile',\n                    url:'/pagesVoucher/vou-members/index',\n                    isShow: true,\n                    needRole: 'cardAdmin'\n                },{\n                    title: '统计',\n                    name: 'rank',\n                    url:'',\n                    isShow: true,\n                    needRole: 'cardAdmin'\n                } ],\n                tabCur: 0,\n                tab:['未发布','进行中','已结束'],\n                currentActivity:{},\n                savedActivities:[],\n                InProcessActivities:[],\n                closeActivities:[],\n                page: 1,\n                isEndPage:false,//最后一页\n                loadingType: 1,//上拉的状态：0-loading前；1-loading中；2-没有更多了\n                isUps:false,\n                itemSelectedId:'-1',//选中活动ID\n                listGroup: {},//包含字母分组的名片\n                partyList: [{}],\n                index: -1,//list index\n                subList:[],//list.subList 字母分类下的名片数组\n                search_str: '',//检索关键字\n            }\n        },\n\n        onLoad(option) {\n            let that = this;\n            // that.isLoad = true;\n            // that.tabCur=0;\n            // that.getList('SAVED');\n            that.tabCur=1;\n            // that.getList('IN_PROCESS');\n            // that.isLoad = false;\n        },\n\n\t\tonShow(){\n            if(this.tabCur==1){\n                this.getList('IN_PROCESS');\n\t\t\t}\n\t\t},\n\n        onPullDownRefresh() {\n            this.page=1\n            if(this.tabCur===0){\n                this.getList('SAVED');\n            }else if(this.tabCur===1){\n                this.getList('IN_PROCESS');\n            }\n            else if(this.tabCur===2){\n                this.getList('CLOSE');\n            }\n            uni.stopPullDownRefresh(); // 停止刷新\n        },\n\n        onReachBottom() {\n            this.page++;\n            if(this.tabCur===0){\n                this.getList('SAVED');\n            }else if(this.tabCur===1){\n                this.getList('IN_PROCESS');\n            }\n            else if(this.tabCur===2){\n                this.getList('CLOSE');\n            }\n\n        },\n\n        computed:{\n            ...mapState(['user']),\n            checkCardAdminRole(){\n                return function (role,needRole) {\n                    let currentRole = role||'';\n                    // console.log('currentRole',currentRole,'needRole',needRole);\n                    return currentRole.indexOf(needRole)>-1;\n                }\n            },\n            formatCreateAt(){\n                return function(time){\n                    let currentTime = time;\n                    // console.log('time',time);\n                    if(currentTime){\n                        return cmnUtils.formatTime(currentTime,'yyyy-MM-dd HH:mm:ss')\n                    }else{\n                        return \"\";\n                    }\n                }\n            },\n        },\n        methods: {\n            go(action){\n                if(action.url.length==0){\n                    uni.showToast({\n                        icon:'none',\n                        title:action.title+'暂未开放！'\n                    });\n                }\n                console.log('go url',action.url +'?cardId='+ this.user.userInfo.bizCardId+'&cardName='+this.user.userInfo.bizCardName);\n                uni.navigateTo({\n                    \"url\": action.url +'?cardId='+ this.user.userInfo.bizCardId+'&cardName='+this.user.userInfo.bizCardName,\n                })\n            },\n            tabSelect(e) {\n                this.tabCur = e.currentTarget.dataset.id;\n                if(this.tabCur===0){\n                    this.getList('SAVED');\n                }else if(this.tabCur===1){\n                    this.getList('IN_PROCESS');\n                }\n                else if(this.tabCur===2){\n                    this.getList('CLOSE');\n                }\n            },\n\n            async getList(status) {\n                let that = this;\n                if(that.user.userInfo.role.indexOf('cardAdmin')<0){return}\n                this.isLoad=true;\n                that.loadingType = 1;\n                let res = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'getActivityList',\n                        cardId:that.user.userInfo.bizCardId,\n\t\t\t\t\t\tuserId:that.user._id,\n                        page:that.page,\n                        status:status\n                    }\n                });\n\t\t\t\tconsole.log('getList bizcardId',that.user.userInfo.bizCardId,'userId',that.user._id,status,res.result);\n                let result=res.result;\n                if (result.code == 0) {\n                    if (that.page == 1) {\n                        that.isEndPage = false;\n                        if(that.tabCur===0){\n                            that.savedActivities = [];\n                        }else if(that.tabCur===1){\n                            that.InProcessActivities = [];\n                        }\n                        else if(that.tabCur===2){\n                            that.closeActivities = [];\n                        }\n                    }\n                    result.data.forEach(vou => {\n                        if(that.tabCur===0){\n                            that.savedActivities.push(vou);\n                        }else if(that.tabCur===1){\n                            that.InProcessActivities.push(vou);\n                        }\n                        else if(that.tabCur===2){\n                            that.closeActivities.push(vou);\n                        }\n                    })\n                }\n                //后面没数据了\n                if(result.data.length<10){\n                    that.isEndPage = true;\n                    that.loadingType = 2;\n                }\n                that.isLoad=false;\n            },\n\n            // goActivityVouchers(activity){\n            //     console.log('goActivityVouchers',activity._id,activity.name);\n            //     uni.navigateTo({\n            //         \"url\":\"/pagesVoucher/biz-voucher/ActivityVoucherList?id=\"+activity._id+\"&name=\"+activity.name,\n            //     })\n            // },\n\n            popupOperate(item){\n                let that = this;\n                console.log('popupOperate',item);\n                that.itemSelectedId = item._id;\n                that.currentActivity = item;\n                this.$nextTick(() => {\n                    that.$refs['showPopupOperate'].open()\n                })\n            },\n\n            change(e){\n                if(e.show){\n                    this.isUps = true;\n                }else{\n                    this.isUps =false;\n                }\n            },\n\n            cancel(type){\n                this.$refs['show' + type].close()\n            },\n\n            async goInProcess(){\n                let that = this;\n                that.currentActivity.status='IN_PROCESS';\n                console.log('goInProcess',that.currentActivity);\n                let res = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'saveActivity',\n                        activity:that.currentActivity,\n                    }\n                });\n                that.tabCur=1;\n                that.getList(\"IN_PROCESS\");\n                that.$refs['showPopupOperate'].close();\n                if(res.result.code == 0){\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ticon:'success',\n\t\t\t\t\t\ttitle:'发布成功'\n\t\t\t\t\t});\n                }\n\t\t\t},\n\n            goDetail(item){\n                console.log('goDetail',item);\n\t\t\t\tif(this.currentActivity._id){\n\t\t\t\t\tthis.itemSelectedId=this.currentActivity._id;\n\t\t\t\t}else{\n\t\t\t\t\tthis.itemSelectedId=item._id;\n\t\t\t\t}\n\t\t\t\t\n                uni.navigateTo({\n                    \"url\": \"/pagesVoucher/biz-voucher/ActivityDetail?id=\" + this.itemSelectedId,\n                })\n                this.$refs['showPopupOperate'].close()\n            },\n            goEdit() {\n                console.log('goEdit', this.itemSelectedId);\n                uni.navigateTo({\n                    \"url\": \"/pagesVoucher/biz-voucher/ActivityInput?id=\" + this.itemSelectedId,\n                })\n                this.$refs['showPopupOperate'].close()\n            },\n\t\t\t//删除卡券\n            async remove(){\n                let that = this;\n                console.log('go remove activity', that.itemSelectedId);\n                await wx.cloud.callFunction({\n                    name:'vou-activities',\n                    data:{\n                        $url:'remove',\n                        id:that.itemSelectedId\n                    }\n                });\n                that.$refs['showPopupOperate'].close();\n\n                uni.showToast({ icon:'success',title:'删除成功'})\n                that.page=1\n                if(that.tabCur===0){\n                    that.getList('SAVED');\n                }else if(that.tabCur===1){\n                    that.getList('IN_PROCESS');\n                }\n                else if(that.tabCur===2){\n                    that.getList('CLOSE');\n                }\n                uni.stopPullDownRefresh(); // 停止刷新\n                that.$forceUpdate()\n            },\n\n            goMyHome(){\n                uni.reLaunch({\n                    url: '/pages/my/home',\n                })\n            },\n\n            goMyCard(){\n                uni.navigateTo({\n                    \"url\":\"/pagesSys/card/CardDetail\"\n                })\n            },\n            goProduct(){\n                uni.reLaunch({\n                    \"url\": \"/pages/site/product\",\n                })\n            },\n\n            async getPartyList() {\n                let that = this;\n                that.partyList =[];\n                that.isLoad = true;\n                //根据cardId检索收藏的历史名片\n                let res = await wx.cloud.callFunction({\n                    name: 'sys',\n                    data: {\n                        $url: 'getCardHolderByCardId',\n                        cardId: that.user.userInfo.bizCardId\n                    }\n                });\n                let result = res.result;\n                if (result.code == 0 && result.data) {\n                    //按字母分组的名片\n                    that.listGroup = result.data.cards || {};\n                    let index = 0;\n                    let searchFlag = that.search_str.length>0 ;\n                    for (let key in that.listGroup) {\n                        if (that.listGroup[key].length > 0) {\n                            that.listGroup[key].forEach(each=>{\n                                let search_str = each.search_str||'';\n\t\t\t\t\t\t\t\t//全部会员\n\t\t\t\t\t\t\t\tif(!searchFlag){\n\t\t\t\t\t\t\t\t\tthat.partyList[index] = {};\n\t\t\t\t\t\t\t\t\tthat.partyList[index].group = key;\n\t\t\t\t\t\t\t\t\tthat.partyList[index].subList = that.listGroup[key];\n\t\t\t\t\t\t\t\t\tindex++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//检索\n\t\t\t\t\t\t\t\telse if(search_str.indexOf(that.search_str)>-1){\n\t\t\t\t\t\t\t\t\tthat.partyList[index] = {};\n\t\t\t\t\t\t\t\t\tthat.partyList[index].group = key;\n\t\t\t\t\t\t\t\t\tthat.partyList[index].subList = that.listGroup[key];\n\t\t\t\t\t\t\t\t\tindex++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n                        }\n                    }\n                }\n                that.isLoad = false;\n                that.$forceUpdate()\n            },\n\n            //打开发券\n            openSendVoucher(){\n                let that = this;\n                that.$refs['showPopupOperate'].close();\n                that.getPartyList();\n                that.$nextTick(() => {\n                    that.$refs['showPartyCard'].open();\n                });\n\n            },\n\n            //发券\n            async sendVoucher(index,subIndex,num_send,remark){\n                let that = this;\n                that.isLoad = true;\n                if(parseInt(that.currentActivity.num_used)+parseInt(num_send)>parseInt(that.currentActivity.num_total)){\n                    uni.showToast({\n                        icon:'none',\n                        title:'剩余券数不足，无法发券'\n                    });\n                    return;\n\t\t\t\t}\n\t\t\t\tconsole.log('current hold card',that.partyList[index].subList[subIndex]);\n\t\t\t\t//构建发券对象\n\t\t\t\tlet voucher = {\n\t\t\t\t    activity_id:that.currentActivity._id,\n\t\t\t\t\tactivity_name:that.currentActivity.name,\n\t\t\t\t\tentry_id:that.currentActivity.entry_id,\n\t\t\t\t\tentry_name:that.currentActivity.entry_name,\n\t\t\t\t\tbg_color:that.currentActivity.bg_color,\n\t\t\t\t\ticon:that.currentActivity.icon,\n\t\t\t\t\tvalid_date:that.currentActivity.valid_date,\n\t\t\t\t\tcard_id:that.currentActivity.card_id,\n\t\t\t\t\tcard_name:that.currentActivity.card_name,\n\t\t\t\t\tcard_avatar:that.currentActivity.avatar,\n\t\t\t\t    user_id:that.partyList[index].subList[subIndex].user_id,\n\t\t\t\t\tuser_name:that.partyList[index].subList[subIndex].name,\n                    user_avatar:that.partyList[index].subList[subIndex].avatar,\n                    managed_user_id:that.user.userInfo._id,\n                    managed_user_name:that.user.userInfo.name,\n                    managed_user_avatar:that.user.userInfo.avatar,\n\t\t\t\t\tmanaged_status:'RECEIVED',\n\t\t\t\t\tmanaged_status_name:'已领取',\n\t\t\t\t\tnum_total:parseInt(num_send),//本次领取总数\n\t\t\t\t\tnum_used:0,\n\t\t\t\t\tprice:parseFloat(that.currentActivity.price),\n\t\t\t\t\tstatus:'TO_BE_USE',\n\t\t\t\t\ttype_code:that.currentActivity.type_code,//券类型\n\t\t\t\t\ttype_name:that.currentActivity.type_name,//券类型名称\n\t\t\t\t\tcover:that.currentActivity.cover,\n\t\t\t\t\tremark:remark//租户备注\n\t\t\t\t};\n                let res = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'saveVoucher',\n                        voucher:voucher,\n                    }\n                });\n                console.log('sendVoucher',voucher,res);\n                that.currentActivity.num_used =parseInt(that.currentActivity.num_used)+parseInt(num_send);\n                //更新活动\n                that.leftNum = parseInt(that.currentActivity.num_total)-parseInt(that.currentActivity.num_used);\n                console.log('currentActivity',that.currentActivity.num_total,that.currentActivity.num_used,that.leftNum);\n\t\t\t\tif(that.leftNum==0){\n\t\t\t\t    that.currentActivity.status='CLOSE'\n\t\t\t\t}\n\t\t\t\tres = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'saveActivity',\n                        activity:that.currentActivity\n                    }\n                });\n\t\t\t\tconsole.log('save activity', res);\n\t\t\t\tif(res.result.code==0){\n                    that.partyList[index].subList[subIndex].num_total = parseInt(num_send);\n                    that.partyList[index].subList[subIndex].send_success = true;\n                    that.isLoad = false;\n                    that.$forceUpdate();\n\n\t\t\t\t\t//todo 生成核销码\n\t\t\t\t\t// voucher._id=res.result.data;\n\t\t\t\t\t// voucher.number= voucher._id.substr(1,24);\n\t\t\t\t\t// if(res.result.code == 0){\n\t\t\t\t\t//     res = await wx.cloud.callFunction({\n\t\t\t\t\t//         name:'vou',\n\t\t\t\t\t//         data:{\n\t\t\t\t\t//             $url:'genEntryQrCode',\n\t\t\t\t\t//             id:voucher._id,\n\t\t\t\t\t//             wfCode:voucher.number\n\t\t\t\t\t//         }\n\t\t\t\t\t//     });\n\t\t\t\t\t//     console.log('生成二维码',res);\n\t\t\t\t\t// }\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ticon:'success',\n\t\t\t\t\t\ttitle:'发券成功'\n\t\t\t\t\t});\n\t\t\t\t\t//延迟释放\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tthat.tabCur=1;\n\t\t\t\t\t\tthat.getList('IN_PROCESS');\n\t\t\t\t\t},3000)\n                }\n\t\t\t},\n\n            inputFocus(e) {\n                console.log(e)\n            },\n            inputBlur(e) {\n                console.log(e)\n                this.partyList = [];\n                this.search_str = e.detail.value;\n                this.page = 1;\n            },\n        }\n    }\n</script>\n\n<style>\n\n\t/* 起到固定的作用 ,从而解决原页面触摸穿透的问题*/\n\t.prevent {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\t/*自动回到顶部*/\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\toverflow: hidden;\n\t}\n\n\t/* 遮罩样式 */\n\t.shade{\n\t\twidth:100%;\n\t\theight: 100%;\n\t\tposition: fixed;\n\t\ttop:0;\n\t\tleft:0;\n\t\tz-index: 90;\n\t}\n\n\t.ups-height{\n\t\theight: 850rpx;\n\t\tpadding-bottom:62px;\n\t}\n\n\t﻿/* 底部分享 */\n\t.popup-base {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tborder-top-left-radius: 3%;\n\t\tborder-top-right-radius: 3%;\n\t\tz-index: 95;\n\t}\n\t.popup-close {\n\t\tposition:absolute;\n\t\ttop:30rpx;\n\t\tleft:30rpx;\n\t\tfont-size: 39rpx;\n\t\ttext-align: center;\n\t\tfont-weight: bold;\n\t\tz-index: 99;\n\t}\n\n\t.popup-title {\n\t\tmargin-top:15rpx;\n\t\tline-height: 60rpx;\n\t\tfont-size: 28rpx;\n\t\tpadding: 5rpx 0;\n\t\ttext-align: center;\n\t\tfont-weight: bold;\n\t}\n\n\t.popup-content {\n\t\t/* #ifndef APP-NVUE */\n\t\tdisplay: flex;\n\t\t/* #endif */\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;\n\t\tjustify-content: center;\n\t\tpadding: 5px;\n\t\tmax-height: 850rpx;\n\t}\n\n\t.popup-content-box {\n\t\t/* #ifndef APP-NVUE */\n\t\tdisplay: flex;\n\t\t/* #endif */\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\twidth: 180rpx;\n\t}\n\n\t.popup-content-image {\n\t\t/* #ifndef APP-NVUE */\n\t\tdisplay: flex;\n\t\t/* #endif */\n\t\tflex-direction: row;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\twidth: 90rpx;\n\t\theight: 130rpx;\n\t\toverflow: hidden;\n\t\tborder-radius: 50rpx;\n\t}\n\n\t.content-image {\n\t\twidth: 80rpx;\n\t\theight: 80rpx;\n\t}\n\n\t.popup-content-text {\n\t\tfont-size: 26rpx;\n\t\tcolor: #333;\n\t\tpadding-top: 5px;\n\t\tpadding-bottom: 10px;\n\t}\n\n\t.popup-btn {\n\t\theight: 90rpx;\n\t\tline-height: 90rpx;\n\t\tfont-size: 14px;\n\t\tborder-top-color: #DADADA;\n\t\tborder-top-width: 1px;\n\t\tborder-top-style: solid;\n\t\ttext-align: center;\n\t\tcolor: #666;\n\t}\n\n\t.button-content {\n\t\twidth: 100rpx;\n\t\theight: 100rpx;\n\t\tborder-radius:15px;\n\t}\n\n\t.cu-btn{\n\t\tpadding: 0 10rpx;\n\t}\n\n\t.quan{\n\t\tpadding: 0 20rpx;\n\t\tz-index: 0;\n\t}\n\t.font50{\n\t\tfont-size: 50rpx;\n\t}\n\t.card{\n\t\tmargin-top: 20rpx;\n\t\twidth: 100%;\n\t\tborder-radius: 20rpx;\n\t\tpadding: 5rpx 30rpx;\n\t\theight: 170rpx;\n\t}\n\t.font32{\n\t\tfont-size: 32rpx;\n\t}\n\t.line35{\n\t\tline-height: 50rpx;\n\t}\n\t.font-bold{\n\t\tfont-weight: bolder;\n\t}\n\t.quan-text{\n\t\twidth: 640rpx;\n\t}\n\t.quan-right{\n\t\twidth: 200rpx;\n\t}\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}