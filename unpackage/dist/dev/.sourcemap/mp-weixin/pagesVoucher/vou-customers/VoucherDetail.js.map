{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/VoucherDetail.vue?af34","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/VoucherDetail.vue?b929","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/VoucherDetail.vue?33c8","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/VoucherDetail.vue?592a","uni-app:///pagesVoucher/vou-customers/VoucherDetail.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/VoucherDetail.vue?9cbb"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","m0","_self","_c","formatCreateAt","voucher","create_at","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","isLoad"],"mappings":"sJAAA,KACA,YACA,Y,mDAFmBA,GAAGC,kCAAoCC,EAG1DC,EAAWC,a,gECHX,yHACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,+CACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,eAAeP,EAAIQ,QAAQC,YACxCT,EAAIU,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLV,GAAIA,MAKRW,GAAmB,EACnBC,EAAkB,GACtBjB,EAAOkB,eAAgB,G,iCCjBvB,8GAA40B,eAAG,G,8HC8F/0B,QACA,W,4iCAEA,CACE,WAAF,GAEE,KAHF,WAII,MAAJ,CACM,GAAN,GACM,QAAN,EACM,SAAN,EACM,OAAN,EACM,MAAN,GACM,QAAN,CACQ,cAAR,GACQ,UAAR,GACQ,SAAR,IACQ,QAAR,EACQ,SAAR,KAEM,SAAN,GAGM,UAAN,eACM,YAAN,IAGE,OAxBF,SAwBA,GACI,IAAJ,OACI,QAAJ,iBACA,OACM,EAAN,QACM,EAAN,kBAIE,kBAjCF,SAiCA,GACI,IAAJ,OAEA,aAEI,GADA,QAAJ,yCACA,2BAOI,GAAJ,iCAQI,GAAJ,wFACM,EAAN,WACQ,KAAR,OACQ,MAAR,iBAKI,GAAJ,mBACM,IAAN,2BAuBM,OAtBA,QAAN,uDACM,EAAN,UAEM,EAAN,2EAEM,EAAN,wBACM,EAAN,2BACM,EAAN,2EACA,uBACQ,EAAR,0BAEM,EAAN,+BACM,GAAN,oBACQ,KAAR,MACQ,KAAR,CACU,KAAV,cACU,QAAV,aAEM,MAAN,YACQ,EAAR,oBACQ,EAAR,aAEA,CACQ,MAAR,gBACQ,SAAR,YACQ,KAAR,2DACQ,QAAR,YACU,EAAV,WACY,KAAZ,UACY,MAAZ,iBA9CM,EAAN,WACQ,KAAR,OACQ,MAAR,gBATM,EAAN,WACQ,KAAR,OACQ,MAAR,YA0DE,SAAF,QACE,EAAF,uBADA,IAEI,eAFJ,WAGM,OAAN,YACQ,IAAR,IAEQ,OAAR,EACA,8CAEA,OAKE,QAAF,CACI,UADJ,SACA,uIACgB,EAAhB,EACgBC,EAAKC,QAAS,GACd,EAHhB,iCAIkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,mBACsB,GAAtB,KARA,UAIA,EAJA,OAWgB,QAAhB,mBACA,GAAgB,EAAhB,YAZA,wBAagB,EAAhB,sBACgB,EAAhB,oBACgB,EAAhB,yCACgB,EAAhB,2EAhBA,UAiBkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,oBACsB,GAAtB,yBArBA,QAiBA,EAjBA,OAwBgB,QAAhB,2BACA,mBACkB,EAAlB,wBA1BA,QA8BgBD,EAAKC,QAAS,EA9B9B,iD,2ECnNA,8GAAmrC,eAAG,G","file":"pagesVoucher/vou-customers/VoucherDetail.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesVoucher/vou-customers/VoucherDetail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./VoucherDetail.vue?vue&type=template&id=1c51821d&\"\nvar renderjs\nimport script from \"./VoucherDetail.vue?vue&type=script&lang=js&\"\nexport * from \"./VoucherDetail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./VoucherDetail.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesVoucher/vou-customers/VoucherDetail.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./VoucherDetail.vue?vue&type=template&id=1c51821d&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.formatCreateAt(_vm.voucher.create_at)\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./VoucherDetail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./VoucherDetail.vue?vue&type=script&lang=js&\"","<template>\n    <view>\n        <cu-custom    :isBack=\"true\">\n            <block slot=\"content\">{{voucher.card_name}}</block>\n            <block slot=\"right\">\n                <view class=\"action\">\n                    <view class=\"cu-load load-cuIcon\" :class=\"isLoad?'loading':'over'\"></view>\n                </view>\n            </block>\n        </cu-custom>\n        <scroll-view>\n            <view scroll-y class=\"quan\">\n                <view class=\"flex card bg-white\">\n                    <view class=\"quan-text\">\n                        <view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+voucher.bg_color\"></view>\n                        <view class=\"flex\">\n                            <view  class=\"cu-avatar round lg margin-right-sm\">\n                                <image :src=\"voucher.card_avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n                            </view>\n                            <view class=\"content\">\n                                <view class=\"text-grey text-xl\">{{voucher.activity_name}}\n                                    <text class=\"text-abc\"></text>\n                                </view>\n                                <view class=\"text-gray text-sm\">领券时间：{{formatCreateAt(voucher.create_at)}}</view>\n                            </view>\n                        </view>\n                    </view>\n                    <view class=\"rel quan-right\">\n                        <view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n                            <text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n                            <text class=\"text-bold text-xxl \">{{activity.price}}</text>\n                        </view>\n                        <view class=\"solid-bottom\">\n                            <view class='cu-tag round ﻿bg-grey light' >{{voucher.leftNum}} 张可用</view>\n                        </view>\n                    </view>\n                </view>\n            </view>\n            <view  class=\"flex ﻿align-center﻿justify-start margin-sm bg-white radius\">\n                <text class=\"flex-twice align-center margin-left\">发券数量：</text>\n                <input class=\"flex-treble align-center cu-progress radius\" placeholder=\"请输入发券数量\" v-model=\"voucher.num_send\"></input>\n                <button class=\"flex-twice cu-btn  shadow-blur margin-sm line-grey\"  :disabled=\"isLoad\" :data-voucher=\"voucher\" open-type=\"share\">分享发券</button>\n            </view>\n            <view class=\"margin-sm\">\n                ﻿<view class=\"cu-bar bg-white solid-bottom margin-top-xs\">\n                    <view class=\"action\">\n                        <text class=\"cuIcon-title text-orange\"></text> 活动规则\n                    </view>\n                </view>\n                ﻿<view class=\"cu-list menu\">\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">使用条件：</text>\n                            <text >{{activity.use_condition}}</text>\n                        </view>\n                    </view>\n                    <!--<view class=\"cu-item\">-->\n                        <!--<view class=\"content\">-->\n                            <!--<text class=\"text-grey\">领取限制：</text>-->\n                            <!--<text >每位限领{{voucher.num_limit}}张</text>-->\n                        <!--</view>-->\n                    <!--</view>-->\n                </view>\n                <view class=\"cu-bar bg-white solid-bottom margin-top-xs\">\n                    <view class=\"action\">\n                        <text class=\"cuIcon-title text-orange\"></text> 使用规则\n                    </view>\n                </view>\n                ﻿<view class=\"cu-list menu\">\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">有效日期：</text>\n                            <text>{{activity.valid_date}}</text>\n                        </view>\n                    </view>\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">可用时段：</text>\n                            <text>{{activity.valid_time}}</text>\n                        </view>\n                    </view>\n                    <view class=\"cu-item\">\n                        <view class=\"content flex\">\n                            <text class=\"text-grey\">使用须知：</text>\n                            <textarea class=\"flex-wrap\" style=\"width: 76%\" maxlength=\"140\" v-model=\"activity.remark\"></textarea>\n                        </view>\n                    </view>\n                </view>\n            </view>\n        </scroll-view>\n    </view>\n</template>\n\n<script>\n    import { mapState ,mapMutations} from 'vuex'\n    import cmnUtils from '@/utils/cmnUtils.js'\n\n    export default {\n        components:{\n        },\n        data() {\n            return {\n                id:'',\n                isLoad:false,\n                loading: false,\n                isUps:false,\n                title:'',\n                voucher:{\n                    activity_name:'',\n                    create_at:'',\n                    num_send:'0',\n                    leftNum:0,\n                    num_used:'0',\n                },\n                activity:{\n\n                },\n                CustomBar: this.CustomBar,\n                loadingType: 0,//上拉的状态：0-loading前；1-loading中；2-没有更多了\n            }\n        },\n        onLoad(options) {\n            let that = this;\n            console.log('options',options);\n            if(options.id ){\n                that.id=options.id;\n                that.getDetail(options.id);\n            }\n        },\n\n        onShareAppMessage(res){\n            let that = this;\n            //只能输入数字\n            let reg = /^[0-9]*$/;\n            console.log('只能输入数字',reg.test(that.voucher.num_send));\n            if(!reg.test(that.voucher.num_send)){\n                uni.showToast({\n                    icon:'none',\n                    title:'只能输入数字'\n                })\n                return;\n            }\n            if(parseInt(that.voucher.num_send)==0){\n                uni.showToast({\n                    icon:'none',\n                    title:'面额不能为零'\n                })\n                return;\n            }\n\n            if(parseInt(that.voucher.num_send)+parseInt(that.voucher.num_used)>parseInt(that.voucher.num_total)){\n                uni.showToast({\n                    icon:'none',\n                    title:'剩余券数额不足'\n                })\n                return;\n            }\n\n            if(res.from=== 'button'){\n                let  voucher = res.target.dataset.voucher;\n                console.log('voucher share res',voucher.activity_name,voucher._id,voucher.cover);\n                that.isLoad = true;\n                //更新占用券数\n                that.voucher.num_used = parseInt(that.voucher.num_used)+parseInt(that.voucher.num_send);\n                //对方未接受标记为false，对方收取后标记为true\n                that.voucher.num_send_used = 0;\n                that.voucher.receive_success = false;\n                that.voucher.leftNum = parseInt(that.voucher.num_total)-parseInt(that.voucher.num_used);\n                if(that.voucher.leftNum==0){\n                    that.voucher.status='EXPIRED'\n                }\n                that.voucher.cover = that.activity.cover;\n                wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'saveVoucher',\n                        voucher:that.voucher\n                    }\n                }).then((resVou)=>{\n                    that.voucher.num_send = '';\n                    that.isLoad = false;\n                });\n                return{\n                    title:voucher.activity_name,\n                    imageUrl:voucher.cover||'',\n                    path:\"/pagesVoucher/vou-customers/ShareVoucherDetail?id=\"+voucher._id,\n                    success:function(r){\n                        uni.showToast({\n                            'icon':'success',\n                            'title':'分享成功'\n                        });\n                    }\n                }\n            }\n        },\n\n        computed:{\n            ...mapState(['user']),\n            formatCreateAt(){\n                return function(time){\n                    let currentTime = time;\n                    // console.log('time',time);\n                    if(currentTime){\n                        return cmnUtils.formatTime(currentTime,'yyyy-MM-dd HH:mm:ss')\n                    }else{\n                        return \"\";\n                    }\n                }\n            },\n        },\n        methods: {\n            async getDetail(id){\n                let that = this;\n                that.isLoad = true;\n                if(id){\n                    let res = await wx.cloud.callFunction({\n                        name:'vou',\n                        data:{\n                            $url:'getVoucherDetail',\n                            id:id,\n                        }\n                    });\n                    console.log('getDetail',res);\n                    if(res.result.code==0){\n                        that.voucher = res.result.data;\n                        that.voucher.num_send= '';\n                        that.voucher.num_used= that.voucher.num_used||'0';\n                        that.voucher.leftNum = parseInt(that.voucher.num_total)-parseInt(that.voucher.num_used);\n                        res = await wx.cloud.callFunction({\n                            name:'vou',\n                            data:{\n                                $url:'getActivityDetail',\n                                id:that.voucher.activity_id,\n                            }\n                        });\n                        console.log('getActivityDetail',res);\n                        if(res.result.code==0){\n                            that.activity = res.result.data;\n                        }\n                    }\n                }\n                that.isLoad = false;\n            },\n\n\n        }\n    }\n</script>\n\n<style>\n    .quan{\n        padding: 0 20rpx;\n        z-index: 0;\n    }\n    .font50{\n        font-size: 50rpx;\n    }\n    .card{\n        margin-top: 20rpx;\n        width: 100%;\n        border-radius: 20rpx;\n        padding: 5rpx 30rpx;\n        height: 170rpx;\n    }\n    .font32{\n        font-size: 32rpx;\n    }\n    .line35{\n        line-height: 50rpx;\n    }\n    .font-bold{\n        font-weight: bolder;\n    }\n    .quan-text{\n        width: 640rpx;\n    }\n    .quan-right{\n        width: 200rpx;\n    }\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./VoucherDetail.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./VoucherDetail.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}