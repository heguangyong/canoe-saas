{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/ShareVoucherDetail.vue?889e","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/ShareVoucherDetail.vue?4aa3","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/ShareVoucherDetail.vue?be1f","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/ShareVoucherDetail.vue?f8b0","uni-app:///pagesVoucher/vou-customers/ShareVoucherDetail.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-customers/ShareVoucherDetail.vue?fd9f"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","m0","_self","_c","formatCreateAt","voucher","create_at","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","isLoad","name","console","log","$forceUpdate","uni","showToast","setTimeout"],"mappings":"2JAAA,KACA,YACA,Y,mDAFmBA,GAAGC,kCAAoCC,EAG1DC,EAAWC,a,gECHX,yHACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,oDACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,eAAeP,EAAIQ,QAAQC,YACxCT,EAAIU,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLV,GAAIA,MAKRW,GAAmB,EACnBC,EAAkB,GACtBjB,EAAOkB,eAAgB,G,iCCjBvB,8GAAi1B,eAAG,G,8HCgGp1B,QACA,W,4iCAEA,CACE,WAAF,GAEE,KAHF,WAII,OAAJ,GACM,QAAN,EACM,SAAN,EACM,OAAN,EACM,MAAN,GACM,QAAN,GACM,QAAN,CACQ,cAAR,GACQ,UAAR,GACQ,SAAR,KAEM,SAAN,GAGM,UAAN,eACM,YAAN,GAfA,UAgBI,KAGF,OAvBF,SAuBA,GACI,IAAJ,OACI,QAAJ,iBACA,MACM,EAAN,iBAGE,SAAF,QACE,EAAF,uBADA,IAEI,eAFJ,WAGM,OAAN,YACQ,IAAR,IAEQ,OAAR,EACA,8CAEA,OAKE,QAAF,CACI,UADJ,SACA,uIACgB,EAAhB,EACgBC,EAAKC,QAAS,GACd,EAHhB,iCAIkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,mBACsB,GAAtB,KARA,UAIA,EAJA,OAWgB,QAAhB,mBACA,GAAgB,EAAhB,YAZA,wBAagB,EAAhB,sBACgB,EAAhB,yCACgB,EAAhB,+CAfA,UAgBkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,oBACsB,GAAtB,yBApBA,QAgBA,EAhBA,OAuBgB,QAAhB,2BACA,mBACkB,EAAlB,wBAzBA,QA6BgBD,EAAKC,QAAS,EA7B9B,+CAiCI,aAlCJ,WAkCA,0IACgB,EAAhB,EACgBD,EAAKC,QAAS,EAEd,EAAhB,CACkB,YAAlB,eACkB,cAAlB,gBACkB,SAAlB,oBACkB,WAAlB,sBACkB,SAAlB,oBACkB,KAAlB,gBACkB,WAAlB,sBACkB,QAAlB,mBACkB,UAAlB,qBACkB,YAAlB,kBACkB,QAAlB,WACkB,UAAlB,YACkB,YAAlB,cACkB,gBAAlB,mBACkB,kBAAlB,qBACkB,oBAAlB,uBACkB,eAAlB,WACkB,oBAAlB,MACkB,UAAlB,6BACkB,SAAlB,EACkB,MAAlB,6BACkB,OAAlB,YACkB,UAAlB,qBACkB,UAAlB,qBACkB,MAAlB,iBACkB,OAAlB,kBA9BA,SAgCA,uBACoBC,KAApB,MACoBT,KAApB,CACsB,KAAtB,cACsB,QAAtB,KApCA,UAgCA,EAhCA,OAuCgBU,QAAQC,IAAI,eAA5B,KAGA,iBA1CA,wBA2CgB,EAAhB,2BAEgB,EAAhB,qBACgB,EAAhB,wBACgB,EAAhB,2EACA,uBACkB,EAAlB,0BAEgB,EAAhB,+BAnDA,UAoDkB,GAAlB,oBACoB,KAApB,MACoB,KAApB,CACsB,KAAtB,cACsB,QAAtB,aAxDA,QA4DgBJ,EAAKC,QAAS,EACdD,EAAKK,eAeLC,EAAIC,UAAU,CACZ,KAAlB,UACkB,MAAlB,SAGgBC,YAAW,WACT,EAAlB,YACoB,IAApB,sDAEA,KArFA,+CAwFI,OA1HJ,WA2HM,EAAN,UACQ,IAAR,sB,2EC3QA,8GAAwrC,eAAG,G","file":"pagesVoucher/vou-customers/ShareVoucherDetail.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesVoucher/vou-customers/ShareVoucherDetail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./ShareVoucherDetail.vue?vue&type=template&id=8f68c21c&\"\nvar renderjs\nimport script from \"./ShareVoucherDetail.vue?vue&type=script&lang=js&\"\nexport * from \"./ShareVoucherDetail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ShareVoucherDetail.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesVoucher/vou-customers/ShareVoucherDetail.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareVoucherDetail.vue?vue&type=template&id=8f68c21c&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.formatCreateAt(_vm.voucher.create_at)\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareVoucherDetail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareVoucherDetail.vue?vue&type=script&lang=js&\"","<template>\n    <view>\n        <cu-custom    :isBack=\"false\">\n            <block slot=\"content\">{{voucher.card_name}}</block>\n            <block slot=\"right\">\n                <view class=\"action\">\n                    <view class=\"cu-load load-cuIcon\" :class=\"isLoad?'loading':'over'\"></view>\n                </view>\n            </block>\n        </cu-custom>\n        <scroll-view>\n            <view scroll-y class=\"quan\">\n                <view class=\"flex card bg-white\">\n                    <view class=\"quan-text\">\n                        <view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+voucher.bg_color\"></view>\n                        <view class=\"flex\">\n                            <view  class=\"cu-avatar round lg margin-right-sm\">\n                                <image :src=\"voucher.card_avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n                            </view>\n                            <view class=\"content\">\n                                <view class=\"text-grey text-xl\">{{voucher.activity_name}}\n                                    <text class=\"text-abc\"></text>\n                                </view>\n                                <view class=\"text-gray text-sm\">操作时间：{{formatCreateAt(voucher.create_at)}}</view>\n                            </view>\n                        </view>\n                    </view>\n                    <view class=\"rel quan-right\">\n                        <view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n                            <text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n                            <text class=\"text-bold text-xxl \">{{activity.price}}</text>\n                        </view>\n                        <view class=\"solid-bottom\">\n                            <view class='cu-tag round ﻿bg-grey light' >{{voucher.num_send}} 张可用</view>\n                        </view>\n                    </view>\n                </view>\n            </view>\n\n            <view v-if=\"voucher.num_send>0\" class=\"cu-bar btn-group bg-white  margin-sm  radius\">\n                <button class=\"cu-btn  shadow-blur line-grey\"   :disabled=\"isLoad\" @click=\"getMyVoucher\">立即领券</button>\n            </view>\n            <view v-else class=\"cu-bar btn-group bg-white  margin-sm  radius\">\n                <text class=\"text-orange text-bold text-30 text-center\">请知：该券已被领取。</text>\n            </view>\n            <view class=\"margin-sm\">\n                ﻿<view class=\"cu-bar bg-white solid-bottom margin-top-xs\">\n                    <view class=\"action\">\n                        <text class=\"cuIcon-title text-orange\"></text> 活动规则\n                    </view>\n                </view>\n                ﻿<view class=\"cu-list menu\">\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">使用条件：</text>\n                            <text >{{activity.use_condition}}</text>\n                        </view>\n                    </view>\n                </view>\n                <view class=\"cu-bar bg-white solid-bottom margin-top-xs\">\n                    <view class=\"action\">\n                        <text class=\"cuIcon-title text-orange\"></text> 使用规则\n                    </view>\n                </view>\n                ﻿<view class=\"cu-list menu\">\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">有效日期：</text>\n                            <text>{{activity.valid_date}}</text>\n                        </view>\n                    </view>\n                    <view class=\"cu-item\">\n                        <view class=\"content\">\n                            <text class=\"text-grey\">可用时段：</text>\n                            <text>{{activity.valid_time}}</text>\n                        </view>\n                    </view>\n                    <view class=\"cu-item\">\n                        <view class=\"content flex\">\n                            <text class=\"text-grey\">使用须知：</text>\n                            <textarea class=\"flex-wrap\" style=\"width: 76%\" maxlength=\"140\" v-model=\"activity.remark\"></textarea>\n                        </view>\n                    </view>\n                </view>\n            </view>\n        </scroll-view>\n        <!--页面底部抬升-->\n        ﻿<view class=\"cu-bar solid-bottom margin-top-xxs radius\"></view>\n        <!-- 底部操作菜单 -->\n        <view class=\"cu-bar btn-group   foot bg-white\">\n            <button class=\"cu-btn   shadow-blur\"   :disabled=\"isLoad\" @click=\"goHome\">去首页</button>\n        </view>\n    </view>\n</template>\n\n<script>\n    import { mapState ,mapMutations} from 'vuex'\n    import cmnUtils from '@/utils/cmnUtils.js'\n\n    export default {\n        components:{\n        },\n        data() {\n            return {\n                isLoad:false,\n                loading: false,\n                isUps:false,\n                title:'',\n                leftNum:'',\n                voucher:{\n                    activity_name:'',\n                    create_at:'',\n                    num_send:'0',\n                },\n                activity:{\n\n                },\n                CustomBar: this.CustomBar,\n                loadingType: 0,//上拉的状态：0-loading前；1-loading中；2-没有更多了\n                leftNum:'',//剩余张数\n            }\n        },\n        onLoad(options) {\n            let that = this;\n            console.log('options',options);\n            if(options.id){\n                that.getDetail(options.id);\n            }\n        },\n        computed:{\n            ...mapState(['user']),\n            formatCreateAt(){\n                return function(time){\n                    let currentTime = time;\n                    // console.log('time',time);\n                    if(currentTime){\n                        return cmnUtils.formatTime(currentTime,'yyyy-MM-dd HH:mm:ss')\n                    }else{\n                        return \"\";\n                    }\n                }\n            },\n        },\n        methods: {\n            async getDetail(id){\n                let that = this;\n                that.isLoad = true;\n                if(id){\n                    let res = await wx.cloud.callFunction({\n                        name:'vou',\n                        data:{\n                            $url:'getVoucherDetail',\n                            id:id,\n                        }\n                    });\n                    console.log('getDetail',res);\n                    if(res.result.code==0){\n                        that.voucher = res.result.data;\n                        that.voucher.num_send = that.voucher.num_send||'0';\n                        that.leftNum = that.voucher.num_total-that.voucher.num_used;\n                            res = await wx.cloud.callFunction({\n                            name:'vou',\n                            data:{\n                                $url:'getActivityDetail',\n                                id:that.voucher.activity_id,\n                            }\n                        });\n                        console.log('getActivityDetail',res);\n                        if(res.result.code==0){\n                            that.activity = res.result.data;\n                        }\n                    }\n                }\n                that.isLoad = false;\n            },\n\n            //收券\n            async getMyVoucher(){\n                let that = this;\n                that.isLoad = true;\n                //构建领券对象\n                let newVoucher = {\n                    activity_id:that.activity._id,\n                    activity_name:that.activity.name,\n                    entry_id:that.activity.entry_id,\n                    entry_name:that.activity.entry_name,\n                    bg_color:that.activity.bg_color,\n                    icon:that.activity.icon,\n                    valid_date:that.activity.valid_date,\n                    card_id:that.activity.card_id,\n                    card_name:that.activity.card_name,\n                    card_avatar:that.activity.avatar,\n                    user_id:that.user._id,\n                    user_name:that.user.name,\n                    user_avatar:that.user.avatar,\n                    managed_user_id:that.activity.user_id,\n                    managed_user_name:that.activity.user_name,\n                    managed_user_avatar:that.activity.user_avatar,\n                    managed_status:'RECEIVED',\n                    managed_status_name:'已领取',\n                    num_total:parseInt(that.voucher.num_send),//本次领取总数\n                    num_used:0,\n                    price:parseFloat(that.activity.price),\n                    status:'TO_BE_USE',\n                    type_code:that.activity.type_code,//券类型\n                    type_name:that.activity.type_name,//券类型名称\n                    cover:that.activity.cover,\n                    remark:that.voucher.remark\n                };\n                let res = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'saveVoucher',\n                        voucher:newVoucher,\n                    }\n                });\n                console.log('getMyVoucher',newVoucher,res);\n\n                //更新分享券的记录\n                if(res.result.code==0){\n                    that.voucher.receive_success = true;\n                    //复位清零\n                    that.voucher.num_send = '0';\n                    that.voucher.num_send_used = 0;\n                    that.voucher.leftNum = parseInt(that.voucher.num_total)-parseInt(that.voucher.num_used);\n                    if(that.voucher.leftNum==0){\n                        that.voucher.status='EXPIRED'\n                    }\n                    that.voucher.cover=that.activity.cover;\n                    await wx.cloud.callFunction({\n                        name:'vou',\n                        data:{\n                            $url:'saveVoucher',\n                            voucher:that.voucher\n                        }\n                    })\n                }\n                that.isLoad = false;\n                that.$forceUpdate();\n                //todo 生成核销码\n                // voucher._id=res.result.data;\n                // voucher.number= voucher._id.substr(1,24);\n                // if(res.result.code == 0){\n                //     res = await wx.cloud.callFunction({\n                //         name:'vouchers',\n                //         data:{\n                //             $url:'genQrCode',\n                //             id:voucher._id,\n                //             wfCode:voucher.number\n                //         }\n                //     });\n                //     console.log('生成二维码',res);\n                // }\n                uni.showToast({\n                    icon:'success',\n                    title:'领券成功'\n                });\n                //延迟跳转\n                setTimeout(function(){\n                    uni.navigateTo({\n                        \"url\":\"/pagesVoucher/vou-customers/CustomerVoucherList\"\n                    })\n                },1000)\n            },\n\n            goHome(){\n                uni.reLaunch({\n                    url: '/pages/my/home',\n                })\n            },\n        }\n    }\n</script>\n\n<style>\n    .quan{\n        padding: 0 20rpx;\n        z-index: 0;\n    }\n    .font50{\n        font-size: 50rpx;\n    }\n    .card{\n        margin-top: 20rpx;\n        width: 100%;\n        border-radius: 20rpx;\n        padding: 5rpx 30rpx;\n        height: 170rpx;\n    }\n    .font32{\n        font-size: 32rpx;\n    }\n    .line35{\n        line-height: 50rpx;\n    }\n    .font-bold{\n        font-weight: bolder;\n    }\n    .quan-text{\n        width: 640rpx;\n    }\n    .quan-right{\n        width: 200rpx;\n    }\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareVoucherDetail.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareVoucherDetail.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}