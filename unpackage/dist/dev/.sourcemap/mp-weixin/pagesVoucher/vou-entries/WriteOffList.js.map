{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-entries/WriteOffList.vue?a137","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-entries/WriteOffList.vue?e21e","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-entries/WriteOffList.vue?1139","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-entries/WriteOffList.vue?dba2","uni-app:///pagesVoucher/vou-entries/WriteOffList.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesVoucher/vou-entries/WriteOffList.vue?45b4"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","__map","list","item","index","$orig","__get_orig","m0","remark","formatCarNum","write_off_item","m1","m2","formatCreateAt","create_at","m3","formatAmount","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","isLoad","name","console","log","result","code","loadingType"],"mappings":"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","file":"pagesVoucher/vou-entries/WriteOffList.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesVoucher/vou-entries/WriteOffList.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./WriteOffList.vue?vue&type=template&id=ad8b1136&\"\nvar renderjs\nimport script from \"./WriteOffList.vue?vue&type=script&lang=js&\"\nexport * from \"./WriteOffList.vue?vue&type=script&lang=js&\"\nimport style0 from \"./WriteOffList.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesVoucher/vou-entries/WriteOffList.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WriteOffList.vue?vue&type=template&id=ad8b1136&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.list, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 = item.remark ? _vm.formatCarNum(item.write_off_item) : null\n    var m1 = !item.remark ? _vm.formatCarNum(item.write_off_item) : null\n    var m2 = _vm.formatCreateAt(item.create_at)\n    var m3 = _vm.formatAmount(item)\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1,\n      m2: m2,\n      m3: m3\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WriteOffList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WriteOffList.vue?vue&type=script&lang=js&\"","<template>\n    <view>\n        <cu-custom    :isBack=\"true\">\n            <block slot=\"content\">{{entryName}}</block>\n            <block slot=\"right\">\n                <view class=\"action\">\n                    <view class=\"cu-load load-cuIcon\" :class=\"isLoad?'loading':'over'\"></view>\n                </view>\n            </block>\n        </cu-custom>\n        <view  class=\"abs round lg\" style=\"z-index: 9;\">\n            <image :src=\"entry.avatar\" mode=\"aspectFill\" class=\" round\" style=\"\" :style=\"{width:logoWidth +'px; height:'+logoWidth+'px;'+ ' margin:'+logoStartPoint+'px'+' 0 0 '+logoStartPoint+'px;'}\"></image>\n        </view>\n        <view  class=\"margin padding grid col-1 bg-white radius\" style=\"z-index: 0;\">\n            <image :src=\"entry.qrcode_info.fileID\" mode=\"widthFix\" style=\"width:100%;\"></image>\n            <view class=\"title margin-top-sm text-center\"> {{entry.card_name}} · {{entryName}}</view>\n        </view>\n        <scroll-view scroll-y class=\"quan\">\n            <view class=\"flex card bg-white\"  v-for=\"(item,index) in list\" :key=\"item\"  @longpress=\"popupOperate(item)\">\n                <view class=\"quan-text\">\n                    <view class=\"font50 cuIcon-move font-bold\" :class=\"'text-'+item.bg_color\"></view>\n                    <view class=\"flex\">\n                        <view  class=\"cu-avatar round lg margin-right-sm\" @tap=\"goDetail(item)\">\n                            <image :src=\"item.card_avatar\" mode=\"aspectFill\" class=\"cu-avatar round lg\"></image>\n                        </view>\n                        <view class=\"content\">\n                            <view v-if=\"item.remark\" class=\"text-grey text-xl\">{{item.remark}}\n                                <text class=\"margin-left-sm text-ABC text-bold text-white cu-tag radius bg-blue\">{{formatCarNum(item.write_off_item)}}</text>\n                            </view>\n                            <view v-else class=\"text-grey text-xl\">{{item.activity_name}}\n                                <text class=\"margin-left-sm text-ABC text-bold text-white cu-tag radius bg-blue\">{{formatCarNum(item.write_off_item)}}</text>\n                            </view>\n                            <view class=\"text-gray text-sm\">核销时间：{{formatCreateAt(item.create_at)}}</view>\n                        </view>\n                    </view>\n                </view>\n                <view class=\"rel quan-right\">\n                    <view class=\"margin-top-xl flex justify-center align-center text-gray\" >\n                        <text class=\"text-bold text-lg ﻿margin-right-xs\">¥</text>\n                        <text class=\"text-bold text-red text-xxl \">{{formatAmount(item)}}</text>\n                    </view>\n                </view>\n            </view>\n        </scroll-view>\n\n        <!--页面底部抬升-->\n        ﻿<view class=\"cu-bar solid-bottom margin-top-xxs radius\"></view>\n        <!-- 底部操作菜单 -->\n        <view class=\"cu-bar btn-group   foot bg-white\">\n            <button class=\"cu-btn   shadow-blur\"   :disabled=\"isLoad\" @click=\"goHome\">去首页</button>\n        </view>\n    </view>\n</template>\n\n<script>\n    import {mapState,mapMutations} from 'vuex';\n    import cmnUtils from '@/utils/cmnUtils.js'\n\n    export default {\n        components: {\n        },\n        data() {\n            return {\n                isLoad:false,\n                entryId:'',\n                entryName:'',\n                logoWidth:0,//图标宽度\n                logoStartPoint:0,//图标起始位\n                list:[],\n                selectedId:'',\n                page: 1,\n                isEndPage:false,//最后一页\n                loadingType: 1,//上拉的状态：0-loading前；1-loading中；2-没有更多了\n                entry:{card_name:'',number:''}//入口对象\n            }\n        },\n\n        onLoad(option){\n            let that = this;\n            console.log('onLoad option',option);\n            if(option.entryId && option.entryName){\n                that.entryId = option.entryId;\n                that.entryName = option.entryName;\n                that.getEntry();\n            }\n            let system = that.getSystem();\n            that.logoWidth= system.w*0.3827;\n            that.logoStartPoint=system.w*0.309;\n            console.log('logoImage',system.w,that.logoWidth,system.h,that.logoStartPoint);\n            //查询指定入口的数据；\n            if(option.entryId){\n                that.$db.collection('voucher')\n                    .orderBy('create_at','desc')\n                    .limit(10)\n                    .where({\n                        entry_id:option.entryId,\n                        status:'USED'\n                    })\n                    .watch({\n                        onChange:function(snapshot){\n                            console.log('snapshot', snapshot);\n                            that.list = snapshot.docs;\n                            that.$forceUpdate();\n                        },\n                        onError: function(err){\n                            console.log('the watch closed because of error', err)\n                        }\n\n                    })\n            }\n        },\n\n        onPullDownRefresh() {\n            this.page=1;\n            this.getList();\n            uni.stopPullDownRefresh(); // 停止刷新\n        },\n\n        onReachBottom() {\n            this.page++;\n            this.getList();\n        },\n\n        mounted() {\n            this.system = this.getSystem();\n            console.log(this.system);\n            wx.getSystemInfo({\n                success(res) {\n                    console.log(res)\n                }\n            })\n        },\n\n        computed: {\n            ...mapState(['user']),\n            formatCreateAt(){\n                return function(time){\n                    let currentTime = time;\n                    console.log('time',time);\n                    if(currentTime){\n                        return cmnUtils.formatTime(currentTime,'yyyy-MM-dd HH:mm:ss')\n                    }else{\n                        return \"\";\n                    }\n                }\n            },\n            formatCarNum(){\n                return function (carNum) {\n                    let currentNum = carNum||'';\n                    if(currentNum.indexOf('·')>0){\n                        return  currentNum;\n                    }\n                    else if(currentNum.length>0){\n                        return currentNum.substr(0,2)+'·'+currentNum.substr(2);\n                    }\n                }\n            },\n            formatAmount(){\n                return function (item) {\n                    return Math.floor(parseFloat(item.price*item.num_write_off*100))/100\n                }\n            }\n        },\n\n        methods: {\n            getSystem(){\n                let system = wx.getSystemInfoSync()\n                this.scale = 667 / 375 //按照苹果留 375*667比例 其他型号手机等比例缩放 显示\n                this.systemScale = system.windowWidth / 375 //按照苹果留 375*667比例 其他型号手机等比例缩放 显示\n                return {w:system.windowWidth,h:system.windowHeight}\n            },\n            async getEntry(){\n                let that =this;\n                that.isLoad = true;\n                let res = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'getEntryDetail',\n                        id:that.entryId\n                    }\n                });\n                console.log('getEntry',res.result);\n                let result=res.result;\n                if (result.code == 0) {\n                    that.entry = res.result.data;\n                    console.log('entry',that.entry);\n                }\n            },\n\n            async getList() {\n                let that = this;\n                that.isLoad=true;\n                that.loadingType = 1;\n                let res = await wx.cloud.callFunction({\n                    name:'vou',\n                    data:{\n                        $url:'getWriteOffList',\n                        entryId:that.entryId,\n                        page:that.page,\n                        pageSize:10\n                    }\n                });\n                console.log('getList',res.result);\n                let result=res.result;\n                if (result.code == 0) {\n                    if (that.page == 1) {\n                        that.isEndPage = false;\n                        that.list = [];\n                    }\n                    result.data.forEach(each => {\n                        that.list.push(each);\n                    })\n                }\n                //后面没数据了\n                if(result.data.length<10){\n                    that.isEndPage = true;\n                    that.loadingType = 2;\n                }\n                that.isLoad=false;\n            },\n\n            goDetail(item){\n                \n            },\n\n\n            popupOperate(item){\n                let that = this;\n                console.log('popupOperate',item);\n                that.selectedId = item._id;\n                this.$nextTick(() => {\n                    that.$refs['showPopupOperate'].open()\n                })\n            },\n\n            change(e){\n                if(e.show){\n                    this.isUps = true;\n                }else{\n                    this.isUps =false;\n                }\n            },\n\n            cancel(type){\n                this.$refs['show' + type].close()\n            },\n\n            goHome(){\n                uni.reLaunch({\n                    url: '/pages/my/home',\n                })\n            }\n        }\n    }\n</script>\n\n<style>\n    .quan{\n        padding: 0 20rpx;\n        z-index: 0;\n    }\n    .font50{\n        font-size: 50rpx;\n    }\n    .card{\n        margin-top: 20rpx;\n        width: 100%;\n        border-radius: 20rpx;\n        padding: 5rpx 30rpx;\n        height: 170rpx;\n    }\n    .font32{\n        font-size: 32rpx;\n    }\n    .line35{\n        line-height: 50rpx;\n    }\n    .font-bold{\n        font-weight: bolder;\n    }\n    .quan-text{\n        width: 640rpx;\n    }\n    .quan-right{\n        width: 200rpx;\n    }\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WriteOffList.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WriteOffList.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}