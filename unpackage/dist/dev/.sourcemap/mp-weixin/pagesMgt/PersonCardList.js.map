{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/PersonCardList.vue?dc75","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/PersonCardList.vue?25fe","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/PersonCardList.vue?f72e","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/PersonCardList.vue?915f","uni-app:///pagesMgt/PersonCardList.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/PersonCardList.vue?2013"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l1","_self","_c","__map","list","item","index","$orig","__get_orig","l0","subList","subItem","subIndex","m0","formatDateTime","create_at","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","name","searchList","res","result","sortPersonCardList","$forceUpdate"],"mappings":"qIAAA,KACA,YACA,Y,mDAFmBA,GAAGC,kCAAoCC,EAG1DC,EAAWC,a,gECHX,yHACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,8BACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,MAAMP,EAAIQ,MAAM,SAASC,EAAMC,GAC1C,IAAIC,EAAQX,EAAIY,WAAWH,GAEvBI,EAAKb,EAAIO,MAAME,EAAKK,SAAS,SAASC,EAASC,GACjD,IAAIL,EAAQX,EAAIY,WAAWG,GAEvBE,EAAKjB,EAAIkB,eAAeH,EAAQI,WACpC,MAAO,CACLR,MAAOA,EACPM,GAAIA,MAIR,MAAO,CACLN,MAAOA,EACPE,GAAIA,OAIRb,EAAIoB,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLpB,GAAIA,MAKRqB,GAAmB,EACnBC,EAAkB,GACtB3B,EAAO4B,eAAgB,G,iCCnCvB,8GAA8zB,eAAG,G,8HCwCj0B,QACA,W,4iCAKA,CACE,KADF,WAEI,MAAJ,CACA,SACM,WAAN,GACM,WAAN,KACM,UAAN,GACA,yBACM,UAAN,eACM,KAAN,KACM,OAAN,EACM,QAAN,GACA,OACM,OAAN,EACM,aAAN,EACM,gBAAN,EACM,eAAN,OAGA,OAnBA,SAmBA,GACA,oBAGE,OAvBF,WAwBI,KAAJ,qBAEE,kBA1BF,WA2BI,KAAJ,QACI,KAAJ,QACI,KAAJ,WACI,KAAJ,OACA,yBACA,yBAGE,SAAF,QACE,EAAF,uBADA,IAEI,eAFJ,WAGM,OAAN,YACQ,IAAR,IACQ,OAAR,EACA,2CAEA,OAKE,QAAF,QACE,EAAF,iCADA,IAGI,kBAHJ,WAGA,wIACgB,EAAhB,EACgBC,EAAKpB,KAAO,GACZoB,EAAKlB,MAAQ,EACbkB,EAAKd,QAArB,GACgB,EAAhB,OAEgB,EAAhB,KAPA,SASA,uBACoBe,KAAM,MACNR,KAAM,CACJ,KAAtB,uBACsB,WAAtB,gBAbA,OASA,EATA,OAgBgBO,EAAKE,WAAaC,EAAIC,OAAOX,MAAQ,GAYrCO,EAAKK,qBACLL,EAAKM,eA7BrB,+CAgCI,YAnCJ,WAmCA,wIACgB,EAAhB,EACgB,EAAhB,KAFA,SAIA,uBACoBL,KAAM,MACNR,KAAM,CACJ,KAAtB,uBACsB,WAAtB,gBARA,UAIA,EAJA,OAWgBO,EAAKE,WAAaC,EAAIC,OAAOX,MAAQ,KAYrD,GAAgB,EAAhB,8BAvBA,iDA0BgBO,EAAKK,qBA1BrB,8CA6BI,mBAhEJ,WAiEM,IAAN,OAEA,8BACM,IAAN,uBAGA,sCACA,EAIA,iCAIU,EAAV,iBACU,EAAV,sBACU,EAAV,gCACU,EAAV,QACU,EAAV,WACU,EAAV,6BAPU,EAAV,8BAWA,2BACU,EAAV,iBACU,EAAV,sBACU,EAAV,iCAKM,EAAN,gBAGI,WApGJ,SAoGA,GACM,QAAN,QAGI,UAxGJ,SAwGA,GACM,QAAN,OACM,KAAN,cACM,KAAN,0BACM,KAAN,QAGA,SA/GA,SA+GA,GACM,EAAN,YACQ,IAAR,2C,2EC/MA,8GAA+pC,eAAG,G","file":"pagesMgt/PersonCardList.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesMgt/PersonCardList.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./PersonCardList.vue?vue&type=template&id=05ae9684&\"\nvar renderjs\nimport script from \"./PersonCardList.vue?vue&type=script&lang=js&\"\nexport * from \"./PersonCardList.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PersonCardList.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesMgt/PersonCardList.vue\"\nexport default component.exports","export * from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./PersonCardList.vue?vue&type=template&id=05ae9684&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l1 = _vm.__map(_vm.list, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var l0 = _vm.__map(item.subList, function(subItem, subIndex) {\n      var $orig = _vm.__get_orig(subItem)\n\n      var m0 = _vm.formatDateTime(subItem.create_at)\n      return {\n        $orig: $orig,\n        m0: m0\n      }\n    })\n\n    return {\n      $orig: $orig,\n      l0: l0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l1: l1\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./PersonCardList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./PersonCardList.vue?vue&type=script&lang=js&\"","<template>\n    <view>\n        <cu-custom    :isBack=\"true\">\n            <block slot=\"backText\">返回</block>\n            <block slot=\"content\">{{title}}</block>\n        </cu-custom>\n        <view class=\"cu-bar bg-white search fixed\" :style=\"[{top:(CustomBar) + 'px'}]\">\n            <view class=\"search-form round\">\n                <text class=\"cuIcon-search\"></text>\n                <input @focus=\"inputFocus\" @blur=\"inputBlur\" type=\"text\" placeholder=\"输入搜索的关键词\" confirm-type=\"search\"></input>\n            </view>\n            <view class=\"action\">\n                <button class=\"cu-btn round  text-grey shadow-blur\"   @tap=\"getPersonCardList\">搜索</button>\n            </view>\n        </view>\n        <scroll-view scroll-y  :style=\"[{height:'calc(100vh - '+ CustomBar + 'px)'}]\">\n            <block v-for=\"(item,index) in list\" :key=\"index\">\n                <view class=\"padding\">{{list[index].group}}</view>\n                <view class=\"cu-list menu-avatar no-padding\">\n                    <view class=\"cu-item  card-radius margin-top-xxs margin-left-xs margin-right-xs margin-bottom-xs shadow bg-white.light\"\n                          @tap=\"goDetail(subItem._id)\"  v-for=\"(subItem,subIndex) in item.subList\" :key=\"subIndex\">\n                        <view  class=\"cu-avatar round\" >\n                            <image :src=\"subItem.avatar\" mode=\"aspectFill\" class=\"cu-avatar round\"></image>\n                        </view>\n\n                        <view class=\"content\" >\n                            <view class=\"text-grey\">{{subItem.name}}\n                                <text class=\"text-abc\"></text>\n                            </view>\n                            <view class=\"text-gray text-sm text-cut\" >创建时间：{{formatDateTime(subItem.create_at)}}</view>\n                        </view>\n                    </view>\n                </view>\n            </block>\n        </scroll-view>\n        <view class=\"cu-tabbar-height\"></view>\n    </view>\n</template>\n\n<script>\n    import {mapState,mapMutations} from 'vuex'\n    import cmnUtils from '@/utils/cmnUtils.js'\n    // #ifdef H5\n    import cloudbase from '@cloudbase/js-sdk';\n    // #endif\n\n    export default {\n        data() {\n            return {\n\t\t\t\ttitle:'',\n                search_str:'',\n                searchList: [{}],\n                listGroup: {},//包含字母分组的名片\n\t\t\t\tStatusBar: this.StatusBar,\n                CustomBar: this.CustomBar,\n                list: [{}],\n                index: -1,//list index\n                subList:[],//list.subList 字母分类下的名片数组\n\t\t\t\tpage: 1,\n                isUps:false,\n                selectedIdx:-1,//选中索引\n                selectedSubIdx:-1,//选中子索引\n                selectedCardId:'-1'//选中名片ID\n            }\n        },\n\t\tonLoad(options){\n\t\t\tthis.title=options.title;\n\t\t},\n\n        onShow() {\n            this.getPersonCardList();\n        },\n        onPullDownRefresh() {\n            this.list = [];\n            this.index = 0;\n            this.subList=[];\n            this.page = 1;\n\t\t\tthis.getPersonCardList();\n\t\t\tuni.stopPullDownRefresh(); // 停止刷新\n        },\n      \n        computed: {\n            ...mapState(['user']),\n            formatDateTime(){\n                return function(time){\n                    let currentTime = time;\n                    if(currentTime){\n                        return cmnUtils.formatTime(currentTime,'yyyy-MM-dd HH:mm')\n                    }else{\n                        return \"\";\n                    }\n                }\n            },\n        },\n        methods: {\n            ...mapMutations(['updateUser']),\n\n            async getPersonCardList() {\n                let that = this;\n                that.list = [];\n                that.index = 0;\n                that.subList=[];\n                this.page = 1;\n                //根据cardId检索收藏的历史名片\n                let res = null;\n                // #ifdef MP-WEIXIN\n                res= await wx.cloud.callFunction({\n                    name: 'sys',\n                    data: {\n                        $url: 'searchPersonCardList',\n                        search_str: that.search_str\n                    }\n                });\n                that.searchList = res.result.data || [];\n                // #endif\n                // #ifdef H5\n                res= await cloudbase.callFunction({\n                    name: 'web',\n                    data: {\n                        $url: 'searchPersonCardList',\n                        search_str: that.search_str\n                    }\n                });\n                that.searchList = JSON.parse(res.result.data) || [];\n                // #endif\n                that.sortPersonCardList();\n                that.$forceUpdate()\n            },\n\n            async getNextPage(){\n                let that = this;\n                let res = null;\n                // #ifdef MP-WEIXIN\n                res= await wx.cloud.callFunction({\n                    name: 'sys',\n                    data: {\n                        $url: 'searchPersonCardList',\n                        search_str: that.search_str\n                    }\n                });\n                that.searchList = res.result.data || [];\n                // #endif\n                // #ifdef H5\n                res= await cloudbase.callFunction({\n                    name: 'web',\n                    data: {\n                        $url: 'searchPersonCardList',\n                        search_str: that.search_str\n                    }\n                });\n                that.searchList = JSON.parse(res.result.data) || [];\n                // #endif\n                if (that.searchList.length == 0 || that.page >= 5) {\n                    return;\n                }\n                that.sortPersonCardList();\n            },\n\n            sortPersonCardList(){\n                let that = this;\n                //字母索引\n                let start_group_index = that.searchList[0].group_index;\n                for (let searchIndex in that.searchList) {\n                    let match = false;\n                    //自己排除在外\n                    if (that.user._id == that.searchList[searchIndex].user_id) {\n                        match = true;\n                    }\n\n                    //对检索记录结构化分组，适配收藏夹显示索引\n                    if (start_group_index == that.searchList[searchIndex].group_index) {\n\n                        that.subList.push(that.searchList[searchIndex])\n                    } else {\n                        that.list[that.index] = {};\n                        that.list[that.index].group = start_group_index;\n                        that.list[that.index].subList = that.subList;\n                        that.index++;\n                        that.subList = [];\n                        start_group_index = that.searchList[searchIndex].group_index;\n\n                        that.subList.push(that.searchList[searchIndex]);\n                    }\n                    if (searchIndex == that.searchList.length - 1) {\n                        that.list[that.index] = {};\n                        that.list[that.index].group = start_group_index;\n                        that.list[that.index].subList = that.subList;\n                    }\n                }\n                // console.log('list',that.list,'index',that.index,'subList',that.subList);\n\n                that.$forceUpdate()\n            },\n\n            inputFocus(e) {\n                console.log(e)\n            },\n\n            inputBlur(e) {\n                console.log(e)\n                this.searchList = [];\n                this.search_str = e.detail.value;\n                this.page = 1;\n            },\n\n\t\t\tgoDetail(cardId) {\n                uni.navigateTo({\n                    \"url\": \"/pagesSys/card/CardDetailExt?id=\" + cardId,\n                })\n            },\n        }\n    }\n</script>\n\n<style>\n    page {\n        padding-top: 100upx;\n    }\n\n    .card-radius {\n        border-radius: 10upx;\n    }\n</style>\n","import mod from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./PersonCardList.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./PersonCardList.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}