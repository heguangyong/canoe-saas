{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/BizProductList.vue?e44a","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/BizProductList.vue?ce1f","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/BizProductList.vue?9290","webpack:////Users/fustic/Workspace/canoe-saas/pagesMgt/BizProductList.vue?ea46","uni-app:///pagesMgt/BizProductList.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","that","page","products","forEach","categories","dbProductTags","replace","RegExp","name","data","doCategories","isManageTags","checkedLabels","checkedProducts"],"mappings":"qIAAA,KACA,YACA,Y,mDAFmBA,GAAGC,kCAAoCC,EAG1DC,EAAWC,a,gECHX,kHACIC,EADJ,QAQIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,8BACZ,aAAAF,E,0CCtBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCRvB,8GAA8zB,eAAG,G,8HCiDj0B,QAGA,W,kgEAGA,CACA,YACI,eAAJ,EACI,YAAJ,GAEA,KALA,WAMA,OACA,SACA,YACM,cAAN,GACA,mBACA,OACA,UACA,WAEM,WAAN,0BACA,kBAGA,OAnBA,SAmBA,GACA,oBAEA,OAtBA,WAuBA,gBAEA,kBAzBA,WA0BA,YACA,eACA,yBAEA,cA9BA,WA+BA,YACA,gBAEA,eACA,yBAEA,SACA,QADA,WACA,0IACA,IACiC,GAAbC,EAAKC,OACP,EAAlB,aAEgB,EAAhB,KALA,SAMA,uBACA,WACA,MACA,8BACA,iCACA,8BACA,eAZA,cAMA,EANA,OAeA,mCACA,6CAEgBD,EAAKE,SAASC,SAAQ,SAAtC,GACA,iCAGA,6BAtBA,UAuBA,uBACA,WACA,MACA,yBACA,gCA3BA,QAuBA,EAvBA,OA8BA,wBAEA,2BACkB,EAAlB,eAjCA,+CAqCA,KAtCA,WAuCA,YACA,wBAIA,WA5CA,WA6CM,KAAN,iBAGI,aAhDJ,WAgDA,qIACgB,EAAhB,EACgB,EAAhB,4DACgB,EAAhB,eACgBH,EAAKI,WAArB,oCACgB,EAAhB,GAEgBC,EAAgBA,EAAcC,QAAQC,OAAO,IAA7D,UAEA,kBACkB,EAAlB,gCACA,oCACsB,GAAtB,EACsB,EAAtB,oDAbA,8CAmBA,SAnEA,WAmEA,sIACgB,EAAhB,EADA,SAEA,uBACoBC,KAApB,MACoBC,KAApB,CACsB,KAAtB,aACsB,KAAtB,aANA,OASgBT,EAAKU,eACLV,EAAKW,cAArB,EAVA,8CAaA,UAhFA,SAgFA,kIACA,IAEgBX,EAAKY,cAArB,GACgBZ,EAAKa,gBAArB,GAGA,MACkB,EAAlB,iBACkB,EAAlB,yBACkB,EAAlB,OACkB,EAAlB,UACkB,EAAlB,gCACA,gBACsB,EAAtB,iBAKkB,EAAlB,+CACkB,EAAlB,gCACA,WACA,eACwB,EAAxB,+BAMA,2BACoB,EAApB,iBACoB,EAApB,yBACoB,EAApB,OACoB,EAApB,YAGoB,EAApB,yBACoB,EAApB,OACoB,EAApB,YAIA,iBA1CA,8CA6CA,aA7HA,WA8HA,cACA,mCAIA,oBAnIA,SAmIA,yIACA,KACA,cAFA,uBAGA,6CACA,sDAJA,SAMA,uBACA,WACA,MACA,0BACA,qBACA,8BACA,6BAZA,OAeA,iBAfA,gD","file":"pagesMgt/BizProductList.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesMgt/BizProductList.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./BizProductList.vue?vue&type=template&id=6b3f3215&\"\nvar renderjs\nimport script from \"./BizProductList.vue?vue&type=script&lang=js&\"\nexport * from \"./BizProductList.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesMgt/BizProductList.vue\"\nexport default component.exports","export * from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./BizProductList.vue?vue&type=template&id=6b3f3215&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./BizProductList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./BizProductList.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<cu-custom :isBack=\"true\">\n\t\t\t<block slot=\"backText\">返回</block>\n\t\t    <block slot=\"content\">{{title}}</block>\n\t\t</cu-custom>\n\t\t<view>\n\t\t\t<view v-if=\"categories.length>1\" class='padding-sm flex flex-wrap'>\n\t\t\t\t<view class=\"padding-xs\" v-for=\"(item,index) in categories\" :key=\"index\">\n\t\t\t\t\t<view v-if=\"item.checked\" class='cu-tag  line-grey round'  @tap=\"chooseTag(index)\">{{item.label}}</view>\n\t\t\t\t\t<view v-else class='cu-tag round' @tap=\"chooseTag(index)\">{{item.label}}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view v-if=\"isManageTags\">\n\t\t\t\t<view class=\"cu-bar margin-top bg-white solid-bottom\">\n\t\t\t\t\t<view class=\"action\">\n\t\t\t\t\t\t<text>产品标签（逗号分割）</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"action\">\n\t\t\t\t\t\t<button class=\"cu-btn line-grey round\" @tap=\"saveTags\">保存</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"cu-form-group align-start\">\n\t\t\t\t\t<textarea class=\"bg-white\" scroll-y=\"true\" maxlength=\"140\" placeholder=\"产品标签\" v-model=\"bizCard.tags.products\" >\n\t\t\t\t\t</textarea>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<ups-products :productList=\"checkedProducts\" :isEdit=\"true\" :isShowSwitch=\"true\" @operateProduct=\"popupOperateProduct\">\n\t\t\t</ups-products>\n\t\t\t<view class=\"cu-tabbar-height\"></view>\n\t\t\t<view class=\"cu-bar bg-white tabbar border foot\">\n\t\t\t\t<button class=\"action\" @tap=\"goMy\">\n\t\t\t\t\t<view class=\"cuIcon-my\"></view>我的\n\t\t\t\t</button>\n\t\t\t\t<button class=\"action\" @tap=\"manageTags\">\n\t\t\t\t\t<view class=\"cuIcon-tag\"></view>管理标签\n\t\t\t\t</button>\n\t\t\t\t<!--  #ifdef MP-WEIXIN -->\n\t\t\t\t<view class=\"bg-red submit text-lg\" @tap=\"goAddProduct\">新增产品</view>\n\t\t\t\t<!--  #endif -->\n\t\t\t\t<!--  #ifdef H5 -->\n\t\t\t\t<view class=\"bg-white submit text-lg\"></view>\n\t\t\t\t<!--  #endif -->\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { mapState } from 'vuex'\n    import uniPopup from '@/components/uni-popup/uni-popup.vue'\n    import upsProducts from '@/components/ups-products/index.vue'\n    import cmnUtils from '@/utils/cmnUtils.js'\n\n\n\texport default {\n\t\tcomponents:{\n            'ups-products':upsProducts,\n            \"uni-popup\":uniPopup,\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttitle:'',\n\t\t\t\tproducts:[],\n                checkedLabels:[],\n\t\t\t\tcheckedProducts:[],//用于支持筛选过滤显示\n\t\t\t\tpage:1,\n\t\t\t\tcardId:-1,\n\t\t\t\tbizCard:{},//用于更新产品标签，为检索\n                //产品标签分类\n                categories:[{label:'全部',checked:true}],\n\t\t\t\tisManageTags:false\n\t\t\t}\n\t\t},\n\t\tonLoad(options){\n\t\t\tthis.title=options.title;\n\t\t},\n\t\tonShow(){\n\t\t\tthis.getList()\n\t\t},\n\t\tonPullDownRefresh() {\n\t\t\tthis.page=1\n\t\t\tthis.getList()\n\t\t\tuni.stopPullDownRefresh(); // 停止刷新\n\t\t},\n\t\tonReachBottom() {\n\t\t\tthis.page++;\n\t\t\tthis.getList()\n\t\t},\n\t\tcomputed:{\n\t\t\t...mapState(['user']),\n\t\t},\n\t\tmethods: {\n\t\t\tasync getList(){\n\t\t\t\tlet that = this;\n                if (that.page == 1) {\n                    that.products=[];\n                }\n                let res = null;\n                res= await wx.cloud.callFunction({\n\t\t\t\t\tname:'cmn',\n\t\t\t\t\tdata:{\n\t\t\t\t\t  $url:'getProductListByCardId',\n\t\t\t\t\t  cardId:that.user.userInfo.bizCardId,\n\t\t\t\t\t  checkedLabels:that.checkedLabels,\n\t\t\t\t\t  page:that.page\n\t\t\t\t\t}\n\t\t\t\t});\n                if(!cmnUtils.isEmpty(res.result.data)){\n                    that.products.push(...res.result.data);\n                }\n                that.products.forEach(item => {\n\t\t\t\t\titem.state=item.on_sale?'已上架':'未上架';\n\t\t\t\t});\n\n\t\t\t\tthat.checkedProducts = that.products;\n\t\t\t\tres = await wx.cloud.callFunction({\n\t\t\t\t\tname:'sys',\n\t\t\t\t\tdata:{\n\t\t\t\t\t\t$url:'getCardDetailById',\n\t\t\t\t\t\tid:that.user.userInfo.bizCardId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthat.bizCard = res.result.data;\n\n\t\t\t\tif(that.checkedLabels.length==0){\n                    that.doCategories();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tgoMy(){\n\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\turl:\"/pages/my/home\"\n\t\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\tmanageTags(){\n                this.isManageTags = true;\n            },\n\t\t\t\n            async doCategories(){\n                let that =this;\n                let tags = that.bizCard.tags||{card:'',products:'',activity:'',trends:''};\n                let dbProductTags=tags.products||'';\n                that.categories=[{label:'全部',checked:true,manage:false}];\n                let checkStr = '';\n                //中文逗号替换成英文逗号\n                dbProductTags = dbProductTags.replace(RegExp('，','g'),',');\n                //英文逗号\n                if(dbProductTags.indexOf(',')>0){\n                    dbProductTags.split(',').forEach(each=>{\n                        if(each.trim().length>0 && checkStr.indexOf(each)<0){\n                            checkStr += each;\n                            that.categories.push({label:each,checked:false,manage:false});\n                        }\n                    })\n                }\n            },\n\n\t\t\tasync saveTags(){\n                let that = this;\n                await wx.cloud.callFunction({\n                    name:'sys',\n                    data:{\n                        $url:'updateCard',\n                        card:that.bizCard,\n                    }\n                });\n                that.doCategories();\n                that.isManageTags =false;\n            },\n\t\t\t\n\t\t\tasync chooseTag(index){\n\t\t\t\tlet that = this;\n                //计算当前选中标签\n                that.checkedLabels=[];\n                that.checkedProducts=[];\n\n\t\t\t\t//点全部\n\t\t\t\tif(index==0 ){\n                    that.checkedLabels=[];\n                    that.categories[0].checked = true;\n                    that.page=1;\n                    that.getList();\n                    that.categories.forEach(category=>{\n                        if(category.label!='全部') {\n                            category.checked = false;\n                        }\n                    });\n\t\t\t\t}else {\n                    //计算当前被选中的标签集合\n                    that.categories[index].checked = !that.categories[index].checked;\n                    that.categories.forEach(category=>{\n                        if(category.checked){\n                            if(category.label!='全部'){\n                                that.checkedLabels.push(category.label);\n                            }\n                        }\n                    });\n\n                    //如果没有选中，设定默认全部\n                    if(that.checkedLabels.length==0){\n                        that.checkedLabels=[];\n                        that.categories[0].checked = true;\n                        that.page=1;\n                        that.getList();\n                    }else{\n                        //去掉全部\n                        that.categories[0].checked = false;\n                        that.page=1;\n                        that.getList();\n                    }\n\t\t\t\t}\n\t\t\t\t//数据库中加载\n\t\t\t\tthat.$forceUpdate();\n\t\t\t},\n\t\t\t\n\t\t\tgoAddProduct(){\n\t\t\t\tuni.navigateTo({\n\t\t\t        \"url\":\"/pagesMgt/BizProductInput\"\n\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\tasync popupOperateProduct(type,product,idx){\n\t\t\t    let that = this\n\t\t\t    if(type='switchState'){\n\t\t\t        that.products[idx].on_sale = !that.products[idx].on_sale;\n\t\t\t\t\tthat.products[idx].state=that.products[idx].on_sale?'已上架':'未上架';\n\t\t\t        // console.log('updateProductState',that.products[idx].on_sale,that.products[idx].state);\n\t\t\t\t\tawait wx.cloud.callFunction({\n\t\t\t            name:'cmn',\n\t\t\t            data:{\n\t\t\t                $url:'updateProductState',\n\t\t\t\t\t\t\tid:that.products[idx]._id,\n\t\t\t                on_sale:that.products[idx].on_sale,\n\t\t\t\t\t\t\tstate:that.products[idx].state\n\t\t\t            }\n\t\t\t        });\n\t\t\t        that.$forceUpdate();\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style>\n</style>\n"],"sourceRoot":""}