{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/WebService.vue?fd1f","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/WebService.vue?8754","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/WebService.vue?bdbe","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/WebService.vue?4de8","uni-app:///pagesSys/site/WebService.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/WebService.vue?21e2"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","__map","historyTalk","item","__i0__","$orig","__get_orig","m0","getDateDiff","create_at","l1","talk","__i1__","m1","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","name","answerCard","JSON","parse","res","result","that","loadHistory","reverse","uni","pageScrollTo","scrollTop","lastHistory","length"],"mappings":"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","file":"pagesSys/site/WebService.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesSys/site/WebService.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./WebService.vue?vue&type=template&id=47382b11&\"\nvar renderjs\nimport script from \"./WebService.vue?vue&type=script&lang=js&\"\nexport * from \"./WebService.vue?vue&type=script&lang=js&\"\nimport style0 from \"./WebService.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesSys/site/WebService.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WebService.vue?vue&type=template&id=47382b11&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.historyTalk, function(item, __i0__) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 = _vm.getDateDiff(item.create_at)\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  var l1 = _vm.__map(_vm.talk, function(item, __i1__) {\n    var $orig = _vm.__get_orig(item)\n\n    var m1 = _vm.getDateDiff(item.create_at)\n    return {\n      $orig: $orig,\n      m1: m1\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WebService.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WebService.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<cu-custom :isBack=\"true\">\n\t\t\t<block slot=\"backText\">返回</block>\n\t\t\t<block slot=\"content\">{{target.targetName}}</block>\n\t\t</cu-custom>\n\t\t<view class=\"cu-chat\" v-for=\"item in historyTalk\" :key=\"item._id\">\n\t\t\t<view class=\"cu-item\" :class=\"item.source == sourceCardId?'self':''\">\n\t\t\t\t<image v-if=\"item.source != sourceCardId\" class=\"cu-avatar round\" :src=\"target.targetAvatar\"></image>\n\t\t\t\t<view class=\"main\">\n\t\t\t\t\t<view class=\"content shadow\" :class=\"item.source == sourceCardId?'bg-grey.light':''\">\n\t\t\t\t\t\t<text>{{item.content}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<image v-if=\"item.source == sourceCardId\" class=\"cu-avatar round\" :src=\"source.sourceAvatar\"></image>\n\t\t\t\t<view class=\"date\">{{getDateDiff(item.create_at)}}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"cu-chat\" v-for=\"item in talk\" :key=\"item._id\">\n\t\t\t<view class=\"cu-item\" :class=\"item.source == sourceCardId?'self':''\">\n\t\t\t\t<image v-if=\"item.source != sourceCardId\" class=\"cu-avatar round\" :src=\"target.targetAvatar\"></image>\n\t\t\t\t<view class=\"main\">\n\t\t\t\t\t<view class=\"content shadow\" :class=\"item.source == sourceCardId?'bg-grey.light':''\">\n\t\t\t\t\t\t<text>{{item.content}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<image v-if=\"item.source == sourceCardId\" class=\"cu-avatar round\" :src=\"source.sourceAvatar\"></image>\n\t\t\t\t<view class=\"date\">{{getDateDiff(item.create_at)}}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"cu-tabbar-height\"></view>\n\t\t<view class=\"cu-bar foot input\">\n\t\t\t<view >\n\t\t\t\t<image  class=\"cu-avatar round\"   mode=\"aspectFill\" :src=\"source.sourceAvatar\"></image>\n\t\t\t</view>\n\t\t\t<input class=\"solid-bottom\" :value=\"content\" maxlength=\"300\" cursor-spacing=\"10\" @input=\"inputContent\"></input>\n\t\t\t<button class=\"cu-btn line-grey shadow-blur\" @tap=\"send\">发送</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { mapState } from 'vuex'\n    import cloudbase from '@cloudbase/js-sdk';\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tsourceCardId:'',\n\t\t\t\ttargetCardId:'',\n\t\t\t\ttalkWatch:null,\n\t\t\t\troomId:'',\n\t\t\t\tchatRoom:{},\n\t\t\t\tcontent:\"\",\n\t\t\t\tsource:{},\n\t\t\t\ttarget:{},\n\t\t\t\ttalk:[],\n\t\t\t\thistoryTalk:[],\n\t\t\t\thasHistory:true,\n\t\t\t\tlastHistory:{_id:0,content:'',send_time:''},\n\t\t\t\tpage:1,\n                timer:null,\n\t\t\t}\n\t\t},\n\t\tonLoad(options){\n\t\t\tlet that = this;\n\t\t\t// 默认为个人名片\n\t\t\tthat.sourceCardId = that.user.userInfo.cardId;\n\t\t\tif(options.sourceCardId){\n\t\t\t\tthat.sourceCardId = options.sourceCardId;\n\t\t\t}\n\t\t\t// 默认为公司名片\n\t\t\tthat.targetCardId = that.user.userInfo.bizCardId;\n\t\t\tif(options.targetCardId){\n\t\t\t\tthat.targetCardId = options.targetCardId;\n\t\t\t}\n\t\t},\n\n        mounted() {\n            this.timer = setInterval(this.loadNewMsgList, 6000);\n        },\n        beforeDestroy() {\n            // console.log('beforeDestroy',this.timer);\n            clearInterval(this.timer);\n        },\n\n\t\tonShow(){\n\t\t\tthis.watchChatRoom();\n\t\t},\n\t\tonHide(){\n\t\t\tthis.talkWatch && this.talkWatch.close().then(()=>{\n                this.talkWatch = null;\n\t\t\t})\n\t\t},\n\t\tonPageScroll(e){\n\t\t\tif(e.scrollTop<5){\n\t\t\t\tif(this.hasHistory){\n\t\t\t\t\tthis.page++\n\t\t\t\t\tthis.loadHistory();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcomputed:{\n\t\t\t...mapState(['user']),\n\t\t},\n\t\tmethods: {\n\t\t\tasync watchChatRoom(){\n\t\t\t\tlet that = this;\n\t\t\t\tlet askCard ={};\n                let answerCard ={};\n                let res =null;\n\t\t\t\tres = await cloudbase.callFunction({\n                    name: 'web',\n                    data: {\n                        $url: 'getCardDetailById',\n                        id: that.sourceCardId,\n                    }\n                });\n\t\t\t\taskCard = JSON.parse(res.result.data);\n\t\t\t\t// console.log('askCard',res.result.data);\n                res = await cloudbase.callFunction({\n                    name: 'web',\n                    data: {\n                        $url: 'getCardDetailById',\n                        id: that.targetCardId,\n                    }\n                });\n                // console.log('answerCard',res);\n                answerCard = JSON.parse(res.result.data);\n                // 获取聊天室对象\n                res = await cloudbase.callFunction({\n                    name: 'web',\n                    data: {\n                        $url: 'getChatRoom',\n                        sourceId: that.sourceCardId,\n                        targetId: that.targetCardId\n                    }\n                });\n                // console.log('getChatRoom',res);\n\t\t\t\t// 没有聊天室\n\t\t\t\tif(res.result.code == -1){\n\t\t\t\t\tthat.chatRoom = {\n\t\t\t\t\t    target_id:answerCard._id,\n\t\t\t\t\t    target_name:answerCard.name,\n\t\t\t\t\t    target_avatar:answerCard.avatar,\n\t\t\t\t\t    source_id:askCard._id,\n\t\t\t\t\t    source_name:askCard.name,\n\t\t\t\t\t    source_avatar:askCard.avatar,\n\t\t\t\t\t    content:[],\n\t\t\t\t\t    target_unread:0,\n\t\t\t\t\t    source_unread:0,\n\t\t\t\t\t    last_history:'',\n\t\t\t\t\t};\n                    let res2 = null;\n                    res2 = await cloudbase.callFunction({\n                        name: 'sys',\n                        data: {\n                            $url: 'addChatRoom',\n                            chatRoom:that.chatRoom\n                        }\n                    });\n                    // console.log('addChatRoom roomId',res2.result.data);\n\t\t\t\t\tthat.roomId = res2.result.data;\n\t\t\t\t\tthat.chatRoom._id = that.roomId;\n\t\t\t\t}\n\t\t\t\t//已有聊天室\n\t\t\t\telse if(res.result.code == 0){\n                    that.chatRoom = JSON.parse(res.result.data);\n\t\t\t\t\tthat.roomId = that.chatRoom._id;\n\t\t\t\t}\n                res = await cloudbase.callFunction({\n                    name: 'sys',\n                    data: {\n                        $url:'exchangeCards',\n                        \"roomId\":that.roomId,\n                        \"askCardId\": that.sourceCardId,\n                        \"answerCardId\": that.targetCardId\n                    }\n                });\n                // console.log('exchangeCards',res);\n                // console.log('交换名片', res);\n\t\t\t\t// 检测会话发起方源头\n\t\t\t\tlet isSource = that.chatRoom.source_id == that.sourceCardId;\n\t\t\t\tthat.source.sourceId=isSource?that.chatRoom.source_id:that.chatRoom.target_id;\n\t\t\t\tthat.source.sourceName=isSource?that.chatRoom.source_name:that.chatRoom.target_name;\n\t\t\t\tthat.source.sourceAvatar=isSource?that.chatRoom.source_avatar:that.chatRoom.target_avatar;\n\t\t\t\tthat.target.targetId=isSource?that.chatRoom.target_id:that.chatRoom.source_id;\n\t\t\t\tthat.target.targetName=isSource?that.chatRoom.target_name:that.chatRoom.source_name;\n\t\t\t\tthat.target.targetAvatar=isSource?that.chatRoom.target_avatar:that.chatRoom.source_avatar;\n\t\t\t\t// console.log('加载聊天室：','roomId',that.roomId,'sourceName',that.source.sourceName,'targetName',that.target.targetName,'isSource',isSource);\n                await cloudbase.callFunction({\n                    name:'sys',\n                    data:{\n                        $url:'clearUnreadChatTip',\n                        id: that.roomId,\n                        isSource:isSource\n                    }\n                });\n                // console.log('clearUnreadChatTip');\n                //同步历史\n                that.loadHistory();\n                that.historyTalk = that.historyTalk.reverse();\n                // 设置一个超大值，以保证滚动条滚动到底部\n                uni.pageScrollTo({ scrollTop: 9999999,\t duration: 0});\n\t\t\t},\n\n\t\t\tasync loadHistory(){\n\t\t\t\tlet that = this;\n                let res = await cloudbase.callFunction({\n                    name:'web',\n                    data:{\n                        $url:'getChatMsgHistoryList',\n                        id: that.roomId,\n                        page:that.page\n                    }\n                })\n\t\t\t\tif(res.result.code == 0){\n                    let history = null;\n                    history = JSON.parse(res.result.data);\n                    // console.log('loadHistory',res.result.data);\n\t\t\t\t\tfor(let i = 0;i<history.length;i++){\n\t\t\t\t\t\tthat.historyTalk.unshift(history[i])\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tthat.hasHistory = false;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tasync loadNewMsgList(){\n\t\t\t    let that = this;\n                that.lastHistory = that.historyTalk[that.historyTalk.length-1]||{_id:0,content:'',send_time:''};\n                // console.log('lastHistory',that.lastHistory.content,that.lastHistory.create_at+'');\n                let res = await cloudbase.callFunction({\n                    name:'web',\n                    data:{\n                        $url:'getNewChatMsgList',\n                        id: that.roomId,\n\t\t\t\t\t\tcreate_at:that.lastHistory.create_at\n                    }\n                });\n                if(res.result.code == 0){\n                    let newMsgList = JSON.parse(res.result.data);\n                    Object.assign(that.talk,newMsgList);\n                    // 设置一个超大值，以保证滚动条滚动到底部\n                    uni.pageScrollTo({ scrollTop: 9999999,\t duration: 0});\n                    // console.log('loadNewMsgList length',that.talk.length,newMsgList.length);\n                    that.$forceUpdate();\n                }\n\t\t\t},\n\n\t\t\tinputContent(e) {\n\t\t\t\tthis.content = e.detail.value;\n\t\t\t},\n\n\t\t\tasync send(){\n\t\t\t\tlet that = this;\n\t\t\t\tif(that.content != \"\"){\n\t\t\t\t\tlet talk = {};\n\t\t\t\t\ttalk = {\n\t\t\t\t\t\tcontent:this.content,\n\t\t\t\t\t\tsource:that.source.sourceId,\n\t\t\t\t\t\ttarget:that.target.targetId,\n\t\t\t\t\t\ttype:'text',\n\t\t\t\t\t\troom_id:that.roomId,\n\t\t\t\t\t}\n\t\t\t\t\t// 发消息\n\t\t\t\t\tlet res =null;\n\t\t\t\t\tres = await cloudbase.callFunction({\n                        name:'sys',\n                        data:{\n                            $url:'addTalk',\n                            talk: talk,\n                        }\n                    })\n                    // console.log('addTalk',res.result.code);\n\t\t\t\t\tif(res.result.code == 0){\n\t\t\t\t\t\tlet lastHistory = '';\n\t\t\t\t\t\tlet isSource = false;\n\t\t\t\t\t\tlastHistory = this.content;\n\t\t\t\t\t\tif(that.chatRoom.source_id == that.sourceCardId){\n\t\t\t\t\t\t\tisSource = true;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tisSource = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 更新主表未读信息\n                        let res2 = null;\n                        res2 = await cloudbase.callFunction({\n                            name:'sys',\n                            data:{\n                                $url:'updateChatRoomUnreadTip',\n                                id: that.roomId,\n                                tid: res.result.data,\n                                last_history:lastHistory,\n                                isSource:isSource\n                            }\n                        })\n                        // console.log('updateChatRoomUnreadTip',res2.result.code);\n\t\t\t\t\t}\n\t\t\t\t\tthat.content = \"\"\n\t\t\t\t\tuni.pageScrollTo({\n\t\t\t\t\t\tscrollTop: 999999,\t// 设置一个超大值，以保证滚动条滚动到底部\n\t\t\t\t\t\tduration: 0\n\t\t\t\t\t});\n\t\t\t\t\tthis.$forceUpdate()\t\t\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tgetDateDiff(createAt){\n\t\t\t\tvar date = \"\";\n\t\t\t\t// let valueTime= Date.parse(createAt)\n\t\t\t\tvar newData =  Date.parse(new Date());\n\t\t\t\tvar diffTime = Math.abs(newData-createAt);\n\t\t\t\tif (diffTime > 7 * 24 * 3600 * 1000) {\n\t\t\t\t\t  var date = new Date(createAt);\n\t\t\t\t\t  var y = date.getFullYear();\n\t\t\t\t\t  var m = date.getMonth() + 1;\n\t\t\t\t\t  var d = date.getDate();\n\t\t\t\t\t  let cy=new Date().getFullYear();\n\t\t\t\t\t  cy==y?(date = m + '月' + d +'日'):(date = y+'年'+ m + '月' + d +'日');\n\t\t\t\t} else if (diffTime < 7 * 24 * 3600 * 1000 && diffTime > 24 * 3600 * 1000) {\n\t\t\t\t  // //注释(\"一周之内\");\n\t\t\t\t\t\n\t\t\t\t  // var time = newData - diffTime;\n\t\t\t\t  var dayNum = Math.floor(diffTime / (24 * 60 * 60 * 1000));\n\t\t\t\t  date = dayNum + \"天前\";\n\t\t\t\t} else if (diffTime < 24 * 3600 * 1000 && diffTime > 3600 * 1000) {\n\t\t\t\t  // //注释(\"一天之内\");\n\t\t\t\t  // var time = newData - diffTime;\n\t\t\t\t  var dayNum = Math.floor(diffTime / (60 * 60 * 1000));\n\t\t\t\t  date = dayNum + \"小时前\";\n\t\t\t\t\t\n\t\t\t\t} else if (diffTime < 3600 * 1000 && diffTime >= 0) {\n\t\t\t\t  date = ''\n\t\t\t\t}\n\t\t\t\treturn date;\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style>\n\t.box {\n\t\tmargin: 20upx 0;\n\t}\n\n\t.box view.cu-bar {\n\t\tmargin-top: 20upx;\n\t}\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WebService.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WebService.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}