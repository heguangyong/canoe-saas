{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/service.vue?f11f","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/service.vue?bde3","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/service.vue?3ff9","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/service.vue?0b24","uni-app:///pagesSys/site/service.vue","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/service.vue?4802"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","__map","historyTalk","item","index","$orig","__get_orig","m0","getDateDiff","create_at","l1","talk","m1","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","talkWatch"],"mappings":"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","file":"pagesSys/site/service.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesSys/site/service.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./service.vue?vue&type=template&id=3d42c5b5&\"\nvar renderjs\nimport script from \"./service.vue?vue&type=script&lang=js&\"\nexport * from \"./service.vue?vue&type=script&lang=js&\"\nimport style0 from \"./service.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesSys/site/service.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=template&id=3d42c5b5&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.historyTalk, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 = _vm.getDateDiff(item.create_at)\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  var l1 = _vm.__map(_vm.talk, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m1 = _vm.getDateDiff(item.create_at)\n    return {\n      $orig: $orig,\n      m1: m1\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<cu-custom :isBack=\"true\">\n\t\t\t<block slot=\"backText\">返回</block>\n\t\t\t<block slot=\"content\">{{target.targetName}}</block>\n\t\t</cu-custom>\n\t\t<view class=\"cu-chat\" v-for=\"(item,index) in historyTalk\" :key=\"index\">\n\t\t\t<view class=\"cu-item\" :class=\"item.source == sourceCardId?'self':''\">\n\t\t\t\t<image v-if=\"item.source != sourceCardId\" class=\"cu-avatar round\" mode=\"aspectFill\" :src=\"target.targetAvatar\"></image>\n\t\t\t\t<view class=\"main\">\n\t\t\t\t\t<view class=\"content shadow\" :class=\"item.source == sourceCardId?'bg-grey.light':''\">\n\t\t\t\t\t\t<text>{{item.content}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<image v-if=\"item.source == sourceCardId\" class=\"cu-avatar round\" mode=\"aspectFill\" :src=\"source.sourceAvatar\"></image>\n\t\t\t\t<view class=\"date\">{{getDateDiff(item.create_at)}}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"cu-chat\" v-for=\"(item,index) in talk\" :key=\"index\">\n\t\t\t<view class=\"cu-item\" :class=\"item.source == sourceCardId?'self':''\">\n\t\t\t\t<image v-if=\"item.source != sourceCardId\" class=\"cu-avatar round\" mode=\"aspectFill\" :src=\"target.targetAvatar\"></image>\n\t\t\t\t<view class=\"main\">\n\t\t\t\t\t<view class=\"content shadow\" :class=\"item.source == sourceCardId?'bg-grey.light':''\">\n\t\t\t\t\t\t<text>{{item.content}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<image v-if=\"item.source == sourceCardId\" class=\"cu-avatar round\" mode=\"aspectFill\" :src=\"source.sourceAvatar\"></image>\n\t\t\t\t<view class=\"date\">{{getDateDiff(item.create_at)}}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"cu-tabbar-height\"></view>\n\t\t<view class=\"cu-bar foot input\">\n\t\t\t<view >\n\t\t\t\t<image  class=\"cu-avatar round\"   mode=\"aspectFill\" :src=\"source.sourceAvatar\"></image>\n\t\t\t</view>\n\t\t\t<input class=\"solid-bottom\" :value=\"content\" maxlength=\"300\" cursor-spacing=\"10\" @input=\"inputContent\"></input>\n\t\t\t<button class=\"cu-btn line-grey shadow-blur\" @tap=\"send\">发送</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { mapState } from 'vuex'\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tsourceCardId:'',\n\t\t\t\ttargetCardId:'',\n\t\t\t\ttalkWatch:null,\n\t\t\t\troomId:'',\n\t\t\t\tchatRoom:{},\n\t\t\t\tcontent:\"\",\n\t\t\t\tsource:{},\n\t\t\t\ttarget:{},\n\t\t\t\ttalk:[],\n\t\t\t\thistoryTalk:[],\n\t\t\t\thasHistory:true,\n\t\t\t\tpage:1,\n\t\t\t}\n\t\t},\n\t\tonLoad(options){\n\t\t\tlet that = this;\n\t\t\t// 默认为个人名片\n\t\t\tthat.sourceCardId = that.user.userInfo.cardId;\n\t\t\tif(options.sourceCardId){\n\t\t\t\tthat.sourceCardId = options.sourceCardId;\n\t\t\t}\n\t\t\t// 默认为公司名片\n\t\t\tthat.targetCardId = that.user.userInfo.bizCardId;\n\t\t\tif(options.targetCardId){\n\t\t\t\tthat.targetCardId = options.targetCardId;\n\t\t\t}\n\t\t},\n\n\t\tonShow(){\n\t\t\tthis.watchChatRoom();\n\t\t},\n\t\tonHide(){\n\t\t\tthis.talkWatch && this.talkWatch.close().then(()=>{\n                this.talkWatch = null;\n\t\t\t})\n\t\t},\n\t\tonPageScroll(e){\n\t\t\tif(e.scrollTop<5){\n\t\t\t\tif(this.hasHistory){\n\t\t\t\t\tthis.page++\n\t\t\t\t\tthis.loadHistory();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcomputed:{\n\t\t\t...mapState(['user']),\n\t\t},\n\t\tmethods: {\n\t\t\tasync watchChatRoom(){\n\t\t\t\tlet that = this;\n\t\t\t\t// 获取发起方名片信息\n\t\t\t\tlet res = await wx.cloud.callFunction({\n\t\t\t\t    name: 'sys',\n\t\t\t\t    data: {\n\t\t\t\t        $url: 'getCardDetailById',\n\t\t\t\t        id: that.sourceCardId,\n\t\t\t\t    }\n\t\t\t\t});\n\t\t\t\tlet askCard = res.result.data;\n\n\t\t\t\t// 获取应答方名片信息\n\t\t\t\tres = await wx.cloud.callFunction({\n\t\t\t\t    name: 'sys',\n\t\t\t\t    data: {\n\t\t\t\t        $url: 'getCardDetailById',\n\t\t\t\t        id: that.targetCardId,\n\t\t\t\t    }\n\t\t\t\t});\n\t\t\t\tlet answerCard = res.result.data;\n\t\t\t\t// 获取聊天室对象\n\t\t\t\tres = await wx.cloud.callFunction({\n\t\t\t\t    name: 'sys',\n\t\t\t\t    data: {\n\t\t\t\t        $url: 'getChatRoom',\n\t\t\t\t        sourceId: that.sourceCardId,\n\t\t\t\t        targetId: that.targetCardId\n\t\t\t\t    }\n\t\t\t\t});\n\t\t\t\t// 没有聊天室\n\t\t\t\tif(res.result.code == -1){\n\t\t\t\t\tthat.chatRoom = {\n\t\t\t\t\t    target_id:answerCard._id,\n\t\t\t\t\t    target_name:answerCard.name,\n\t\t\t\t\t    target_avatar:answerCard.avatar,\n\t\t\t\t\t    source_id:askCard._id,\n\t\t\t\t\t    source_name:askCard.name,\n\t\t\t\t\t    source_avatar:askCard.avatar,\n\t\t\t\t\t    content:[],\n\t\t\t\t\t    target_unread:0,\n\t\t\t\t\t    source_unread:0,\n\t\t\t\t\t    last_history:'',\n\t\t\t\t\t};\n\t\t\t\t    //新建聊天室\n\t\t\t\t    let res2 = await wx.cloud.callFunction({\n\t\t\t\t        name: 'sys',\n\t\t\t\t        data: {\n\t\t\t\t            $url: 'addChatRoom',\n\t\t\t\t            chatRoom:that.chatRoom\n\t\t\t\t        }\n\t\t\t\t    });\n\t\t\t\t\tthat.roomId = res2.result.data;\n\t\t\t\t\tthat.chatRoom._id = that.roomId;\n\t\t\t\t}\n\t\t\t\t//已有聊天室\n\t\t\t\telse if(res.result.code == 0){\n\t\t\t\t\tthat.chatRoom = res.result.data;\n\t\t\t\t\tthat.roomId = that.chatRoom._id;\n\t\t\t\t}\n\t\t\t\t//交换名片\n\t\t\t\tres = await wx.cloud.callFunction({\n\t\t\t\t    name: 'sys',\n\t\t\t\t    data: {\n\t\t\t\t        $url:'exchangeCards',\n\t\t\t\t        \"roomId\":that.roomId,\n\t\t\t\t        \"askCardId\": that.sourceCardId,\n\t\t\t\t        \"answerCardId\": that.targetCardId\n\t\t\t\t    }\n\t\t\t\t});\n\t\t\t\tconsole.log('交换名片', res);\n\t\t\t\t// 检测会话发起方源头\n\t\t\t\tlet isSource = that.chatRoom.source_id == that.sourceCardId;\n\t\t\t\tthat.source.sourceId=isSource?that.chatRoom.source_id:that.chatRoom.target_id;\n\t\t\t\tthat.source.sourceName=isSource?that.chatRoom.source_name:that.chatRoom.target_name;\n\t\t\t\tthat.source.sourceAvatar=isSource?that.chatRoom.source_avatar:that.chatRoom.target_avatar;\n\t\t\t\tthat.target.targetId=isSource?that.chatRoom.target_id:that.chatRoom.source_id;\n\t\t\t\tthat.target.targetName=isSource?that.chatRoom.target_name:that.chatRoom.source_name;\n\t\t\t\tthat.target.targetAvatar=isSource?that.chatRoom.target_avatar:that.chatRoom.source_avatar;\n\t\t\t\tconsole.log('加载聊天室：','roomId',that.roomId,'sourceName',that.source.sourceName,'targetName',that.target.targetName,'isSource',isSource);\n\t\t\t\t// 同步更新未读提示\n\t\t\t\tawait wx.cloud.callFunction({\n\t\t\t\t\tname:'sys',\n\t\t\t\t\tdata:{\n\t\t\t\t\t\t$url:'clearUnreadChatTip',\n\t\t\t\t\t\tid: that.roomId,\n\t\t\t\t\t\tisSource:isSource\n\t\t\t\t\t}\n\t\t\t\t});\n                //监听\n\t\t\t\tconst db = wx.cloud.database();\n                that.talkWatch= db.collection('sys_chat_msg')\n                    .where({\n                        \"room_id\":that.roomId\n                    })\n                    .watch({\n                        onChange: function(snapshot){\n                            // console.log('onchange',snapshot.docChanges);\n                            if(snapshot.type === \"init\"){\n                                //同步历史\n                                wx.cloud.callFunction({\n                                    name:'sys',\n                                    data:{\n                                        $url:'getChatMsgHistoryList',\n                                        id: that.roomId,\n                                        page:that.page\n                                    }\n                                }).then((dbHistory) =>{\n                                    that.historyTalk = dbHistory.result.data;\n                                    that.historyTalk = that.historyTalk.reverse();\n                                    // 设置一个超大值，以保证滚动条滚动到底部\n                                    uni.pageScrollTo({ scrollTop: 9999999,\t duration: 0});\n                                })\n                            }else{\n                                if(snapshot.docChanges[0].dataType=='add'){\n                                    that.talk.push(snapshot.docChanges[0].doc);\n                                    // 设置一个超大值，以保证滚动条滚动到底部\n                                    uni.pageScrollTo({ scrollTop: 9999999,\t duration: 0});\n                                }\n                            }\n                        },\n                        onError:(err) => {\n                            console.log('the watch closed because of error',err)\n                        }\n                    })\n\t\t\t},\n\t\t\tasync loadHistory(){\n\t\t\t\tlet that = this;\n\t\t\t\tlet res = await wx.cloud.callFunction({\n\t\t\t\t\t    name:'sys',\n\t\t\t\t\t    data:{\n\t\t\t\t\t        $url:'getChatMsgHistoryList',\n\t\t\t\t\t        id: that.roomId,\n\t\t\t\t\t\t\tpage:that.page\n\t\t\t\t\t    }\n\t\t\t\t\t})\n\n\t\t\t\tif(res.result.code == 0){\n\t\t\t\t\tlet history = res.result.data;\n\t\t\t\t\tfor(let i = 0;i<history.length;i++){\n\t\t\t\t\t\tthat.historyTalk.unshift(history[i])\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tthat.hasHistory = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tinputContent(e) {\n\t\t\t\tthis.content = e.detail.value;\n\t\t\t},\n\t\t\tasync send(){\n\t\t\t\tlet that = this;\n\t\t\t\tif(that.content != \"\"){\n\t\t\t\t\tlet secRes = await wx.cloud.callFunction({\n\t\t\t\t\t\tname:'sys',\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t$url:'msgSecCheck',\n\t\t\t\t\t\t\tvalue:that.content\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n                    if(secRes.result.code!=0){\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ticon:'none',\n\t\t\t\t\t\t\ttitle:'内容含有违规内容，请修改后提交'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n                    }\n\n\t\t\t\t\tlet talk = {};\n\t\t\t\t\ttalk = {\n\t\t\t\t\t\tcontent:this.content,\n\t\t\t\t\t\tsource:that.source.sourceId,\n\t\t\t\t\t\ttarget:that.target.targetId,\n\t\t\t\t\t\ttype:'text',\n\t\t\t\t\t\troom_id:that.roomId,\n\t\t\t\t\t};\n\t\t\t\t\t// 发消息\n\t\t\t\t\tlet res = await wx.cloud.callFunction({\n\t\t\t\t\t\tname:'sys',\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t$url:'addTalk',\n\t\t\t\t\t\t\ttalk: talk,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tif(res.result.code == 0){\n\t\t\t\t\t\tlet lastHistory = '';\n\t\t\t\t\t\tlet isSource = false;\n\t\t\t\t\t\tlastHistory = this.content;\n\t\t\t\t\t\tif(that.chatRoom.source_id == that.sourceCardId){\n\t\t\t\t\t\t\tisSource = true;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tisSource = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 更新主表未读信息\n\t\t\t\t\t\tlet res2 = await wx.cloud.callFunction({\n\t\t\t\t\t\t\tname:'sys',\n\t\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\t\t$url:'updateChatRoomUnreadTip',\n\t\t\t\t\t\t\t\tid: that.roomId,\n\t\t\t\t\t\t\t\ttid: res.result.data,\n\t\t\t\t\t\t\t\tlast_history:lastHistory,\n\t\t\t\t\t\t\t\tisSource:isSource\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tthat.content = \"\"\n                    // 设置一个超大值，以保证滚动条滚动到底部\n                    uni.pageScrollTo({ scrollTop: 9999999,\t duration: 0});\n\t\t\t\t\tthis.$forceUpdate()\t\t\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tgetDateDiff(createAt){\n\t\t\t\tvar date = \"\";\n\t\t\t\t// let valueTime= Date.parse(createAt)\n\t\t\t\tvar newData =  Date.parse(new Date());\n\t\t\t\tvar diffTime = Math.abs(newData-createAt);\n\t\t\t\tif (diffTime > 7 * 24 * 3600 * 1000) {\n\t\t\t\t\t  var date = new Date(createAt);\n\t\t\t\t\t  var y = date.getFullYear();\n\t\t\t\t\t  var m = date.getMonth() + 1;\n\t\t\t\t\t  var d = date.getDate();\n\t\t\t\t\t  let cy=new Date().getFullYear();\n\t\t\t\t\t  cy==y?(date = m + '月' + d +'日'):(date = y+'年'+ m + '月' + d +'日');\n\t\t\t\t} else if (diffTime < 7 * 24 * 3600 * 1000 && diffTime > 24 * 3600 * 1000) {\n\t\t\t\t  // //注释(\"一周之内\");\n\t\t\t\t\t\n\t\t\t\t  // var time = newData - diffTime;\n\t\t\t\t  var dayNum = Math.floor(diffTime / (24 * 60 * 60 * 1000));\n\t\t\t\t  date = dayNum + \"天前\";\n\t\t\t\t} else if (diffTime < 24 * 3600 * 1000 && diffTime > 3600 * 1000) {\n\t\t\t\t  // //注释(\"一天之内\");\n\t\t\t\t  // var time = newData - diffTime;\n\t\t\t\t  var dayNum = Math.floor(diffTime / (60 * 60 * 1000));\n\t\t\t\t  date = dayNum + \"小时前\";\n\t\t\t\t\t\n\t\t\t\t} else if (diffTime < 3600 * 1000 && diffTime >= 0) {\n\t\t\t\t  date = ''\n\t\t\t\t}\n\t\t\t\treturn date;\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style>\n\t.box {\n\t\tmargin: 20upx 0;\n\t}\n\n\t.box view.cu-bar {\n\t\tmargin-top: 20upx;\n\t}\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}