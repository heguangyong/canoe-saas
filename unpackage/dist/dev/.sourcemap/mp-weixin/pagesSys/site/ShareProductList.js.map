{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/ShareProductList.vue?7c26","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/ShareProductList.vue?1740","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/ShareProductList.vue?24e2","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/site/ShareProductList.vue?f62b","uni-app:///pagesSys/site/ShareProductList.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","that","page","name","data","bizCard","res","result","categories","dbProductTags","replace","RegExp","checkedLabels","products","$forceUpdate"],"mappings":"4IAAA,KACA,YACA,Y,mDAFmBA,GAAGC,kCAAoCC,EAG1DC,EAAWC,a,gECHX,kHACIC,EADJ,QAQIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,qCACZ,aAAAF,E,0CCtBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCRvB,8GAA+0B,eAAG,G,8HCqBl1B,QAEA,W,44DAEA,CACA,YACI,eAAJ,GAEA,KAJA,WAKA,OACA,YACM,cAAN,GACA,OACA,WAEM,WAAN,4BAIE,OAfF,SAeA,GACI,IAAJ,OACA,WACM,EAAN,iCACM,EAAN,YAIE,kBAvBF,SAuBA,GAGI,OAFJ,OAEA,CACM,MAAN,kCACM,SAAN,uBACM,KAAN,kDACM,QAAN,gBAKE,QAnCF,WAoCI,GAAJ,uBACM,MAAN,UAIA,OAzCA,WA0CA,gBAEA,kBA5CA,WA6CA,YACA,eACA,yBAEA,cAjDA,WAkDA,YACA,gBAEA,eACA,oCAEA,gBACE,EAAF,sCADA,IAEA,QAFA,WAEA,0IACgB,EAAhB,EACiC,GAAbC,EAAKC,OACP,EAAlB,aAEgB,EAAhB,KALA,SAMA,uBACoBC,KAApB,MACoBC,KAApB,CACsB,KAAtB,+BACsB,OAAtB,0BACsB,cAAtB,gBACsB,KAAtB,UAZA,cAMA,EANA,OAeA,mCACA,6CAhBA,SAkBA,uBACoBD,KAApB,MACoBC,KAApB,CACsB,KAAtB,oBACsB,GAAtB,6BAtBA,OAkBA,EAlBA,OAyBgBH,EAAKI,QAAUC,EAAIC,OAAOH,KAE1C,2BACkB,EAAlB,eA5BA,+CAgCI,aAlCJ,WAkCA,qIACgB,EAAhB,EACgB,EAAhB,4DACgB,EAAhB,eACgBH,EAAKO,WAArB,oCACgB,EAAhB,GAEgBC,EAAgBA,EAAcC,QAAQC,OAAO,IAA7D,UAEA,kBACkB,EAAlB,gCACA,oCACsB,GAAtB,EACsB,EAAtB,oDAbA,8CAmBI,UArDJ,SAqDA,kIACgB,EAAhB,EAEgBV,EAAKW,cAArB,GACgBX,EAAKY,SAArB,GAGA,MACkB,EAAlB,iBACkB,EAAlB,yBACkB,EAAlB,OACkB,EAAlB,UACkB,EAAlB,gCACA,gBACsB,EAAtB,iBAKkB,EAAlB,+CACkB,EAAlB,gCACA,WACA,eACwB,EAAxB,+BAMA,2BACoB,EAApB,iBACoB,EAApB,yBACoB,EAApB,OACoB,EAApB,YAGoB,EAApB,yBACoB,EAApB,OACoB,EAApB,YAIgBZ,EAAKa,eA1CrB,iD","file":"pagesSys/site/ShareProductList.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesSys/site/ShareProductList.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./ShareProductList.vue?vue&type=template&id=596762c4&\"\nvar renderjs\nimport script from \"./ShareProductList.vue?vue&type=script&lang=js&\"\nexport * from \"./ShareProductList.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesSys/site/ShareProductList.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareProductList.vue?vue&type=template&id=596762c4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareProductList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./ShareProductList.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<!-- #ifdef MP-WEIXIN-->\n\t\t<cu-custom :isBack=\"false\">\n\t\t    <block slot=\"content\">最新产品</block>\n\t\t</cu-custom>\n\t\t<!-- #endif-->\n\t\t<view v-if=\"categories.length>1\" class='padding-sm flex flex-wrap'>\n\t\t\t<view class=\"padding-xs\" v-for=\"(item,index) in categories\" :key=\"index\">\n\t\t\t\t<view v-if=\"item.checked\" class='cu-tag  bg-grey round'  @tap=\"chooseTag(index)\">{{item.label}}</view>\n\t\t\t\t<view v-else class='cu-tag line-gray round' @tap=\"chooseTag(index)\">{{item.label}}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view>\n\t\t\t<ups-products :productList=\"products\"></ups-products>\n\t\t</view>\n\t\t<view class=\"cu-tabbar-height\"></view>\n\t</view>\n</template>\n\n<script>\n\timport { mapState,mapMutations  } from 'vuex'\n    import upsProducts from '@/components/ups-products/index.vue'\n    import cmnUtils from '@/utils/cmnUtils.js'\n\n\texport default {\n\t\tcomponents:{\n            'ups-products':upsProducts,\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tproducts:[],\n                checkedLabels:[],\n\t\t\t\tpage:1,\n\t\t\t\tbizCard:{},//用于更新产品标签，为检索\n                //产品标签分类\n                categories:[{label:'全部',checked:true}],\n\t\t\t}\n\t\t},\n\n    onLoad(options){\n      let that = this;\n      if(options.cardId) {\n        that.user.userInfo.bizCardId = options.cardId;\n        that.getList();\n      }\n    },\n\n    onShareAppMessage(res){\n      if(res.from==='button'){\n      }\n      return{\n        title:'这是'+this.bizCard.name+'的产品，请惠存。',\n        imageUrl:this.bizCard.cover||'',\n        path:\"/pagesSys/site/product?cardId=\"+this.bizCard._id,\n        success:function(res){\n        }\n      }\n    },\n\n    onReady(){\n      wx.setNavigationBarTitle({\n          title: \"最新产品\"\n      })\n\t\t},\n\n\t\tonShow(){\n\t\t\tthis.getList()\n\t\t},\n\t\tonPullDownRefresh() {\n\t\t\tthis.page=1\n\t\t\tthis.getList()\n\t\t\tuni.stopPullDownRefresh(); // 停止刷新\n\t\t},\n\t\tonReachBottom() {\n\t\t\tthis.page++;\n\t\t\tthis.getList()\n\t\t},\n\t\tcomputed:{\n\t\t\t...mapState(['user','filePath']),\n\t\t},\n\t\tmethods: {\n            ...mapMutations(['convertFilePath']),\n\t\t\tasync getList(){\n                let that = this;\n                if (that.page == 1) {\n                    that.products=[];\n                }\n                let res = null;\n                res= await wx.cloud.callFunction({\n                    name:'cmn',\n                    data:{\n                        $url:'getOnSaleProductListByCardId',\n                        cardId:that.user.userInfo.bizCardId,\n                        checkedLabels:that.checkedLabels,\n                        page:that.page\n                    }\n                });\n                if(!cmnUtils.isEmpty(res.result.data)){\n                    that.products.push(...res.result.data);\n                }\n                res = await wx.cloud.callFunction({\n                    name:'sys',\n                    data:{\n                        $url:'getCardDetailById',\n                        id:that.user.userInfo.bizCardId\n                    }\n                });\n                that.bizCard = res.result.data;\n\n                if(that.checkedLabels.length==0){\n                    that.doCategories();\n                }\n\t\t\t},\n\n            async doCategories(){\n                let that =this;\n                let tags = that.bizCard.tags||{card:'',products:'',activity:'',trends:''};\n                let dbProductTags=tags.products||'';\n                that.categories=[{label:'全部',checked:true,manage:false}];\n                let checkStr = '';\n                //中文逗号替换成英文逗号\n                dbProductTags = dbProductTags.replace(RegExp('，','g'),',');\n                //英文逗号\n                if(dbProductTags.indexOf(',')>0){\n                    dbProductTags.split(',').forEach(each=>{\n                        if(each.trim().length>0 && checkStr.indexOf(each)<0){\n                            checkStr += each;\n                            that.categories.push({label:each,checked:false,manage:false});\n                        }\n                    })\n                }\n            },\n\n            async chooseTag(index){\n                let that = this;\n                //计算当前选中标签\n                that.checkedLabels=[];\n                that.products=[];\n\n                //点全部\n                if(index==0 ){\n                    that.checkedLabels=[];\n                    that.categories[0].checked = true;\n                    that.page=1;\n                    that.getList();\n                    that.categories.forEach(category=>{\n                        if(category.label!='全部') {\n                            category.checked = false;\n                        }\n                    });\n                }else {\n                    //计算当前被选中的标签集合\n                    that.categories[index].checked = !that.categories[index].checked;\n                    that.categories.forEach(category=>{\n                        if(category.checked){\n                            if(category.label!='全部'){\n                                that.checkedLabels.push(category.label);\n                            }\n                        }\n                    });\n\n                    //如果没有选中，设定默认全部\n                    if(that.checkedLabels.length==0){\n                        that.checkedLabels=[];\n                        that.categories[0].checked = true;\n                        that.page=1;\n                        that.getList();\n                    }else{\n                        //去掉全部\n                        that.categories[0].checked = false;\n                        that.page=1;\n                        that.getList();\n                    }\n                }\n                //数据库中加载\n                that.$forceUpdate();\n            },\n\t\t}\n\t}\n</script>\n\n<style>\n</style>\n"],"sourceRoot":""}