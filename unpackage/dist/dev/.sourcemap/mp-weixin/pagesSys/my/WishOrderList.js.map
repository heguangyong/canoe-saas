{"version":3,"sources":["uni-app:///main.js","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/my/WishOrderList.vue?28cb","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/my/WishOrderList.vue?19d9","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/my/WishOrderList.vue?669b","webpack:////Users/fustic/Workspace/canoe-saas/pagesSys/my/WishOrderList.vue?3c81","uni-app:///pagesSys/my/WishOrderList.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l1","_self","_c","__map","orderList","order","index","$orig","__get_orig","l0","items","item","itemIndex","g0","parseFloat","price","toFixed","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","that","isSelectedAll","forEach","totalPrice","$forceUpdate","console","log","e","selectedIds","detail","value","page","name"],"mappings":"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","file":"pagesSys/my/WishOrderList.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesSys/my/WishOrderList.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./WishOrderList.vue?vue&type=template&id=836a97ac&\"\nvar renderjs\nimport script from \"./WishOrderList.vue?vue&type=script&lang=js&\"\nexport * from \"./WishOrderList.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesSys/my/WishOrderList.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WishOrderList.vue?vue&type=template&id=836a97ac&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l1 = _vm.__map(_vm.orderList, function(order, index) {\n    var $orig = _vm.__get_orig(order)\n\n    var l0 = _vm.__map(order.items, function(item, itemIndex) {\n      var $orig = _vm.__get_orig(item)\n\n      var g0 = parseFloat(item.price).toFixed(2)\n      return {\n        $orig: $orig,\n        g0: g0\n      }\n    })\n\n    return {\n      $orig: $orig,\n      l0: l0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l1: l1\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WishOrderList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./WishOrderList.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<cu-custom    :isBack=\"true\">\n\t\t\t<block slot=\"backText\">返回</block>\n\t\t\t<block slot=\"content\">购物袋</block>\n\t\t</cu-custom>\n\t\t<checkbox-group class=\"block\" @change=\"selectedChange\">\n\t\t\t<view  class=\"cu-card article\" style=\"width: 100%\"  v-for=\"(order,index) in orderList\" :key=\"index\">\n\t\t\t\t<block v-for=\"(item,itemIndex) in order.items\" :key=\"itemIndex\">\n\t\t\t\t\t<view class=\"cu-item shadow flex\" style=\"margin: 10rpx; padding: 20rpx 0\" >\n\t\t\t\t\t\t<view class=\"content\" >\n\t\t\t\t\t\t\t<view style=\"width: 12%; display: flex;align-items: center;\">\n\t\t\t\t\t\t\t\t<checkbox class=\"round\" :class=\"item.isSelected?'checked':''\" :checked=\"item.isSelected\" :value=\"item.id\"></checkbox>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<image :src=\"item.cover\" class=\"bg-gray\" style=\"width: 28%;\" mode=\"aspectFill\" @tap=\"goDetail(item.id)\"></image>\n\t\t\t\t\t\t\t<view class=\"desc\" style=\"width: 60%\" >\n\t\t\t\t\t\t\t\t<view class=\"text-content\" @tap=\"goDetail(item.id)\">\n\t\t\t\t\t\t\t\t\t<text clas=\"text-bold\">{{item.title}}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"text-cut text-sm\">\n\t\t\t\t\t\t\t\t\t\t{{item.content}}\n\t\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"flex margin-top-sm  justify-between\">\n\t\t\t\t\t\t\t\t\t<view  class=\"cu-capsule radius \">\n\t\t\t\t\t\t\t\t\t\t<text class=\"text-red\">\n\t\t\t\t\t\t\t\t\t\t\t{{'¥ '+parseFloat(item.price).toFixed(2)+item.unit_name}}\n\t\t\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view>\n\t\t\t\t\t\t\t\t\t\t<ups-stepper :label=\"item.id\" :max=\"100\" :val=\"item.num\" :step=\"1\" :min=\"1\" @change=\"stepper\"></ups-stepper>\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</block>\n\t\t\t</view>\n\t\t</checkbox-group>\n\t\t<view class=\"cu-tabbar-height\"></view>\n\t\t<view class=\"cu-tabbar-height\"></view>\n\t\t<view class=\"cu-bar bg-white tabbar border  foot\">\n\t\t\t<view class=\"bg-white submit text-lg\" style=\"width: 30%\"  @tap=\"selectedAllChange\">\n\t\t\t\t<checkbox class=\"round\" :class=\"isSelectedAll?'checked':''\" :checked=\"isSelectedAll\" :value=\"isSelectedAll\"></checkbox><text class=\"margin-left-sm\">全选</text>\n\t\t\t</view>\n\t\t\t<view  style=\"width: 45%\">\n\t\t\t\t<text class=\"margin-right-sm\">合计</text><text class=\"text-red text-bold text-xl\">{{totalPrice}}</text>\n\t\t\t</view>\n\t\t\t<view class=\"bg-green submit text-lg\"  style=\"width: 25%\" @tap=\"goNeedConfirmOrder\">购买</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n    import { mapState } from 'vuex'\n    import cmnUtils from '@/utils/cmnUtils.js';\n    import upsStepper from '@/components/ups-stepper/index.vue';\n\n    export default {\n        components: {\n            \"ups-stepper\":upsStepper,\n        },\n        data() {\n            return {\n                orderList: [],\n                page: 1,\n                isSelectedAll:false,//是否选中\n                totalPrice:'',\n                selectedIds:[]//产品ID集合\n            }\n        },\n\n        onShow() {\n            this.getList()\n        },\n        onPullDownRefresh() {\n            this.page=1\n            this.getList()\n            uni.stopPullDownRefresh(); // 停止刷新\n        },\n        onReachBottom() {\n            this.page++;\n            this.getList()\n        },\n        computed:{\n            ...mapState(['user']),\n        },\n        methods:{\n            async selectedAllChange(e){\n                let that = this;\n                let newTotalAmount = 0;\n                that.isSelectedAll = !that.isSelectedAll;\n                // console.log('selectedAllChange isSelectedAll',that.isSelectedAll);\n                that.orderList.forEach(order=>{\n                    order.items.forEach(item=>{\n                        item.isSelected = that.isSelectedAll;\n                        if(item.isSelected){\n                            newTotalAmount += item.price*item.num;\n                        }\n                    })\n                });\n                that.totalPrice = '¥ '+ newTotalAmount.toFixed(2);\n                that.$forceUpdate();\n\t\t\t},\n            async selectedChange(e) {\n                let that = this;\n                console.log(e);\n                let newTotalAmount = 0;\n                that.selectedIds = e.detail.value;\n                that.selectedIds.forEach(label=>{\n                    let isFind =false;\n                    for(let i in that.orderList){\n                        for(let j in that.orderList[i].items){\n                            let item =that.orderList[i].items[j];\n                                //唯一key\n                            if(item.id==label){\n                                item.isSelected=true;\n                                newTotalAmount += item.price*item.num;\n                                isFind = true;\n                                break;\n                            }\n                        }\n                        if(isFind){break;}\n                    }\n                });\n                that.totalPrice = '¥ '+ newTotalAmount.toFixed(2);\n                that.$forceUpdate();\n            },\n            //步进器\n            stepper(e){\n                let that = this;\n                console.log(e)\n                let changedItem ={};\n                //存购物记录\n                if(e.val > 0){\n                    let isFind =false;\n                    for(let i in that.orderList){\n\t\t\t\t\t\tfor(let j in that.orderList[i].items){\n\t\t\t\t\t\t    //唯一key\n\t\t\t\t\t\t    let currentLabel = that.orderList[i].items[j].id;\n\t\t\t\t\t\t\tif(currentLabel==e.label){\n                                changedItem = that.orderList[i].items[j];\n                                changedItem.label = currentLabel;\n                                isFind = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isFind){break;}\n                    }\n                }\n                that.$forceUpdate();\n                let newTotalAmount = 0;\n                that.orderList.forEach(order=>{\n                    order.items.forEach(item=>{\n                        if(item.isSelected){\n                            //唯一key\n                            if(item.id==changedItem.label){\n                                item.num = e.val;\n                            }\n                            newTotalAmount += item.price*item.num;\n\t\t\t\t\t\t}\n                    })\n                });\n                that.totalPrice = '¥ '+ newTotalAmount.toFixed(2);\n                that.$forceUpdate();\n            },\n            async getList(){\n                let that = this;\n                if (that.page == 1) {\n                    that.orderList=[]\n                }\n                let res = null;\n                res = await wx.cloud.callFunction({\n                    name:'cmn',\n                    data:{\n                        $url:'getWishOrderListByUserId',\n                        userId:that.user._id,\n                        page:that.page\n                    }\n                });\n                if(!cmnUtils.isEmpty(res.result.data)){\n                    that.orderList.push(...res.result.data);\n                }\n\t\t\t\tthat.orderList.forEach(order=>{\n\t\t\t\t    order.items.forEach(item=>{\n\t\t\t\t        item.isSelected =false;\n\t\t\t\t\t})\n\t\t\t\t});\n                that.totalPrice = '¥ '+ Number(0).toFixed(2);\n\n            },\n\n            goDetail(id){\n                uni.navigateTo({\n                    \"url\":\"/pagesCmn/product/ProductDetailExt?id=\"+id\n                })\n            },\n            goNeedConfirmOrder(){\n                let that = this;\n                //需要转化成orderIds\n                let orderIds = [];\n                if(!cmnUtils.isEmpty(that.selectedIds)){\n                    let itemIds = that.selectedIds.join(',');\n                    that.orderList.forEach(order=>{\n                        order.items.forEach(item=>{\n                            if(itemIds.indexOf(item.id)>-1){\n                                orderIds.push(order._id);\n                            }\n                        })\n                    });\n\t\t\t\t}else if(that.isSelectedAll){\n                    that.orderList.forEach(order=>{\n                        orderIds.push(order._id);\n                    })\n                }\n                console.log('orderIds',orderIds);\n\t\t\t\tif(!cmnUtils.isEmpty(orderIds)){\n                    uni.redirectTo({\n                        \"url\":\"/pagesSys/my/NeedConfirmOrder?orderIds=\"+orderIds.join(','),\n                    })\n\t\t\t\t}\n\t\t\t}\n        }\n    }\n</script>\n\n<style>\n</style>\n"],"sourceRoot":""}